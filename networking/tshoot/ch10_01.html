<html>
<!-- Mirrored from nnc3.com/mags/Networking2/tshoot/ch10_01.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:54:58 GMT -->
<head><title>Application-Level Tools (Network Troubleshooting Tools)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Joseph D. Sloan" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="059600186XL" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="Network Troubleshooting Tools" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img alt="Book Home" border="0" src="gifs/smbanner.gif" usemap="#banner-map" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.html" alt="Network Troubleshooting Tools" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.html" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch09_03.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228"><a href="index.html"></a></td><td align="right" valign="top" width="228"><a href="ch10_02.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr></table><div>




<h1 class="chapter">Chapter 10. Application-Level Tools</h1>
<div class="htmltoc"><h4 class="tochead">Contents:</h4>
      <a href="#nettroubletools-CHP-10-SECT-1">Application-Protocols Tools</a><br />
<a href="ch10_02.html">Microsoft Windows</a><br /></p><p></div>

<a name="INDEX-2450" /></a><a name="INDEX-2451" /></a><a name="INDEX-2452" /></a><a name="INDEX-2453" /></a><a name="INDEX-2454" /></a>This chapter briefly surveys
some additional tools that might be of interest. You will not need
tools that are useful when setting up and debugging programs using
application-level protocols. The chapter is organized around
different application protocols. You will not need the tools
described here often. The goal of this chapter is to make you aware
of what is available should the need arise, and the approach
described here may be more useful than the specific tools mentioned.
Unless you have a specific problem, you'll probably want to
just skim this chapter the first time through.
</p><p>

<div class="sect1"><a name="nettroubletools-CHP-10-SECT-1" /></a>
<h2 class="sect1">10.1. Application-Protocols Tools</h2>

<a name="INDEX-2455" /></a>Many
network applications are built upon application-level protocols
rather than being built directly upon network- or transport-level
protocols. For example, email readers typically use SMTP to send
email and POP2, POP3, or IMAP to receive email. For some
applications, it is difficult to distinguish the application from the
underlying protocol. NFS is a prime example. But when an
implementation separates the application from its underlying
protocol, a number of advantages can be realized. First, the
separation helps to ensure interoperability. A client developed on
one platform can communicate effectively with server software running
on a different system. For example, your web browser can communicate
with any web server because it uses a standardized
protocol -- HTTP. Tools based on the underlying protocol can be
used to obtain basic information regardless of the specific
application being used.
</p><p>

Most of the tools described in this chapter collect information at
the protocol level. While it is unlikely that any of these tools will
provide the detailed information you would want for a problem with a
specific application, they should help you identify where the problem
lies and will help if the problem is with the protocol. Most
applications will have their own approaches to solving problems,
e.g., debug modes, and log files. But you'll want to be sure
the problem is with the application before you start with these. If
the problem is with the application, you'll need to consult the
specific documentation for the application.
</p><p>

If you are having trouble setting up a network application for the
first time, you are probably better off rereading the documentation
than investing time learning a new tool. But if you've read the
directions three or four times in several different books or if you
have used an application many times and it has suddenly stopped
working, then it's probably time to look at tools. For many of
the protocols, you'll have a number of choices. You won't
need every tool, so pick the most appropriate, convenient tool and
start there.
</p><p>

Providing a detailed description of all available tools is beyond the
scope of any reasonable book. This would require both a detailed
review of the protocol as well as a description of the tool. For
example, Hal Stern's 400-page book, <em class="emphasis">Managing NFS and
NIS</em>, has three chapters totaling about 125 pages on tools,
debugging, and tuning NIS and NFS. What I'm trying to do here
is provide you with enough information to get started and handle
simple problems. If you need more information, you should consider
looking at one of the many books, like Stern's, devoted to the
specific protocol in question. A number of such books are described
in <a href="appb_01.html">Appendix B, "Resources and References"</a>.
</p><p>

<a name="INDEX-2456" /></a><a name="INDEX-2457" /></a><a name="INDEX-2458" /></a><a name="INDEX-2459" /></a><a name="INDEX-2460" /></a>Generally, these applications are based on
a client/server model. The approach you'll take in debugging a
client may be different from that used to debug a server. The first
step, in general, is to decide if the problem is with the client
application, the server application, or the underlying protocols. If
any client on any machine can connect to a server, the server and
protocols are probably operating correctly. So when communications
fail, the first thing you may want to try is a different client
program or a similar client on a different computer. With many
protocols, you don't even need a client program. Many protocols
are based on the exchange of commands in NVT ASCII<a href="#FOOTNOTE-38">[38]</a>
over a TCP connection. You can interact with these servers using any
program that can open a TCP connection using NVT ASCII. Examples
include <em class="filename">telnet</em> and <em class="filename">netcat</em>.
</p><p><blockquote class="footnote">
<a name="FOOTNOTE-38" /></a>[38]Network Virtual Terminal (NVT) ASCII is a 7-bit U.S. variant of
the common ASCII character code. It is used throughout the TCP/IP
protocol. It uses 7 bits to encode a character that is transmitted as
an 8-bit byte with the high-order bit set to 0.</p><p> </blockquote>

<a name="nettroubletools-CHP-10-SECT-1.1" /></a><div class="sect2">
<h3 class="sect2">10.1.1. Email</h3>

<a name="INDEX-2461" /></a><a name="INDEX-2462" /></a><a name="INDEX-2463" /></a><a name="INDEX-2464" /></a><a name="INDEX-2465" /></a>Email protocols such as SMTP, POP2, and
POP3 are perfect examples of protocols where
<em class="filename">telnet</em> is the optimal tool to begin with. Here
is an example using <em class="filename">telnet</em> to send a brief
message via SMTP. (Depending on your system, you may need to enable
local echoing so that what you type will be visible.)
</p><p>

<blockquote><pre class="code">bsd2# telnet mail.lander.edu 25
Trying 205.153.62.5...
Connected to mail.lander.edu.
Escape character is '^]'.
220 mail.lander.edu ESMTP Sendmail 8.9.3/8.9.3; Wed, 22 Nov 2000 13:22:15 -0500
helo 205.153.60.236
250 mail.lander.edu Hello [205.153.60.236], pleased to meet you
mail from:&lt;jsloan@205.153.60.236&gt;
250 &lt;jsloan@205.153.60.236&gt;... Sender ok
rcpt to:&lt;jsloan@lander.edu&gt;
250 jsloan@lander.edu... Recipient ok
data
354 Enter mail, end with "." on a line by itself
This is the body of a message.
.
250 NAA28089 Message accepted for delivery
quit
221 mail.lander.edu closing connection
Connection closed by foreign host.</pre></blockquote>

<a name="INDEX-2466" /></a><a name="INDEX-2467" /></a>The process is very simple.
<em class="filename">telnet</em> is used to connect to port 25, the SMTP
port, on the email server in question. The next four lines were
returned by the server. At this point, we can see that the server is
up and that we are able to communicate with it. To send email, use
the commands <em class="filename">helo</em> to identify yourself,
<em class="filename">mail from:</em> to specify the email source, and
<em class="filename">rcpt to:</em> to specify the destination. Use names,
not IP addresses, to specify the destination. Notice that no password
is required to send email. (The server is responding with the lines
starting with numbers or codes.) The <em class="filename">data</em>
command was used to signal the start of the body of the message. The
body is one line long here but can be as long as you like. When you
are done entering the body, it is terminated with a new line that has
a single period on it. The session was terminated with the
<em class="filename">quit</em> command. Clearly the server is up and can
be reached in this example. Any problems you may be having must be
with your email client.
</p><p>

As noted, you had a pretty good idea the server was working as soon
as it replied and could have quit at this point. There are a couple
of reasons for going through the process of sending a message. First,
it gives a nice warm feeling seeing that everything is truly working.
More important, it confirms that the recipient is known to the
server. For example, consider the following:
</p><p>

<blockquote><pre class="code">rcpt to:&lt;jsloane@lander.edu&gt;
550 &lt;jsloane@lander.edu&gt;... User unknown</pre></blockquote>

<a name="INDEX-2468" /></a>This reply lets us know that the
user is unknown to the system. If you have doubts about a recipient,
you can use the <em class="filename">vrfy</em> and
<em class="filename">expand</em> commands. The <em class="filename">vrfy</em>
command will confirm the recipient address is valid, as shown in the
following example:
</p><p>

<blockquote><pre class="code">vrfy jsloan
250 Joseph Sloan &lt;jsloan@mail.lander.edu&gt;
vrfy freddy
550 freddy... User unknown</pre></blockquote>

<em class="filename">expn</em><a name="INDEX-2469" /></a><a name="INDEX-2470" /></a><a name="INDEX-2471" /></a> fully expands an alias, giving a list
of all the recipients named in the alias. Be warned,
<em class="filename">expn</em> and <em class="filename">vrfy</em> are often
seen as security holes and may be disabled. (Prudence would dictate
using <em class="filename">vrfy</em> and <em class="filename">expn</em> only on
your own systems.) There are other commands, but these are enough to
verify that the server is available.
</p><p>

<a name="INDEX-2472" /></a>Another reason for sending the email is
that it gives you something to retrieve, the next step in testing
your email connection. The process of retrieving email with
<em class="filename">telnet</em> is similar, although the commands will
vary with the specific protocol being used. Here is an example using
a POP3 server:
</p><p>

<blockquote><pre class="code">bsd2# telnet mail.lander.edu 110
Trying 205.153.62.5...
Connected to mail.lander.edu.
Escape character is '^]'.
+OK POP3 mail.lander.edu v7.59 server ready
user jsloan
+OK User name accepted, password please
pass xyzzy
+OK Mailbox open, 1 messages
retr 1
+OK 347 octets
Return-Path: &lt;jsloan@205.153.60.236&gt;
Received: from 205.153.60.236 ([205.153.60.236])
        by mail.lander.edu (8.9.3/8.9.3) with SMTP id NAA28089;
        Wed, 22 Nov 2000 13:23:14 -0500
Date: Wed, 22 Nov 2000 13:23:14 -0500
From: jsloan@205.153.60.236
Message-Id: &lt;200011221823.NAA28089@mail.lander.edu&gt;
Status:

This is the body of a message.
.
dele 1
+OK Message deleted
quit
+OK Sayonara
Connection closed by foreign host.</pre></blockquote>

<a name="INDEX-2473" /></a><a name="INDEX-2474" /></a><a name="INDEX-2475" /></a><a name="INDEX-2476" /></a><a name="INDEX-2477" /></a><a name="INDEX-2478" /></a>As you can see,
<em class="filename">telnet</em> is used to connect to port 110, the POP3
port. As soon as the first message comes back, you know the server is
up and reachable. Next, you identify yourself using the
<em class="filename">user</em> and <em class="filename">pass</em> commands.
This is a quick way to make sure that the account exists and you have
the right password. Often, email readers give cryptic error messages
when you use a bad account or password. The system has informed us
that there is one message waiting for this user. Next, retrieve that
message with the <em class="filename">retr</em> command. The argument is
the message number. This is the message we just sent. Delete the
message and log off with the <em class="filename">dele</em> and
<em class="filename">quit</em> commands, respectively. (As an aside,
sometimes mail clients will hang with overlarge attachments. You can
use the <em class="filename">dele</em> command to delete the offending
message.)
</p><p>

<a name="INDEX-2479" /></a>Of course, this is how a system
running POP3 or SMTP is supposed to work. If it works this way, any
subsequent problems are probably with the client, and you need to
turn to the client documentation. You can confirm this with packet
capture software. If your system doesn't work properly, the
problem could be with the server software or with communications. You
might try logging onto the server and verifying that the appropriate
software is listening, using <em class="filename">ps</em>, or, if it is
started by <em class="filename">inetd</em>, using
<em class="filename">netstat</em>. Or you might try using
<em class="filename">telnet</em> to connect to the server directly from
the server, i.e., <tt class="literal">telnet localhost 25</tt>. If this
succeeds, you may have routing problems, name service problems, or
firewall problems. If it fails, then look to the documentation for
the software you are using on the server.
</p><p>

The commands used by most email protocols are described in the
relevant RFCs. For SMTP, see RFC 821; for POP2, see RFC 937; for
POP3, see REF 1939; and for IMAP, see RFC 1176.<a name="INDEX-2480" /></a><a name="INDEX-2481" /></a>
</p><p>

</div>
<a name="nettroubletools-CHP-10-SECT-1.2" /></a><div class="sect2">
<h3 class="sect2">10.1.2. HTTP</h3>

<a name="INDEX-2482" /></a><a name="INDEX-2483" /></a><a name="INDEX-2484" /></a>HTTP is another protocol that is
based on commands in NVT ASCII sent over a TCP session. It can be
fairly complicated to figure out the correct syntax, but even an
error message will tell you that the server is running and the
connection works. Try typing <tt class="literal">HEAD / HTTP / 1.0</tt>
followed by two carriages returns. Here is an example:
</p><p>

<blockquote><pre class="code">bsd2# telnet localhost http
Trying 127.0.0.1...
Connected to localhost.lander.edu.
Escape character is '^]'.
HEAD / HTTP / 1.0

HTTP/1.1 200 OK
Date: Sun, 22 Apr 2001 13:27:32 GMT
Server: Apache/1.3.12 (Unix)
Content-Location: index.html.en
Vary: negotiate,accept-language,accept-charset
TCN: choice
Last-Modified: Tue, 29 Aug 2000 09:14:16 GMT
ETag: "a4cd3-55a-39ab7ee8;3a4a1b39"
Accept-Ranges: bytes
Content-Length: 1370
Connection: close
Content-Type: text/html
Content-Language: en
Expires: Sun, 22 Apr 2001 13:27:32 GMT

Connection closed by foreign host.</pre></blockquote>

In this example, I've checked to see if the server is
responding from the server itself. In general, however, using
<em class="filename">telnet</em> is probably not worth the effort since it
is usually very easy to find a working web browser that you can use
somewhere on your network.
</p><p>

<a name="INDEX-2485" /></a><a name="INDEX-2486" /></a><a name="INDEX-2487" /></a><a name="INDEX-2488" /></a><a name="INDEX-2489" /></a>Most
web problems, in my experience, stem from incorrectly configured
security files or are performance problems. For security
configuration problems, you'll need to consult the appropriate
documentation for your software. For a quick performance profile of
your server, you might visit Patrick Killelea's web site,
<a href="http://patrick.net/">http://patrick.net</a>. If you have
problems, you probably want to look at his book, <em class="emphasis">Web
Performance Tuning</em>.
</p><p>

</div>
<a name="nettroubletools-CHP-10-SECT-1.3" /></a><div class="sect2">
<h3 class="sect2">10.1.3. FTP and TFTP</h3>

<a name="INDEX-2490" /></a><a name="INDEX-2491" /></a><a name="INDEX-2492" /></a>FTP is
another protocol that uses NVT ASCII and can be checked, to a very
limited extent, with <em class="filename">telnet</em>. Here is a quick
check to see if the server is up and can be reached:
</p><p>

<blockquote><pre class="code">lnx1# telnet bsd2 ftp
Trying 172.16.2.236...
Connected to bsd2.lander.edu.
Escape character is '^]'.
220 bsd2.lander.edu FTP server (Version 6.00LS) ready.
user jsloan
331 Password required for jsloan.
pass xyzzy
230 User jsloan logged in.
stat
211- bsd2.lander.edu FTP server status:
     Version 6.00LS
     Connected to 172.16.3.234
     Logged in as jsloan
     TYPE: ASCII, FORM: Nonprint; STRUcture: File; transfer MODE: Stream
     No data connection
211 End of status
quit
221 Goodbye.
Connection closed by foreign host.</pre></blockquote>

<a name="INDEX-2493" /></a>Once you know the server is up,
you'll want to switch over to a real FTP client. Because FTP
opens a reverse connection when transferring information, you are
limited with what you can do with <em class="filename">telnet</em>.
Fortunately, this is enough to verify that the server is up,
communication works, and you can successfully log on to the server.
</p><p>

Unlike FTP, TFTP is UDP based. Consequently, TCP-based tools like
<em class="filename">telnet</em> are not appropriate. You'll want to
use a TFTP client to test for connectivity. Fortunately, TFTP is a
simple protocol and usually works well.
</p><p>

</div>
<a name="nettroubletools-CHP-10-SECT-1.4" /></a><div class="sect2">
<h3 class="sect2">10.1.4. Name Services</h3>

<a name="INDEX-2494" /></a><a name="INDEX-2495" /></a><a name="INDEX-2496" /></a><a name="INDEX-2497" /></a>Since name resolution is based
primarily on UDP, you won't be able to debug it with
<em class="filename">telnet</em>. Name resolution can be a real pain since
problems are most likely to show up when you are using other programs
or services. Name service applications are applications that
you'll want to be sure are working on your system. For clients,
it is one of the easiest protocols to test. For servers, however,
ferreting out that last error can be a real chore. Fortunately, there
are a number of readily available tools, particularly for DNS.
</p><p>

<a name="INDEX-2498" /></a><a name="INDEX-2499" /></a>If you suspect name resolution is
not working on a client, try using <em class="filename">ping</em>,
alternating between hostnames and IP addresses. If you are
consistently able to reach remote hosts with IP addresses but not
with names, then you are having a problem with name resolution. If
you have a problem with name resolution on the client side, start by
reviewing the configuration files. It is probably easiest to start
with <em class="filename">/etc/hosts</em> and then look at DNS. Leave NIS
until last.
</p><p>

<a name="nettroubletools-CHP-10-SECT-1.4.1" /></a><div class="sect3">
<h3 class="sect3">10.1.4.1. nslookup and dig</h3>

<a name="INDEX-2500" /></a><a name="INDEX-2501" /></a><a name="INDEX-2502" /></a><a name="INDEX-2503" /></a><a name="INDEX-2504" /></a><a name="INDEX-2505" /></a><a name="INDEX-2506" /></a>There are several tools, such as
<em class="filename">nslookup</em>, <em class="filename">dig</em>,
<em class="filename">dnsquery</em>, and <em class="filename">host</em>, that
are used to query DNS servers. These are most commonly used to
retrieve basic domain information such as what name goes with what IP
address, aliases, or how a domain is organized. With this
information, you can map out a network, for example, at least to the
extent the DNS entries reflect the structure of the network. When
troubleshooting on the client side, it can be used to ensure the
client can reach the appropriate DNS server. The real value for
troubleshooting, however, is being able to examine the information
returned by servers. This allows you to check this information for
consistency, correctness, and completeness.
</p><p>

For most purposes, there is not much difference among these programs.
Your choice will largely be a matter of personal preference. However,
you should be aware that some other programs may be built on top of
<em class="filename">dig</em>, so be sure to keep it around even if you
prefer one of the other tools.
</p><p>

Of these, <em class="filename">nslookup</em>, written by Andrew Cherenson,
is the most ubiquitous and the most likely to be installed by
default. It is even available under Windows. It can be used either in
command-line mode or interactively. In command-line mode, you use the
name or IP address of interest as an argument:
</p><p>

<blockquote><pre class="code">sol1# nslookup 205.153.60.20
Server:  lab.lander.edu
Address:  205.153.60.5

Name:    ntp.lander.edu
Address:  205.153.60.20

bsd2# nslookup www.lander.edu
Server:  lab.lander.edu
Address:  205.153.60.5

Name:    web.lander.edu
Address:  205.153.60.15
Aliases:  www.lander.edu</pre></blockquote>

<a name="INDEX-2507" /></a><a name="INDEX-2508" /></a><a name="INDEX-2509" /></a><a name="INDEX-2510" /></a>As you can see, it returns both the
name and IP address of the host in question, the identity of the
server supplying the information, and, in the second example, that
the queried name is an alias. You can specify the server you want to
use as well as other options on the command line. You should be
aware, however, that it is not unusual for reverse lookups to fail,
usually because the DNS database is incomplete.
</p><p>

Earlier versions of <em class="filename">nslookup</em> required a special
format for finding the names associated with IP addresses. For
example, to look up the name associated with
<em class="filename">205.153.60.20</em>, you would have used the command
<tt class="literal">nslookup 20.60.153.205.in-addr.arpa</tt>. Fortunately,
unless you are using a very old version of
<em class="filename">nslookup</em>, you won't need to bother with
this.
</p><p>

While command-line mode is adequate for an occasional quick query, if
you want more information, you'll probably want to use
<em class="filename">nslookup</em> in interactive mode. If you know the
right combination of options, you could use command-line options. But
if you are not sure, it is easier to experiment step-by-step in
interactive mode.
</p><p>

Interactive mode is started by typing <tt class="literal">nslookup</tt>
without any arguments:
</p><p>

<blockquote><pre class="code">sol1# nslookup
Default Server:  lab.lander.edu
Address:  205.153.60.5

&gt;</pre></blockquote>

<a name="INDEX-2511" /></a><a name="INDEX-2512" /></a><a name="INDEX-2513" /></a><a name="INDEX-2514" /></a><a name="INDEX-2515" /></a><a name="INDEX-2516" /></a><a name="INDEX-2517" /></a><a name="INDEX-2518" /></a>As you can see,
<em class="filename">nslookup</em> responds with the name of the default
server and a prompt. A <em class="filename">?</em> will return a list of
available options. You can change the server you want to query with
the <em class="filename">server</em> command. You can get a listing of all
machines in a domain with the <em class="filename">ls</em> command. For
example, <em class="filename">ls netlab.lander.edu</em> would list all the
machines in the <em class="emphasis">netlab.lander.edu</em> domain. Use
the <em class="filename">ls</em> command with caution -- it can return
a lot of information. You can use the <em class="filename">-t</em> option
to specify a query type, i.e., a particular type of record. For
example, <em class="filename">ls -t mx lander.edu</em> will return the
mail entries from <em class="emphasis">lander.edu</em>. Query types can
include <em class="filename">cname</em> to list canonical names for
aliases, <em class="filename">hinfo</em> for host information,
<em class="filename">ns</em> for name servers for named zones,
<em class="filename">soa</em> for zone authority record, and so on. For
more information, start with the manpage for
<em class="filename">nslookup</em>.
</p><p>

<a name="INDEX-2519" /></a>One useful trick is to retrieve the
<em class="filename">soa</em> record for local and authoritative servers.
Here is part of one such record retrieved in interactive mode:
</p><p>

<blockquote><pre class="code">&gt; ls -t soa lander.edu
[lab.lander.edu]
$ORIGIN lander.edu.
@                       1D IN SOA       lab root (
                                        960000090       ; serial</pre></blockquote>

<a name="INDEX-2520" /></a><a name="INDEX-2521" /></a><a name="INDEX-2522" /></a>The entry labeled
<tt class="literal">serial</tt> is a counter that should be incremented
each time the DNS records are updated. If the serial number on your
local server, when compared to the authoritative server, is off by
more than 1 or 2, the local server is not updating its records in a
timely manner. One possible cause is an old version of
<em class="filename">bind</em>.
</p><p>

<a name="INDEX-2523" /></a><a name="INDEX-2524" /></a>Many administrators prefer
<em class="filename">dig</em> to <em class="filename">nslookup</em>. While not
quite as ubiquitous as <em class="filename">nslookup</em>, it is included
as a tool with <em class="filename">bind</em> and is also available as a
separate tool. <em class="filename">dig</em> is a command-line tool that
is quite easy to use. It seems to have a few more options and, since
it is command line oriented, it is more suited for shell scripts. On
the other hand, using <em class="filename">nslookup</em> interactively may
be better if you are groping around and not really sure what you are
looking for.<a name="INDEX-2525" /></a><a name="INDEX-2526" /></a><a name="INDEX-2527" /></a> 
</p><p>

<em class="filename">dig</em><a name="INDEX-2528" /></a><a name="INDEX-2529" /></a><a name="INDEX-2530" /></a><a name="INDEX-2531" /></a>, short for Domain Internet Groper, was
written by Steve Hotz. Here is an example of using
<em class="filename">dig</em> to do a simple query:
</p><p>

<blockquote><pre class="code">bsd2# dig @lander.edu www.lander.edu

; &lt;&lt;&gt;&gt; DiG 8.3 &lt;&lt;&gt;&gt; @lander.edu www.lander.edu
; (1 server found)
;; res options: init recurs defnam dnsrch
;; got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 6
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 1
;; QUERY SECTION:
;;      www.lander.edu, type = A, class = IN

;; ANSWER SECTION:
www.lander.edu.         1D IN CNAME     web.lander.edu.
web.lander.edu.         1D IN A         205.153.60.15

;; AUTHORITY SECTION:
lander.edu.             1D IN NS        lander.edu.

;; ADDITIONAL SECTION:
lander.edu.             1D IN A         205.153.60.5

;; Total query time: 9 msec
;; FROM: bsd2.lander.edu to SERVER: lander.edu  205.153.60.5
;; WHEN: Tue Nov  7 10:26:42 2000
;; MSG SIZE  sent: 32  rcvd: 106</pre></blockquote>

The first argument, in this case <tt class="literal">@lander.edu</tt>, is
optional. It gives the name of the name server to be queried. The
second argument is the name of the host you are looking up.
</p><p>

<a name="INDEX-2532" /></a>As you can
see, a simple <em class="filename">dig</em> provides a lot more
information, by default at least, than does
<em class="filename">nslookup</em>. It begins with information about the
name server and <em class="filename">resolver</em> flags used. (The flags
are documented in the manpage for <em class="filename">bind </em> 's
<em class="filename">resolver</em>.) Next come the header fields and flags
followed by the query being answered. These are followed by the
answer, authority records, and additional records. The format is the
domain name, TTL field, type code for the record, and the data field.
Finally, summary information about the exchange is included.
</p><p>

<a name="INDEX-2533" /></a>You can
also use <em class="filename">dig</em> to get other types of information.
For example, the <em class="filename">-x</em> option is used to do a
reverse name lookup:
</p><p>

<blockquote><pre class="code">bsd2# dig -x 205.153.63.30

; &lt;&lt;&gt;&gt; DiG 8.3 &lt;&lt;&gt;&gt; -x
;; res options: init recurs defnam dnsrch
;; got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 4
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1
;; QUERY SECTION:
;;      30.63.153.205.in-addr.arpa, type = ANY, class = IN

;; ANSWER SECTION:
30.63.153.205.in-addr.arpa.  1D IN PTR  sloan.lander.edu.

;; AUTHORITY SECTION:
63.153.205.in-addr.arpa.  1D IN NS  lander.edu.

;; ADDITIONAL SECTION:
lander.edu.             1D IN A         205.153.60.5

;; Total query time: 10 msec
;; FROM: bsd2.lander.edu to SERVER: default -- 205.153.60.5
;; WHEN: Mon Nov  6 10:54:17 2000
;; MSG SIZE  sent: 44  rcvd: 127</pre></blockquote>

<a name="INDEX-2534" /></a><a name="INDEX-2535" /></a><a name="INDEX-2536" /></a><a name="INDEX-2537" /></a>The<em class="filename"> mx</em>
option (no hyphen) will return mail records, the
<em class="filename">soa</em> option will return zone authority records,
and so on. See the manpage for details.
</p><p>

<em class="filename">nslookup</em> and <em class="filename">dig</em> are not
unique. For example, <em class="filename">host</em> and
<em class="filename">dnsquery</em> are other alternatives you may want to
look at. <em class="filename">host</em> is said to be designed as a
successor for <em class="filename">nslookup</em> and
<em class="filename">dig</em>. But it does everything online and can
generate a lot of traffic as a result. While very useful tools, all
of them rely on your ability to go back and analyze the information
returned. There are other tools that help to fill this gap.<a name="INDEX-2538" /></a><a name="INDEX-2539" /></a><a name="INDEX-2540" /></a><a name="INDEX-2541" /></a>
</p><p>

</div>

<a name="nettroubletools-CHP-10-SECT-1.4.2" /></a><div class="sect3">
<h3 class="sect3">10.1.4.2. doc, dnswalk, and lamers</h3>

<em class="filename">doc</em><a name="INDEX-2542" /></a><a name="INDEX-2543" /></a><a name="INDEX-2544" /></a> is one
such tool. It was originally written by Steve Hotz and Paul
Mockapetris with later modifications by Brad Knowles. Built on top of
<em class="filename">dig</em>, <em class="filename">doc</em> is a script that
attempts to validate the consistency of information within a domain:
</p><p>

<blockquote><pre class="code">bsd2# doc lander.edu.
Doc-2.1.4: doc lander.edu.
Doc-2.1.4: Starting test of lander.edu.   parent is edu.
Doc-2.1.4: Test date - Mon Nov  6 11:55:07 EST 2000
;; res_nsend to server g.root-servers.net.  192.112.36.4: Operation timed out
DIGERR (UNKNOWN): dig @g.root-servers.net. for SOA of parent (edu.) failed
Summary:
   ERRORS found for lander.edu. (count: 3)
   WARNINGS issued for lander.edu. (count: 1)
Done testing lander.edu.  Mon Nov  6 11:55:40 EST 2000</pre></blockquote>

The results are recorded in a log file; in this case
<em class="filename">log.lander.edu.</em> is the filename. (Note its
trailing period.)
</p><p>

<em class="filename">dnswalk</em><a name="INDEX-2545" /></a><a name="INDEX-2546" /></a><a name="INDEX-2547" /></a><a name="INDEX-2548" /></a><a name="INDEX-2549" /></a>, written by David Barr, is a similar
tool. It is a Perl script that does a zone transfer and checks the
database for internal consistency. (Be aware that more and more
systems are disabling zone transfers from unknown sites.)
</p><p>

<blockquote><pre class="code">bsd2# dnswalk lander.edu.
Checking lander.edu.
BAD: lander.edu. has only one authoritative nameserver
Getting zone transfer of lander.edu. from lander.edu...done.
SOA=lab.lander.edu      contact=root.lander.edu
WARN: bookworm.lander.edu A 205.153.62.205: no PTR record
WARN: library.lander.edu A 205.153.61.11: no PTR record
WARN: wamcmaha.lander.edu A 205.153.62.11: no PTR record
WARN: mrtg.lander.edu CNAME elmer.lander.edu: unknown host
0 failures, 4 warnings, 1 errors.</pre></blockquote>

<a name="INDEX-2550" /></a><a name="INDEX-2551" /></a>Be sure to include the
period at the end of the domain name. This can produce a lot of
output, so you may want to redirect output to a file. A number of
options are available. Consult the manpage.
</p><p>

You'll want to take the output from these tools with a grain of
salt. Even though these tools do a lot of work for you, you'll
need a pretty good understanding of DNS to make sense of the error
messages. And, as you can see, for the same domain, one found three
errors and one warning while the other found one error and four
warnings for a fully functional DNS domain. There is no question that
this domain's database, which was being updated when this was
run, has a few minor problems. But it does work. The moral is,
don't panic when you see an error message.
</p><p>

<a name="INDEX-2552" /></a><a name="INDEX-2553" /></a><a name="INDEX-2554" /></a><a name="INDEX-2555" /></a><a name="INDEX-2556" /></a><a name="INDEX-2557" /></a>Another program you might find useful is
<em class="filename">lamers</em>. This was written by Bryan Beecher and
requires both <em class="filename">doc</em> and <em class="filename">dig</em>.
It is used to find lame delegations, i.e., a name server that is
listed as authoritative for a domain but is not actually performing
that service for the listed domain. This problem most often arises
when name services are moved from one machine to another, but the
parent domain is not updated. <em class="filename">lamers</em> is a simple
script that can be used to identify this problem.
</p><p>

</div>

<a name="nettroubletools-CHP-10-SECT-1.4.3" /></a><div class="sect3">
<h3 class="sect3">10.1.4.3. Other tools</h3>

<a name="INDEX-2558" /></a><a name="INDEX-2559" /></a><a name="INDEX-2560" /></a><a name="INDEX-2561" /></a><a name="INDEX-2562" /></a><a name="INDEX-2563" /></a><a name="INDEX-2564" /></a><a name="INDEX-2565" /></a><a name="INDEX-2566" /></a><a name="INDEX-2567" /></a><a name="INDEX-2568" /></a><a name="INDEX-2569" /></a>In addition to these debugging tools,
there are a number of additional tools that are useful in setting up
DNS in the first place. Some, such as
<em class="filename">make-zones</em>, <em class="filename">named-bootconf</em>,
and <em class="filename">named-xfer,</em> come with
<em class="filename">bind</em>. Be sure to look over your port carefully.
Others, often scripts or collections of scripts, are available from
other sources. Examples include <em class="filename">h2n</em> and
<em class="filename">dnsutl</em>. There are a number of good tools out
there, so be sure to look around.
</p><p>

</div>

<a name="nettroubletools-CHP-10-SECT-1.4.4" /></a><div class="sect3">
<h3 class="sect3">10.1.4.4. NIS and NIS+</h3>

<a name="INDEX-2570" /></a><a name="INDEX-2571" /></a><a name="INDEX-2572" /></a><a name="INDEX-2573" /></a><a name="INDEX-2574" /></a><a name="INDEX-2575" /></a><a name="INDEX-2576" /></a><a name="INDEX-2577" /></a><a name="INDEX-2578" /></a>NIS
and its variants bring their own set of difficulties. If you are
running both DNS and NIS, the biggest problem may be deciding where
the problem lies. Unfortunately, there is no easy way to do this that
will work in every case. The original implementation of
<em class="filename">nslookup</em> completely bypasses NIS. If it failed,
you could look to DNS. If it succeeded, your problems were probably
with NIS. Unfortunately, the new, "improved" version of
<em class="filename">nslookup</em> now queries NIS so this simple test is
unreliable. (For other suggestions, see <em class="emphasis">Managing NFS and
NIS</em> by Hal Stern or <em class="emphasis">DNS and BIND</em> by
Liu et al.)
</p><p>

If you are setting up NIS, your best strategy is to fully test DNS
first. If you are having problems with NIS, there are a number of
simple utilities supplied with NIS. <em class="filename">ypcat</em> lists
an entire map, <em class="filename">ypmatch</em> matches a single key and
prints an entry, and <em class="filename">ypwhich</em> identifies client
bindings. But if you have read the NIS documentation, you are already
familiar with these.<a name="INDEX-2579" /></a><a name="INDEX-2580" /></a><a name="INDEX-2581" /></a><a name="INDEX-2582" /></a> 
</p><p>

</div>
</div>
<a name="nettroubletools-CHP-10-SECT-1.5" /></a><div class="sect2">
<h3 class="sect2">10.1.5. Routing</h3>

<a name="INDEX-2583" /></a><a name="INDEX-2584" /></a><a name="INDEX-2585" /></a><a name="INDEX-2586" /></a><a name="INDEX-2587" /></a><a name="INDEX-2588" /></a>If you
are having routing problems, e.g., receiving error messages saying
the host or network is unreachable, then the first place to look is
at the routing tables. On the local machine, you'll use the
<em class="filename">netstat -r</em> command as previously discussed. For
remote machines, you can use SNMP if you have SNMP access.
</p><p>

<a name="INDEX-2589" /></a><a name="INDEX-2590" /></a><a name="INDEX-2591" /></a><a name="INDEX-2592" /></a><a name="INDEX-2593" /></a>If you are using RIP,
<em class="filename">rtquery</em> and <em class="filename">ripquery</em> are
two tools that can be used to retrieve routing tables from remote
systems. <em class="filename">rtquery</em> is supplied as part of the
<em class="filename">routed</em> distribution, while
<em class="filename">ripquery</em> comes with <em class="filename">gated</em>.
The advantage of these tools is that they use the RIP query and
response mechanism to retrieve the route information. Thus, you can
use either of these tools to confirm that the RIP exchange mechanism
is really working, as well as to retrieve the routing tables to check
for correctness.
</p><p>

It really doesn't matter which of these you use, as the output
from the two is basically the same. Here is the output from
<em class="filename">ripquery</em>:
</p><p>

<blockquote><pre class="code">bsd2# ripquery 172.16.2.1
84 bytes from NLCisco.netlab.lander.edu(172.16.2.1) to 172.16.2.236 version 2:
             172.16.1.0/255.255.255.0    router 0.0.0.0          metric  1  tag
0000
             172.16.3.0/255.255.255.0    router 0.0.0.0          metric  1  tag
0000
             172.16.5.0/255.255.255.0    router 0.0.0.0          metric  2  tag
0000
             172.16.7.0/255.255.255.0    router 0.0.0.0          metric  2  tag
0000</pre></blockquote>

Here is the output from <em class="filename">rtquery</em> :</p><p>

<blockquote><pre class="code">bsd2# rtquery 172.16.2.1
NLCisco.netlab.lander.edu (172.16.2.1): RIPv2 84 bytes
  172.16.1.0/24      metric  1
  172.16.3.0/24      metric  1
  172.16.5.0/24      metric  2
  172.16.7.0/24      metric  2</pre></blockquote>

<a name="INDEX-2594" /></a><a name="INDEX-2595" /></a>You'll notice that these are not
your usual routing tables. Rather, these are the tables used by
RIP's distance vector algorithm. They give reachable networks
and the associated costs. Of course, you could always capture a RIP
update with <em class="filename">tcpdump</em> or
<em class="filename">ethereal</em> or use SNMP, but the tools discussed
here are a lot easier to use.
</p><p>

<a name="INDEX-2596" /></a><a name="INDEX-2597" /></a>If you are using Open Shortest Path
First (OSPF) (regretfully I don't at present),
<em class="filename">gated</em> provides
<em class="filename">ospf_monitor</em>. This interactive program provides
a wealth of statistics, including I/O statistics and error logs in
addition to OSPF routing tables. (For more information on routing
protocols, you might consult <em class="emphasis">Routing in the
Internet</em> by Christian Huitema or
<em class="emphasis">Interconnections</em> by Radia Perlman.)
</p><p>

</div>
<a name="nettroubletools-CHP-10-SECT-1.6" /></a><div class="sect2">
<h3 class="sect2">10.1.6. NFS</h3>

<a name="INDEX-2598" /></a><a name="INDEX-2599" /></a><a name="INDEX-2600" /></a>With time, Network
File System (NFS) has become fairly straightforward to set up. At one
time, there were a number of utilities for debugging NFS problems,
but finding current ports has become difficult. At the risk of
repeating myself, if you are having trouble setting up NFS, reread
your documentation. Keep in mind that the various implementations of
NFS all seem to be different, sometimes a lot different. By itself,
generic directions for NFS don't work -- be sure to consult
the specific documentation for your operating system!
</p><p>

<a name="INDEX-2601" /></a><a name="INDEX-2602" /></a><a name="INDEX-2603" /></a><a name="INDEX-2604" /></a><a name="INDEX-2605" /></a><a name="INDEX-2606" /></a><a name="INDEX-2607" /></a><a name="INDEX-2608" /></a><a name="INDEX-2609" /></a><a name="INDEX-2610" /></a><a name="INDEX-2611" /></a><a name="INDEX-2612" /></a><a name="INDEX-2613" /></a>Unlike most other protocols where a
single process is started, NFS relies on a number of different
programs or daemons that vary from client to server and, to some
extent, from system to system. If you are having problems with NFS,
the first step is to consult your documentation to determine which
daemons need to be running on your system. Next, make sure they are
running. Be warned, the daemons you need and the names they go by
vary from operating system to operating system. For example, on most
systems, <em class="filename">mountd</em> and <em class="filename">nfsd</em>,
respectively, mount filesystems and access files. On some systems
they go by the names <em class="filename">rpc.mountd</em> and
<em class="filename">rpc.nfsd</em>. Since these rely on
<em class="filename">portmap</em>, sometimes called
<em class="filename">rpcbind</em>, you'll need to make sure it is
running as well. (NFS daemons are typically based on RPC and use the
<em class="filename">portmapper</em> daemon to provide access
information.) The list of daemons will be different for the client
and the server. For example, <em class="filename">nfsiod</em> (or
<em class="filename">biod)</em> will typically be running on the client
but not the server. Keep in mind, however, that a computer may be
both a client and a server.
</p><p>

<a name="INDEX-2614" /></a>There
are a couple of ways to ensure the appropriate processes are
available. You could log on to both machines and use
<em class="filename">ps</em> to discover what is running. This has the
advantage of showing you everything that is running. Another approach
is to use <em class="filename">rpcinfo</em> to do a
<em class="filename">portmapper</em> dump. Here is an example of querying
a server from a client:
</p><p>

<blockquote><pre class="code">bsd2# rpcinfo -p bsd1
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    3   udp   1023  mountd
    100005    3   tcp   1023  mountd
    100005    1   udp   1023  mountd
    100005    1   tcp   1023  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs
    100024    1   udp   1011  status
    100024    1   tcp   1022  status</pre></blockquote>

This has the advantage of showing that these services are actually
reachable across the network.
</p><p>

<a name="INDEX-2615" /></a>Once you
know that everything is running, you should check the access files,
typically <em class="filename">/etc/dfs/dfstab</em> or
<em class="filename">/etc/exports</em>, to make sure the client
isn't being blocked. You can't just edit these files and
expect to see the results immediately. Consult your documentation on
how to inform your NFS implementation of the changes. Be generous
with privileges if you are having problems, but don't forget to
tighten security once everything is working.
</p><p>

<a name="INDEX-2616" /></a><a name="INDEX-2617" /></a>Finally, check your syntax. Make sure the
mount point exists and has appropriate permissions. Mount the remote
system manually and verify that it is mounted with the
<em class="filename">mount</em> command. You should see something
recognizable. Here are mount table entries returned, respectively, by
FreeBSD, Linux, and Solaris:
</p><p>

<blockquote><pre class="code">bsd1:/ on /mnt/nfs type nfs (rw,addr=172.16.2.231,addr=172.16.2.231)
172.16.2.231:/ on /mnt/nfs (nfs)
/mnt/nfs on 172.16.2.231:/usr read/write/remote on Thu Nov 30 09:49:52 2000</pre></blockquote>

While they are not too similar, you should see a recognizable change
to the mount table before and after mounting a remote filesystem.
</p><p>

<a name="INDEX-2618" /></a>If you
are having intermittent problems or if you suspect performance
problems, you might want to use the <em class="filename">nfsstat</em>
command. It provides a wealth of statistics about your NFS connection
and its performance. You can use it to query the client, the server,
or both. When called without any options, it queries both client and
server. With the <em class="filename">-c</em> option, it queries the
client. With the <em class="filename">-s</em> option, it queries the
server. Here is an example of querying a client:
</p><p>

<blockquote><pre class="code">bsd2# nfsstat -c
Client Info:
Rpc Counts:
  Getattr   Setattr    Lookup  Readlink      Read     Write    Create    Remove
        0         0        33         2         0        21         4         0
   Rename      Link   Symlink     Mkdir     Rmdir   Readdir  RdirPlus    Access
        0         0         0         0         0         8         0        66
    Mknod    Fsstat    Fsinfo  PathConf    Commit    GLease    Vacate     Evict
        0        13         3         0         2         0         0         0
Rpc Info:
 TimedOut   Invalid X Replies   Retries  Requests
        0         0         0         0       152
Cache Info:
Attr Hits    Misses Lkup Hits    Misses BioR Hits    Misses BioW Hits    Misses
      232        36        74        33         0         0         0        21
BioRLHits    Misses BioD Hits    Misses DirE Hits    Misses
       13         2        18         8        13         0</pre></blockquote>

<a name="INDEX-2619" /></a>Unfortunately, it seems that every
operating system has its own implementation of
<em class="filename">nfsstat</em> and each implementation returns a
different set of statistics labeled in a different way. What
you'll be most interested in is the number of problems in
relation to the total number of requests. For example, a large number
of timeouts is no cause for concern if it is a small percentage of a
much larger number of total requests. If the timeouts are less than a
couple of percent, they are probably not a cause for concern. But if
the percent of timeouts is large, you need to investigate.
You'll need to sort out the meaning of various numbers returned
by your particular implementation of <em class="filename">nfsstat</em>.
And, unfortunately, the labels aren't always intuitive.
</p><p>

<a name="INDEX-2620" /></a><a name="INDEX-2621" /></a><a name="INDEX-2622" /></a><a name="INDEX-2623" /></a><a name="INDEX-2624" /></a><a name="INDEX-2625" /></a><a name="INDEX-2626" /></a><a name="INDEX-2627" /></a><a name="INDEX-2628" /></a>Several
other NFS tools were once popular but seem to have languished in
recent years. You probably won't have much luck in finding
these or getting them running. Two of the ones that were once more
popular are <em class="filename">nhfsstone</em> and
<em class="filename">nfswatch</em>. <em class="filename">nhfsstone</em> is a
benchmark tool for NFS, which seems to have been superseded with the
rather pricey SFS tool in SPEC. <em class="filename">nfswatch</em> is a
tool that allows you to watch NFS traffic.
<em class="filename">tcpdump</em> or <em class="filename">ethereal</em>, when
used with the appropriate filters, provide a workable alternative to
<em class="filename">nfswatch</em>.<a name="INDEX-2629" /></a><a name="INDEX-2630" /></a> 
</p><p>

</div>
</div>




<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch09_03.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228"><a href="index.html"><img alt="Home" border="0" src="../gifs/txthome.gif" /></a></td><td align="right" valign="top" width="228"><a href="ch10_02.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr><tr><td align="left" valign="top" width="228">9.3. Microsoft Windows</td><td align="center" valign="top" width="228"><a href="index/index.html"><img alt="Book Index" border="0" src="../gifs/index.gif" /></a></td><td align="right" valign="top" width="228">10.2. Microsoft Windows</td></tr></table><div>
<hr width="684" align="left" />

<img alt="Library Navigation Links" border="0" src="../gifs/navbar.gif" usemap="#library-map" />
<p><font size="-1"><a href="copyrght.html">Copyright &copy; 2002</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map"><area shape="rect" coords="1,0,84,90" href="../index.html" /><area shape="rect" coords="86,-7,176,90" href="../ssh/index.html" /><area shape="rect" coords="178,0,265,101" href="../tcp/index.html" /><area shape="rect" coords="266,0,333,90" href="../nfs/index.html" /><area shape="rect" coords="334,-1,429,93" href="../snmp/index.html" /><area shape="rect" coords="431,0,529,116" href="index.html" /><area shape="rect" coords="534,0,594,104" href="../dns/index.html" /><area shape="rect" coords="595,1,704,108" href="../fire/index-2.html" /></map>

</div></div></div></div></body>
<!-- Mirrored from nnc3.com/mags/Networking2/tshoot/ch10_01.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:54:58 GMT -->
</html>