<html>
<!-- Mirrored from nnc3.com/mags/Networking2/tcp/ch03_04.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:56:24 GMT -->
<head><title>Mail Services (TCP/IP Network Administration, 3rd Edition)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Craig Hunt" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="0596002971L" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="TCP/IP Network Administration, 3rd Edition" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img alt="Book Home" border="0" src="gifs/smbanner.gif" usemap="#banner-map" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.html" alt="TCP/IP Network Administration" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.html" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch03_03.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228" /><td align="right" valign="top" width="228"><a href="ch03_05.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr></table></div>



<h2 class="sect1">3.4. Mail Services</h2>

<p><a name="INDEX-597" />
<a name="INDEX-598" />Users
consider electronic mail the most important network service because
they use it for interpersonal communications. Some applications are
newer and fancier; others consume more network bandwidth; and others
are more important for the continued operation of the network. But
email is the application people use to communicate with each other.
It isn't very fancy, but it is vital.
</p>

<p>TCP/IP provides a reliable, flexible email system built on a few
basic protocols. These protocols are <em class="emphasis">Simple Mail Transfer
Protocol</em> (SMTP), <em class="emphasis">Post Office Protocol</em>
(POP), <em class="emphasis">Internet Message Access Protocol</em> (IMAP),
and <em class="emphasis">Multipurpose Internet Mail Extensions</em>
(MIME). There are other TCP/IP mail protocols that have some
interesting features, but they are not yet widely implemented.
</p>

<p>Our coverage concentrates on the four protocols you are most likely
to use building your network: SMTP, POP, IMAP, and MIME. We start
with SMTP, the foundation of all TCP/IP email systems.
</p>

<a name="tcp3-CHP-3-SECT-4.1" /><div class="sect2">
<h3 class="sect2">3.4.1. Simple Mail Transfer Protocol</h3>

<p><a name="INDEX-599" /> <a name="INDEX-600" />
<a name="INDEX-601" /> <a name="INDEX-602" />SMTP
<a name="INDEX-603" />is the TCP/IP mail
delivery protocol. It moves mail across the Internet and across your
local network. SMTP is defined in <a name="INDEX-604" />RFC 821, <em class="emphasis">A Simple Mail Transfer
Protocol</em>. It runs over the reliable, connection-oriented
service provided by <em class="emphasis">Transmission Control
Protocol</em> (TCP), and it uses well-known port number
<a name="INDEX-605" />25.<a href="#FOOTNOTE-23">[23]</a> <a href="ch03_04.html#tcp3-CHP-3-TABLE-1">Table 3-1</a> lists some of the simple,
human-readable commands used by <a name="INDEX-606" />
<a name="INDEX-607" />SMTP.
</p><blockquote class="footnote">
<a name="FOOTNOTE-23" /><p>[23]Most standard TCP/IP applications are assigned a well-known
port so that remote systems know how to connect the service.</p>
</blockquote>

<a name="tcp3-CHP-3-TABLE-1" /><h4 class="objtitle">Table 3-1. SMTP commands </h4><table border="1">




<tr>
<th>
<p>Command</p>
</th>
<th>
<p>Syntax</p>
</th>
<th>
<p>Function</p>
</th>
</tr>


<tr>
<td>
<p>Hello</p>
</td>
<td>
<p>HELO &lt;<em class="replaceable">sending-host&gt;</em></p>
&nbsp;
<p>EHLO &lt;<em class="replaceable">sending-host&gt;</em></p>
</td>
<td>
<p>Identify sending SMTP</p>
</td>
</tr>
<tr>
<td>
<p>From</p>
</td>
<td>
<p>MAIL FROM:&lt;<em class="replaceable">from-address&gt;</em></p>
</td>
<td>
<p>Sender address</p>
</td>
</tr>
<tr>
<td>
<p>Recipient</p>
</td>
<td>
<p>RCPT TO:&lt;<em class="replaceable">to-address&gt;</em></p>
</td>
<td>
<p>Recipient address</p>
</td>
</tr>
<tr>
<td>
<p>Data</p>
</td>
<td>
<p>DATA</p>
</td>
<td>
<p>Begin a message</p>
</td>
</tr>
<tr>
<td>
<p>Reset</p>
</td>
<td>
<p>RSET</p>
</td>
<td>
<p>Abort a message</p>
</td>
</tr>
<tr>
<td>
<p>Verify</p>
</td>
<td>
<p>VRFY &lt;<em class="replaceable">string&gt;</em></p>
</td>
<td>
<p>Verify a username</p>
</td>
</tr>
<tr>
<td>
<p>Expand</p>
</td>
<td>
<p>EXPN &lt;<em class="replaceable">string&gt;</em></p>
</td>
<td>
<p>Expand a mailing list</p>
</td>
</tr>
<tr>
<td>
<p>Help</p>
</td>
<td>
<p>HELP [<em class="replaceable">string</em>]</p>
</td>
<td>
<p>Request online help</p>
</td>
</tr>
<tr>
<td>
<p>Quit</p>
</td>
<td>
<p>QUIT</p>
</td>
<td>
<p>End the SMTP session</p>
</td>
</tr>

</table><p>

<p>SMTP is such a simple protocol you can literally do it yourself.
<tt class="literal">telnet</tt> to port 25 on a remote host and type mail
in from the command line using the SMTP commands. This technique is
sometimes used to test a remote system's SMTP server, but we
use it here to illustrate how mail is delivered between systems. The
example below shows mail that Daniel on
<em class="emphasis">rodent.wrotethebook.com</em> manually input and sent
to Tyler on <em class="emphasis">crab.wrotethebook.com</em>.
</p>

<blockquote><pre class="code">$ <b class="emphasis-bold">telnet crab 25</b>
Trying 172.16.12.1...
Connected to crab.wrotethebook.com.
Escape character is '^]'.
220 crab.wrotethebook.com ESMTP Sendmail 8.9.3+Sun/8.9.3; Thu, 19 Apr 2001 16:28:01-0400 (EDT)
<b class="emphasis-bold">HELO rodent.wrotethebook.com</b>
250 crab.wrotethebook.com Hello rodent [172.16.12.2], pleased to meet you 
<b class="emphasis-bold">MAIL FROM:&lt;daniel@rodent.wrotethebook.com&gt;</b>
250 &lt;daniel@rodent.wrotethebook.com&gt;... Sender ok
<b class="emphasis-bold">RCPT TO:&lt;tyler@crab.wrotethebook.com&gt;</b>
250 &lt;tyler@crab.wrotethebook.com&gt;... Recipient ok
<b class="emphasis-bold">DATA</b>
354 Enter mail, end with "." on a line by itself
<b class="emphasis-bold">Hi Tyler!</b>
.
250 QAA00316 Message accepted for delivery
<b class="emphasis-bold">QUIT</b>
221 crab.wrotethebook.com closing connection
Connection closed by foreign host. </pre></blockquote>

<p>The user input is shown in bold type. All of the other lines are
output from the system. This example shows how simple it is. A TCP
connection is opened. The sending system identifies itself. The
<em class="emphasis">From</em> address and the <em class="emphasis">To</em>
address are provided. The message transmission begins with the DATA
command <a name="INDEX-608" />and ends with a line
<a name="INDEX-609" />that contains
only a period (.). The session terminates with a QUIT command. Very
simple, and very few commands are used.
</p>

<p>There are other commands (SEND, SOML, SAML, and TURN) defined in RFC
821 that are optional and not widely implemented. Even some of the
commands that are implemented are not commonly used. The commands
HELP, VRFY, and EXPN are designed more for interactive use than for
the normal machine-to-machine interaction used by SMTP. The following
excerpt <a name="INDEX-610" />
<a name="INDEX-611" />from a SMTP session shows how these odd
commands work.
</p>

<blockquote><pre class="code"><b class="emphasis-bold">HELP</b>
214-This is Sendmail version 8.9.3+Sun
214-Topics:
214-    HELO    EHLO    MAIL    RCPT    DATA
214-    RSET    NOOP    QUIT    HELP    VRFY
214-    EXPN    VERB    ETRN    DSN
214-For more info use "HELP &lt;topic&gt;". 
214-For local information contact postmaster at this site. 
214 End of HELP info 
<b class="emphasis-bold">HELP RSET</b> 
214-RSET 
214-    Resets the system. 
214 End of HELP info 
<b class="emphasis-bold">VRFY &lt;jane&gt;</b> 
250 &lt;jane@brazil.wrotethebook.com&gt; 
<b class="emphasis-bold">VRFY &lt;mac&gt;</b> 
250 Kathy McCafferty &lt;&lt;mac&gt;&gt; 
<b class="emphasis-bold">EXPN &lt;admin&gt;</b> 
250-&lt;sara@horseshoe.wrotethebook.com&gt; 
250 David Craig &lt;&lt;david&gt;&gt;
250-&lt;tyler@wrotethebook.com&gt;</pre></blockquote>

<p><a name="INDEX-612" />The HELP
command prints out a summary of the commands implemented on the
system. The HELP RSET command specifically requests information about
the RSET command. Frankly, this help system isn't very helpful!
</p>

<p>The <a name="INDEX-613" />VRFY
and <a name="INDEX-614" />EXPN commands
are more useful but are often disabled for security reasons because
they provide user account information that might be exploited by
network intruders. The <tt class="literal">EXPN</tt>
<tt class="literal">&lt;admin&gt;</tt> command asks for a listing of the
email addresses in the mailing list <em class="emphasis">admin</em>, and
that is what the system provides. The VRFY command
<a name="INDEX-615" />asks for
information about an individual instead of a mailing list. In the
case of the <tt class="literal">VRFY</tt> <tt class="literal">&lt;mac&gt;</tt>
command, <em class="emphasis">mac</em> is a local user account, and the
user's account information is returned. In the case of
<tt class="literal">VRFY</tt> <tt class="literal">&lt;jane&gt;</tt>,
<em class="emphasis">jane</em> is an alias in the
<a name="INDEX-616" /><a name="INDEX-617" /><em class="emphasis">/etc/aliases</em> file. The
value returned is the email address for <em class="emphasis">jane</em>
found in that file. The three commands in this example are
interesting but rarely used. SMTP depends on the other commands to
get the real work done.
</p>

<p>SMTP provides direct end-to-end mail delivery. Other mail systems,
like UUCP <a name="INDEX-618" />and
X.400, use <em class="emphasis">store and forward</em> protocols
<a name="INDEX-619" /><a name="INDEX-620" />that move mail toward its destination
one hop at a time, storing the complete message at each hop and then
forwarding it on to the next system. The message proceeds in this
manner until final delivery is made. <a href="ch03_04.html#tcp3-CHP-3-FIG-3">Figure 3-3</a>
illustrates both store-and-forward and direct-delivery mail systems.
The UUCP address clearly shows the path that the mail takes to its
destination, while the SMTP mail address implies direct
delivery.<a href="#FOOTNOTE-24">[24]</a>
</p><blockquote class="footnote"> <a name="FOOTNOTE-24" /><p>[24]The address doesn't have anything to
do with whether a system is store and forward or direct delivery. It
just happens that UUCP provides an address that helps to illustrate
this point.</p> </blockquote>

<a name="tcp3-CHP-3-FIG-3" /><div class="figure"><img height="280" alt="Figure 3-3" src="figs/tcp3_0303.gif" width="456" /></div><h4 class="objtitle">Figure 3-3. Mail delivery systems</h4>

<p>Direct <a name="INDEX-621" />delivery allows SMTP to deliver mail
without relying on intermediate hosts. If the delivery fails, the
local system knows it right away. It can inform the user that sent
the mail or queue the mail for later delivery without reliance on
remote systems. The disadvantage of direct delivery is that it
requires both systems to be fully capable of handling mail. Some
systems cannot handle mail, particularly small systems such as PCs or
mobile systems such as laptops. These systems are usually shut down
at the end of the day and are frequently offline. Mail directed from
a remote host fails with a "cannot connect" error
<a name="INDEX-622" />
<a name="INDEX-623" />when the local system is turned off or
is offline. To handle these cases, features in the DNS system are
used to route the message to a mail server in lieu of direct
delivery. The mail is then moved from the server to the client system
when the client is back online. One of the protocols TCP/IP networks
use for this task <a name="INDEX-624" /> <a name="INDEX-625" /> <a name="INDEX-626" /> <a name="INDEX-627" />is POP.
</p>

</div>
<a name="tcp3-CHP-3-SECT-4.2" /><div class="sect2">
<h3 class="sect2">3.4.2. Post Office Protocol</h3>

<p><a name="INDEX-628" /> <a name="INDEX-629" />
<a name="INDEX-630" /> <a name="INDEX-631" />There
are two versions of Post Office Protocol: POP2 and POP3. POP2,
defined in RFC 937, uses port 109, and POP3, defined in RFC
1725<a name="INDEX-632" />,
uses port 110. These are incompatible protocols that use different
commands, although they perform the same basic functions. The POP
protocols verify the user's login name and password and move
the user's mail from the server to the user's local mail
reader. POP2 is rarely used anymore, so this section focuses on POP3.
</p>

<p>A sample POP3 session clearly illustrates how a POP protocol works.
POP3 is a simple request/response protocol, and just as with SMTP,
you can type POP3 commands directly into its well-known port (110)
and observe their effect. Here's an example with the user input
shown in bold type:
</p>

<blockquote><pre class="code">% <b class="emphasis-bold">telnet crab 110</b> 
Trying 172.16.12.1 ... 
Connected to crab.wrotethebook.com. 
Escape character is '^]'. 
+OK crab POP3 Server Process 3.3(1) at Mon 16-Apr-2001 4:48PM-EDT 
<b class="emphasis-bold">USER hunt</b> 
+OK User name (hunt) ok. Password, please. 
<b class="emphasis-bold">PASS Watts?Watt?</b> 
+OK 3 messages in folder NEWMAIL (V3.3 Rev B04) 
<b class="emphasis-bold">STAT</b> 
+OK 3 459 
<b class="emphasis-bold">RETR 1</b> 
+OK 146 octets   
<em class="emphasis">...The full text of message 1...</em> 
<b class="emphasis-bold">DELE 1</b>
+OK message # 1 deleted 
<b class="emphasis-bold">RETR 2</b> 
+OK 155 octets   
<em class="emphasis">...The full text of message 2...</em>
<b class="emphasis-bold">DELE 2</b>
+OK message # 2 deleted 
<b class="emphasis-bold">RETR 3</b> 
+OK 158 octets   
<em class="emphasis">...The full text of message 3...</em> 
<b class="emphasis-bold">DELE 3</b>
+OK message # 3 deleted 
<b class="emphasis-bold">QUIT</b> 
+OK POP3 crab Server exiting (0 NEWMAIL messages left) Connection closed by foreign host.</pre></blockquote>

<p>The USER
<a name="INDEX-633" />
<a name="INDEX-634" />command
<a name="INDEX-635" />provides
the username, and the <a name="INDEX-636" />PASS command provides the password for the
account of the mailbox that is being retrieved. (This is the same
username and password the user would use to log into the mail
server.) In response to the <a name="INDEX-637" />STAT command, the server sends a count of
the number of messages in the mailbox and the total number of bytes
contained in those messages. In the example, there are three messages
that contain a total of 459 bytes. <tt class="literal">RETR</tt>
<tt class="literal">1</tt> <a name="INDEX-638" />retrieves the full text of the first
message. <tt class="literal">DELE</tt> <tt class="literal">1</tt>
<a name="INDEX-639" />deletes
that message from the server. Each message is retrieved and deleted
in turn. The client ends the session with the
<a name="INDEX-640" />QUIT command.
Simple! <a href="ch03_04.html#tcp3-CHP-3-TABLE-2">Table 3-2</a> lists the full set of POP3
commands.
</p>

<a name="tcp3-CHP-3-TABLE-2" /><h4 class="objtitle">Table 3-2. POP3 commands </h4><table border="1">



<tr>
<th>
<p>Command</p>
</th>
<th>
<p>Function</p>
</th>
</tr>


<tr>
<td>
<p>USER <em class="emphasis">username</em></p>
</td>
<td>
<p>The user's account name</p>
</td>
</tr>
<tr>
<td>
<p>PASS <em class="emphasis">password</em></p>
</td>
<td>
<p>The user's password</p>
</td>
</tr>
<tr>
<td>
<p>STAT</p>
</td>
<td>
<p>Display the number of unread messages/bytes</p>
</td>
</tr>
<tr>
<td>
<p>RETR <em class="emphasis">n</em></p>
</td>
<td>
<p>Retrieve message number <em class="replaceable">n</em></p>
</td>
</tr>
<tr>
<td>
<p>DELE <em class="emphasis">n</em></p>
</td>
<td>
<p>Delete message number <em class="emphasis">n</em></p>
</td>
</tr>
<tr>
<td>
<p>LAST</p>
</td>
<td>
<p>Display the number of the last message accessed</p>
</td>
</tr>
<tr>
<td>
<p>LIST [<em class="emphasis">n</em>]</p>
</td>
<td>
<p>Display the size of message <em class="emphasis">n</em> or of all messages</p>
</td>
</tr>
<tr>
<td>
<p>RSET</p>
</td>
<td>
<p>Undelete all messages; reset message number to 1</p>
</td>
</tr>
<tr>
<td>
<p>TOP <em class="emphasis">n l</em></p>
</td>
<td>
<p>Print the headers and <em class="emphasis">l</em> lines of message
<em class="emphasis">n</em>
</p>
</td>
</tr>
<tr>
<td>
<p>NOOP</p>
</td>
<td>
<p>Do nothing</p>
</td>
</tr>
<tr>
<td>
<p>QUIT</p>
</td>
<td>
<p>End the POP3 session</p>
</td>
</tr>

</table><p>

<p>The retrieve (RETR) and delete (DELE) commands
<a name="INDEX-641" />
<a name="INDEX-642" />use message numbers that allow
messages to be processed in any order. Additionally, there is no
direct link between retrieving a message and deleting it. It is
possible to delete a message that has never been read or to retain a
message even after it has been read. However, POP clients do not
normally take advantage of these possibilities. On an average POP
server, the entire contents of the mailbox are moved to the client
and either deleted from the server or retained as if never read.
Deletion of individual messages on the client is not reflected on the
server because all of the messages are treated as a single unit that
is either deleted or retained after the initial transfer of data to
the client. Email clients that want to remotely maintain a mailbox on
the server are more likely to <a name="INDEX-643" /> <a name="INDEX-644" /> <a name="INDEX-645" /> <a name="INDEX-646" />use IMAP.
</p>

</div>
<a name="tcp3-CHP-3-SECT-4.3" /><div class="sect2">
<h3 class="sect2">3.4.3. Internet Message Access Protocol</h3>

<p>Internet Message Access Protocol (IMAP) is <a name="INDEX-647" /> <a name="INDEX-648" />
<a name="INDEX-649" /> <a name="INDEX-650" />an
alternative to POP. It provides the same basic service as POP and
adds features to support mailbox synchronization, which is the
ability to read individual mail messages on a client or directly on
the server while keeping the mailboxes on both systems completely up
to date. IMAP provides the ability to manipulate individual messages
on the client or the server and to have those changes reflected in
the mailboxes of both systems.
</p>

<p>IMAP uses TCP for reliable, sequenced data delivery. The IMAP port is
TCP
<a name="INDEX-651" />port
143.<a href="#FOOTNOTE-25">[25]</a> Like the POP protocol, IMAP is also a
request/response protocol with a small set of commands. The IMAP
command set is somewhat more complex than the one used by POP because
IMAP does more, yet there are still fewer than 25 IMAP commands.
<a href="ch03_04.html#tcp3-CHP-3-TABLE-3">Table 3-3</a> lists the basic set of IMAP commands as
<a name="INDEX-652" />
<a name="INDEX-653" />defined
in <a name="INDEX-654" />RFC 2060,
<em class="emphasis">Internet Message Access Protocol - Version
4rev1.</em>
</p><blockquote class="footnote"> <a name="FOOTNOTE-25" /><p>[25]The <em class="filename">/etc/services</em> file
lists two different ports for IMAP: 143 and 220. Port 220 is used by
IMAP 3. IMAP 4 uses port number 143, which is the same port used by
IMAP 2</p> </blockquote>

<a name="tcp3-CHP-3-TABLE-3" /><h4 class="objtitle">Table 3-3. IMAP4 commands </h4><table border="1">



<tr>
<th>
<p>Command</p>
</th>
<th>
<p>Function</p>
</th>
</tr>


<tr>
<td>
<p>CAPABILITY</p>
</td>
<td>
<p>List the features supported by the server</p>
</td>
</tr>
<tr>
<td>
<p>NOOP</p>
</td>
<td>
<p>Literally "No Operation"</p>
</td>
</tr>
<tr>
<td>
<p>LOGOUT</p>
</td>
<td>
<p>Close the connection</p>
</td>
</tr>
<tr>
<td>
<p>AUTHENTICATE</p>
</td>
<td>
<p>Request an alternate authentication method</p>
</td>
</tr>
<tr>
<td>
<p>LOGIN</p>
</td>
<td>
<p>Provide the username and password for plain-text authentication</p>
</td>
</tr>
<tr>
<td>
<p>SELECT</p>
</td>
<td>
<p>Open a mailbox</p>
</td>
</tr>
<tr>
<td>
<p>EXAMINE</p>
</td>
<td>
<p>Open a mailbox as read-only</p>
</td>
</tr>
<tr>
<td>
<p>CREATE</p>
</td>
<td>
<p>Create a new mailbox</p>
</td>
</tr>
<tr>
<td>
<p>DELETE</p>
</td>
<td>
<p>Remove a mailbox</p>
</td>
</tr>
<tr>
<td>
<p>RENAME</p>
</td>
<td>
<p>Change the name of a mailbox</p>
</td>
</tr>
<tr>
<td>
<p>SUBSCRIBE</p>
</td>
<td>
<p>Add a mailbox to the list of active mailboxes</p>
</td>
</tr>
<tr>
<td>
<p>UNSUBSCRIBE</p>
</td>
<td>
<p>Delete a mailbox name from the list of active mailboxes</p>
</td>
</tr>
<tr>
<td>
<p>LIST</p>
</td>
<td>
<p>Display the requested mailbox names from the set of all mailbox names</p>
</td>
</tr>
<tr>
<td>
<p>LSUB</p>
</td>
<td>
<p>Display the requested mailbox names from the set of active mailboxes</p>
</td>
</tr>
<tr>
<td>
<p>STATUS</p>
</td>
<td>
<p>Request the status of a mailbox</p>
</td>
</tr>
<tr>
<td>
<p>APPEND</p>
</td>
<td>
<p>Add a message to the end of the specified mailbox</p>
</td>
</tr>
<tr>
<td>
<p>CHECK</p>
</td>
<td>
<p>Force a checkpoint of the current mailbox</p>
</td>
</tr>
<tr>
<td>
<p>CLOSE</p>
</td>
<td>
<p>Close the mailbox and remove all messages marked for deletion</p>
</td>
</tr>
<tr>
<td>
<p>EXPUNGE</p>
</td>
<td>
<p>Remove from the current mailbox all messages marked for deletion</p>
</td>
</tr>
<tr>
<td>
<p>SEARCH</p>
</td>
<td>
<p>Display all messages in the mailbox that match the specified search
criterion
</p>
</td>
</tr>
<tr>
<td>
<p>FETCH</p>
</td>
<td>
<p>Retrieve a message from the mailbox</p>
</td>
</tr>
<tr>
<td>
<p>STORE</p>
</td>
<td>
<p>Modify a message in the mailbox</p>
</td>
</tr>
<tr>
<td>
<p>COPY</p>
</td>
<td>
<p>Copy the specified messages to the end of the specified mailbox</p>
</td>
</tr>
<tr>
<td>
<p>UID</p>
</td>
<td>
<p>Locate a message based on the message's unique identifier</p>
</td>
</tr>

</table><p>

<p>This command set clearly illustrates the "mailbox"
orientation of IMAP. The protocol is designed to remotely maintain
mailboxes that are stored on the server. The protocol commands show
that. Despite the increased complexity of the protocol, it is still
possible to run a simple test of
<a name="INDEX-655" />
<a name="INDEX-656" />your IMAP server using
<tt class="literal">telnet</tt> and a small number of the IMAP commands.
</p>

<blockquote><pre class="code">$ <b class="emphasis-bold">telnet localhost 143</b>
Trying 127.0.0.1...
Connected to rodent.wrotethebook.com.
Escape character is '^]'.
* OK rodent.wrotethebook.com IMAP4rev1 v12.252 server ready
a0001 <b class="emphasis-bold">LOGIN craig Wats?Watt?</b>
a0001 OK LOGIN completed
a0002 <b class="emphasis-bold">SELECT inbox</b>
* 3 EXISTS
* 0 RECENT
* OK [UIDVALIDITY 965125671] UID validity status
* OK [UIDNEXT 5] Predicted next UID
* FLAGS (\Answered \Flagged \Deleted \Draft \Seen)
* OK [PERMANENTFLAGS (\* \Answered \Flagged \Deleted \Draft \Seen)] Permanent flags
* OK [UNSEEN 1] first unseen message in /var/spool/mail/craig
a0002 OK [READ-WRITE] SELECT completed 
a0003 <b class="emphasis-bold">FETCH 1 BODY[TEXT]</b>
* 1 FETCH (BODY[TEXT] {1440}
<em class="emphasis">... an e-mail message that is 1440 bytes long ...</em>
* 1 FETCH (FLAGS (\Seen))
a0003 OK FETCH completed 
a0004 <b class="emphasis-bold">STORE 1 +FLAGS \DELETED</b>
* 1 FETCH (FLAGS (\Seen \Deleted))
a0004 OK STORE completed
a0005 <b class="emphasis-bold">CLOSE</b>
a0005 OK CLOSE completed
a0006 <b class="emphasis-bold">LOGOUT</b>
* BYE rodent.wrotethebook.com IMAP4rev1 server terminating connection
a0006 OK LOGOUT completed
Connection closed by foreign host.</pre></blockquote>

<p>The first three lines and the last line come from
<tt class="literal">telnet</tt>; all other messages come from IMAP. The
first IMAP command entered by the user is LOGIN, which provides the
username and password from <em class="filename">/etc/passwd</em> used to
authenticate this user. Notice that the command is preceded by the
string <tt class="literal">A0001</tt>. This is a <em class="emphasis">tag</em>,
which is a unique identifier generated by the client for each
command. Every command must start with a tag. When you manually type
in commands for a test, you are the source of the tags.
</p>

<p>IMAP is a mailbox-oriented protocol. The <a name="INDEX-657" />SELECT command selects the
mailbox that will be used. In the example, the user selects a mailbox
named "inbox". The IMAP server displays the status of the
mailbox, which contains three messages. Associated with each message
are a number of flags. The flags are used to manage the messages in
the mailbox by marking them as Seen, Unseen, Deleted, and so on.
</p>

<p>The <a name="INDEX-658" />FETCH command downloads a message from
the mailbox. In the example, the user downloads the text of the
message, which is what you normally see when reading a message. It is
possible, however, to download only the headers or flags.
</p>

<p>After the message is downloaded, the user deletes it. This is done by
writing the Deleted flag with the <a name="INDEX-659" />STORE command. The
<a name="INDEX-660" />DELETE
command is not used to delete messages; it deletes entire mailboxes.
Individual messages are marked for deletion by setting the Delete
flag. Messages with the Delete flag set are not deleted until either
the <a name="INDEX-661" />EXPUNGE command is issued or the mailbox
is explicitly closed with the <a name="INDEX-662" />CLOSE command, as is done in the example.
The session is then terminated with the <a name="INDEX-663" />LOGOUT command.
</p>

<p>Clearly, the IMAP protocol is more complex than POP; it is just about
at the limits of what can reasonably be typed in manually. Of course,
you don't really enter these commands manually. The desktop
system and the server exchange them automatically. They are shown
here only to give you a sense of the IMAP protocol. About the only
IMAP test you would ever do manually is to test if
<tt class="literal">imapd</tt> is up and running. To do that, you
don't even need to log in; if the server answers the
<tt class="literal">telnet</tt>, you know it is up and running. All you
then need to do is send the LOGOUT command to gracefully <a name="INDEX-664" /> <a name="INDEX-665" /> <a name="INDEX-666" /> <a name="INDEX-667" />close the
connection.
</p>

</div>
<a name="tcp3-CHP-3-SECT-4.4" /><div class="sect2">
<h3 class="sect2">3.4.4. Multipurpose Internet Mail Extensions</h3>

<p><a name="INDEX-668" /> <a name="INDEX-669" />
<a name="INDEX-670" /> <a name="INDEX-671" />The
last email protocol on our quick tour is <em class="emphasis">Multipurpose
Internet Mail Extensions</em> (MIME).<a href="#FOOTNOTE-26">[26]</a> As its
name implies, MIME is an extension of the existing TCP/IP mail
system, not a replacement for it. MIME is more concerned with what
the mail system delivers than with the mechanics of delivery. It
doesn't attempt to replace SMTP or TCP; it extends the
definition of what constitutes "mail."
</p><blockquote class="footnote"> <a name="FOOTNOTE-26" /><p>[26] MIME is
also an integral part of the Web and HTTP.</p> </blockquote>

<p>The structure of the mail message carried by SMTP is defined in
<a name="INDEX-672" />RFC 822,
<em class="emphasis">Standard for the Format of ARPA Internet Text
essages</em>. RFC 822 defines a set of mail headers that are
so widely accepted they are used by many mail systems that do not use
SMTP. This is a great benefit to email because it provides a common
ground for mail translation and delivery through gateways to
different mail networks. MIME extends RFC 822 into two areas not
covered by the original RFC:
</p>

<ul><li>
<p>Support for various data types. The mail system defined by RFC 821
and RFC 822 transfers only 7-bit ASCII data. This is suitable for
carrying text data composed of U.S. ASCII characters, but it does not
support several languages that have richer character sets, nor does
it support binary data transfer.
</p>
</li><li>
<p>Support for complex message bodies. RFC 822 doesn't provide a
detailed description of the body of an electronic message. It
concentrates on the mail headers.
</p>
</li></ul>
<p>MIME addresses these two weaknesses by defining encoding techniques
for carrying various forms of data and by defining a structure for
the message body that allows multiple objects to be carried in a
single message. <a name="INDEX-673" />RFC
1521, <em class="emphasis">Multipurpose Internet Mail Extensions Part One:
Format of Internet Message Bodies</em>, defines two
<a name="INDEX-674" />headers
that give structure to the mail message body and allow it to carry
various forms of data. These are the
<em class="emphasis">Content-Type</em> header and the
<em class="emphasis">Content-Transfer-Encoding</em> header.
</p>

<p>As the name implies, the <a name="INDEX-675" /><em class="emphasis">Content-Type</em> header
defines the type of data being carried in the message. The header has
a Subtype field that refines the definition. Many subtypes have been
defined since the original RFC was released. A current list of MIME
types can be obtained from the Internet.<a href="#FOOTNOTE-27">[27]</a> The original RFC
defines seven initial content types and a few subtypes:
</p><blockquote class="footnote"> <a name="FOOTNOTE-27" /><p>[27] Go to
<a href="ftp://ftp.isi.edu/in-notes/iana/assignments/media-types">ftp://ftp.isi.edu/in-notes/iana/assignments/media-types</a> to retrieve the file
<em class="emphasis">media-types</em>.</p> </blockquote>

<dl>
<dt><i><em class="emphasis">text</em></i></dt>
<dd>
<p><a name="INDEX-676" />Text data. RFC 1521 defines text subtypes
<em class="emphasis">plain</em> <a name="INDEX-677" />and
<em class="emphasis">richtext</em>.<a name="INDEX-678" /> More than 30 subtypes have since
been added, including <em class="emphasis">enriched</em>,
<em class="emphasis">xml</em> and <em class="emphasis">html</em>.
</p>
</dd>


<dt><i><em class="emphasis">application</em></i></dt>
<dd>
<p><a name="INDEX-679" /><a name="INDEX-680" />Binary data. The primary subtype defined in
RFC 1521 is
<em class="emphasis">octet-stream</em>,<a name="INDEX-681" /> which indicates the data is
a stream of 8-bit binary bytes. One other subtype,
<em class="emphasis">PostScript</em>,<a name="INDEX-682" /> is defined in the standard. Since
then more than 200 subtypes have been defined. They specify binary
data formatted for a particular application. For example,
<em class="emphasis">msword</em> is an application subtype.
</p>
</dd>


<dt><i><em class="emphasis">image</em></i></dt>
<dd>
<p><a name="INDEX-683" /><a name="INDEX-684" />Still graphic images. Two subtypes are
defined in RFC 1521: <em class="emphasis">jpeg</em> and
<em class="emphasis">gif</em>. More than 20 additional subtypes have since
been added, including widely used image data standards such as
<em class="emphasis">tiff</em>, <em class="emphasis">cgm</em>, and
<em class="emphasis">g3fax</em>.
</p>
</dd>


<dt><i><em class="emphasis">video</em></i></dt>
<dd>
<p><a name="INDEX-685" />Moving graphic images. The initially
defined subtype was <em class="emphasis">mpeg</em>,
<a name="INDEX-686" />which is a widely used standard for
computer video data. A few others have since been added, including
<em class="emphasis">quicktime</em>. <a name="INDEX-687" />
</p>
</dd>


<dt><i><em class="emphasis">audio</em></i></dt>
<dd>
<p><a name="INDEX-688" />Audio data. The only subtype initially
defined for audio was <em class="emphasis">basic</em>,
<a name="INDEX-689" />which means the sounds are encoded
using pulse code modulation (PCM). <a name="INDEX-690" /> <a name="INDEX-691" />About 20 additional audio
types, such as <em class="emphasis">MP4A-LATM</em>, have since been added.
</p>
</dd>


<dt><i><em class="emphasis">multipart</em></i></dt>
<dd>
<p><a name="INDEX-692" />Data composed of multiple independent
sections. A multipart message body is made up of several independent
parts. RFC 1521 defines four subtypes. The primary subtype is
<em class="emphasis">mixed</em>, <a name="INDEX-693" />which means that each part of the
message can be data of any content type. Other subtypes are
<em class="emphasis">alternative</em>, <a name="INDEX-694" />meaning that the same data
is repeated in each section in different formats;
<em class="emphasis">parallel</em>,<a name="INDEX-695" /> meaning that the data in the various
parts is to be viewed simultaneously; and
<em class="emphasis">digest</em>,<a name="INDEX-696" /> meaning that each section is data of
the type <em class="emphasis">message</em>. Several subtypes have since
been added, including support for voice messages
(<em class="emphasis">voice-message</em>) and
<em class="emphasis">encrypted</em> messages.
</p>
</dd>


<dt><i><em class="emphasis">message</em></i></dt>
<dd>
<p><a name="INDEX-697" /><a name="INDEX-698" /><a name="INDEX-699" />Data that is an encapsulated mail
message. RFC 1521 defines three subtypes. The primary subtype,
<em class="emphasis">rfc822</em>,<a name="INDEX-700" /> indicates that the data is a complete
RFC 822 mail message. The other subtypes,
<em class="emphasis">partial</em> <a name="INDEX-701" />and
<em class="emphasis">External-body</em>,<a name="INDEX-702" /> are both designed to handle
large messages. <em class="emphasis">partial</em> allows large
encapsulated messages to be split among multiple MIME messages.
<em class="emphasis">External-body</em> points to an external source for
the contents of a large message body so that only the pointer, not
the message itself, is contained in the MIME message. Two additional
subtypes that have been defined are <em class="emphasis">news</em>
<a name="INDEX-703" />for
carrying network news and <em class="emphasis">http</em>
<a name="INDEX-704" />for
HTTP traffic formatted to comply with MIME content typing.
</p>
</dd>

</dl>

<p><a name="INDEX-705" />
<a name="INDEX-706" />The
<em class="emphasis">Content-Transfer-Encoding</em> header identifies the
type of encoding used on the data. Traditional SMTP systems forward
only 7-bit ASCII data with a line length of less than 1000 bytes.
Since the data from a MIME system may be forwarded through gateways
that support only 7-bit ASCII, the data can be encoded. RFC 1521
defines six types of encoding. Some types are used to identify the
encoding inherent in the data. Only two types are actual encoding
techniques defined in the RFC. The six encoding types are:
</p>

<dl>
<dt><i><em class="emphasis">7bit</em></i></dt>
<dd>
<p><a name="INDEX-707" /><a name="INDEX-708" />U.S. ASCII data. No encoding is
performed on 7-bit ASCII data.
</p>
</dd>


<dt><i><em class="emphasis">8bit</em></i></dt>
<dd>
<p><a name="INDEX-709" /><a name="INDEX-710" />Octet data. No encoding is performed.
The data is binary, but the lines of data are short enough for SMTP
transport; i.e., the lines are less than 1000 bytes long.
</p>
</dd>


<dt><i><em class="emphasis">binary</em></i></dt>
<dd>
<p><a name="INDEX-711" /><a name="INDEX-712" />Binary data. No encoding is performed. The
data is binary and the lines may be longer than 1000 bytes. There is
no difference between <em class="emphasis">binary</em> and
<em class="emphasis">8bit</em> data except the line length restriction;
both types of data are unencoded byte (octet) streams. MIME does not
modify unencoded bitstream data.
</p>
</dd>


<dt><i><em class="emphasis">quoted-printable</em></i></dt>
<dd>
<p><a name="INDEX-713" /><a name="INDEX-714" />Encoded text data. This encoding
technique handles data that is largely composed of printable ASCII
text. The ASCII text is sent unencoded, while bytes with a value
greater than 127 or less than 33 are sent encoded as strings made up
of the equals sign followed by the hexadecimal value of the byte. For
example, the ASCII form feed character, which has the hexadecimal
value of 0C, is sent as <em class="emphasis">=0C</em>. Naturally,
there's more to it than this -- for example, the literal
equals sign has to be sent as <em class="emphasis">=3D</em>, and the
newline at the end of each line is not encoded. But this is the
general idea of how <em class="emphasis">quoted-printable</em> data is
sent.
</p>
</dd>


<dt><i><em class="emphasis">base64</em></i></dt>
<dd>
<p><a name="INDEX-715" /><a name="INDEX-716" />Encoded binary data. This encoding
technique can be used on any byte-stream data. Three octets of data
are encoded as four 6-bit characters, which increases the size of the
file by one-third. The 6-bit characters are a subset of U.S. ASCII,
chosen because they can be handled by any type of mail system. The
maximum line length for <em class="emphasis">base64</em> data is 76
characters. <a href="ch03_04.html#tcp3-CHP-3-FIG-4">Figure 3-4</a> illustrates this 3-to-4
encoding technique.
</p>
</dd>


<dt><i><em class="emphasis">x-token</em></i></dt>
<dd>
<p><a name="INDEX-717" />Specially encoded data. It is possible for
software developers to define their own private encoding techniques.
If they do so, the name of the encoding technique must begin with
<em class="emphasis">X-</em>. Doing this is strongly discouraged because
it limits interoperability between mail systems.
</p>
</dd>

</dl>

<a name="tcp3-CHP-3-FIG-4" /><div class="figure"><img height="242" alt="Figure 3-4" src="figs/tcp3_0304.gif" width="455" /></div><h4 class="objtitle">Figure 3-4. base64 encoding</h4>

<p>The number of supported data types and encoding techniques grows as
new data formats appear and are used in message transmissions. New
RFCs constantly define new data types and encoding. Read the latest
RFCs to keep up with MIME developments.
</p>

<p><a name="INDEX-718" />MIME defines data types that SMTP
was not designed to carry. To handle these and other future
requirements, <a name="INDEX-719" />RFC
1869, <em class="emphasis">SMTP Service Extensions</em>, defines a
technique for making SMTP <em class="emphasis">extensible</em>. The RFC
does not define new services for SMTP; in fact, the only service
extensions mentioned in the RFC are defined in other RFCs. What this
RFC does define is a simple mechanism for systems to negotiate which
SMTP extensions are supported. The RFC defines a new
<em class="emphasis">hello</em> <a name="INDEX-720" /><a name="INDEX-721" />command (EHLO) and the legal responses
to that command. One response is for the receiving system to return a
list of the SMTP extensions it supports. This response allows the
sending system to know what extended services can be used, and to
avoid those that are not implemented on the remote system. SMTP
implementations that support the EHLO command are called Extended
SMTP (ESMTP). <a name="INDEX-722" /> <a name="INDEX-723" /><a name="INDEX-724" /><a name="INDEX-725" />
</p>

<p>Several ESMTP service extensions have been defined for MIME mailers.
<a href="ch03_04.html#tcp3-CHP-3-TABLE-4">Table 3-4</a> lists some of these. The table lists the
EHLO keyword associated with each extension, the number of the RFC
that defines it, and its purpose. These service extensions are just
an example. Other have been <a name="INDEX-726" /> <a name="INDEX-727" />defined to support SMTP
enhancements.
</p>

<a name="tcp3-CHP-3-TABLE-4" /><h4 class="objtitle">Table 3-4. SMTP service extensions </h4><table border="1">




<tr>
<th>
<p>Keyword</p>
</th>
<th>
<p>RFC</p>
</th>
<th>
<p>Function </p>
</th>
</tr>


<tr>
<td>
<p>8BITMIME</p>
</td>
<td>
<p>1652</p>
</td>
<td>
<p>Accept 8bit binary data</p>
</td>
</tr>
<tr>
<td>
<p>CHUNKING</p>
</td>
<td>
<p>1830</p>
</td>
<td>
<p>Accept messages cut into chunks</p>
</td>
</tr>
<tr>
<td>
<p>CHECKPOINT</p>
</td>
<td>
<p>1845</p>
</td>
<td>
<p>Checkpoint/restart mail transactions</p>
</td>
</tr>
<tr>
<td>
<p>PIPELINING</p>
</td>
<td>
<p>1854</p>
</td>
<td>
<p>Accept multiple commands in a single send</p>
</td>
</tr>
<tr>
<td>
<p>SIZE</p>
</td>
<td>
<p>1870</p>
</td>
<td>
<p>Display maximum acceptable message size</p>
</td>
</tr>
<tr>
<td>
<p>DSN</p>
</td>
<td>
<p>1891</p>
</td>
<td>
<p>Provide delivery status notifications</p>
</td>
</tr>
<tr>
<td>
<p>ETRN</p>
</td>
<td>
<p>1985</p>
</td>
<td>
<p>Accept remote queue processing requests</p>
</td>
</tr>
<tr>
<td>
<p>ENHANCEDSTATUSCODES</p>
</td>
<td>
<p>2034</p>
</td>
<td>
<p>Provide enhanced error codes</p>
</td>
</tr>
<tr>
<td>
<p>STARTTLS</p>
</td>
<td>
<p>2487</p>
</td>
<td>
<p>Use Transport Layer Security to encrypt the email exchange</p>
</td>
</tr>
<tr>
<td>
<p>AUTH</p>
</td>
<td>
<p>2554</p>
</td>
<td>
<p>Use strong authentication to identify the email source</p>
</td>
</tr>

</table><p>

<p>It is easy to check which extensions are supported by your server by
using the <tt class="literal">EHLO</tt> command. The following example is
from a generic Solaris 8 system, which comes with sendmail 8.9.3:
</p>

<blockquote><pre class="code">&gt; <b class="emphasis-bold">telnet localhost 25</b> 
Trying 127.0.0.1... 
Connected to localhost. 
Escape character is '^]'. 
220 crab.wrotethebook.com ESMTP Sendmail 8.9.3+Sun/8.9.3; Mon, 23 Apr 2001 11:00:35-0400 (EDT)
<b class="emphasis-bold">EHLO crab</b> 
250-crab.wrotethebook.com Hello localhost [127.0.0.1], pleased to meet you
250-EXPN 
250 HELP 
250-8BITMIME 
250-SIZE 
250-DSN 
250-ETRN 
250-VERB 
250-ONEX 
250-XUSR
<b class="emphasis-bold">QUIT</b> 
221 crab.foobirds.org closing connection
Connection closed by foreign host.</pre></blockquote>

<p>The sample system lists nine commands in response to the EHLO
greeting. Two of these, EXPN <a name="INDEX-728" /><a name="INDEX-729" />and HELP,
are standard SMTP commands that aren't implemented on all
systems (the standard commands are listed in <a href="ch03_04.html#tcp3-CHP-3-TABLE-1">Table 3-1</a>). 8BITMIME, SIZE, DSN, and ETRN are ESMTP
extensions, all of which are described in <a href="ch03_04.html#tcp3-CHP-3-TABLE-4">Table 3-4</a>. The last three keywords in the response are
VERB, ONEX, and XUSR. All of these are specific to sendmail version
8. None is defined in an RFC. VERB <a name="INDEX-730" />simply places the sendmail server in
verbose mode. ONEX <a name="INDEX-731" />limits the session to a single message
transaction. XUSR is equivalent to the <tt class="literal">-U</tt> sendmail
command-line argument.<a href="#FOOTNOTE-28">[28]</a> As the last three keywords indicate,
the RFCs allow for <a name="INDEX-732" />private ESMTP extensions.
<a name="INDEX-733" /><a name="INDEX-734" />
</p><blockquote class="footnote"> <a name="FOOTNOTE-28" /><p>[28] See <a href="appe_01.html">Appendix E, "A sendmail Reference"</a> for a list of the sendmail command-line
arguments.</p> </blockquote>

<p>The specific extensions implemented on each system are different. For
example, on a generic Solaris 2.5.1
<a name="INDEX-735" />system, only three keywords (EXPN,
SIZE, and HELP) are displayed in response to EHLO. The extensions
available depend on the version of sendmail that is running and on
how sendmail is configured.<a href="#FOOTNOTE-29">[29]</a> The purpose of EHLO is to identify these
differences at the beginning of the SMTP mail exchange.
</p><blockquote class="footnote"> <a name="FOOTNOTE-29" /><p>[29] See <a href="ch10_01.html">Chapter 10, "sendmail "</a> for the details of sendmail configuration.
</p> </blockquote>

<p>ESMTP and MIME are important because they provide a standard way to
transfer non-ASCII data through email. Users share lots of
application-specific data that is not 7-bit ASCII. Many users depend
on email as a file transfer mechanism.
</p>

<p>SMTP, POP, IMAP, and MIME are essential parts of the mail system, but
other email protocols may also be essential in the future. The one
certainty is that the network will continue to change. You need to
track current developments and include helpful technologies in your
planning. Two technologies that users find helpful are file sharing
and printer sharing. In the next section we look at file and print
<a name="INDEX-736" />
<a name="INDEX-737" />
<a name="INDEX-738" />
<a name="INDEX-739" />servers. 
</p>

</div>


<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch03_03.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228"><a href="index.html"><img alt="Home" border="0" src="../gifs/txthome.gif" /></a></td><td align="right" valign="top" width="228"><a href="ch03_05.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr><tr><td align="left" valign="top" width="228">3.3. DNS</td><td align="center" valign="top" width="228"><a href="index/index.html"><img alt="Book Index" border="0" src="../gifs/index.gif" /></a></td><td align="right" valign="top" width="228">3.5. File and Print Servers</td></tr></table></div>
<hr width="684" align="left" />

<img alt="Library Navigation Links" border="0" src="../gifs/navbar.gif" usemap="#library-map" />
<p><p><font size="-1"><a href="copyrght.html">Copyright &copy; 2002</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map"><area shape="rect" coords="1,0,84,90" href="../index.html" /><area shape="rect" coords="86,-7,176,90" href="../ssh/index.html" /><area shape="rect" coords="178,0,265,101" href="index.html" /><area shape="rect" coords="266,0,333,90" href="../nfs/index.html" /><area shape="rect" coords="334,-1,429,93" href="../snmp/index.html" /><area shape="rect" coords="431,0,529,116" href="../tshoot/index.html" /><area shape="rect" coords="534,0,594,104" href="../dns/index.html" /><area shape="rect" coords="595,1,704,108" href="../fire/index-2.html" /></map>

</body>
<!-- Mirrored from nnc3.com/mags/Networking2/tcp/ch03_04.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:56:25 GMT -->
</html>