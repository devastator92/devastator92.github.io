<html>
<!-- Mirrored from nnc3.com/mags/Networking2/tcp/ch10_05.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:56:29 GMT -->
<head><title>sendmail.cf Configuration Language  (TCP/IP Network Administration, 3rd Edition)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Craig Hunt" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="0596002971L" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="TCP/IP Network Administration, 3rd Edition" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img alt="Book Home" border="0" src="gifs/smbanner.gif" usemap="#banner-map" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.html" alt="TCP/IP Network Administration" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.html" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch10_04.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228" /><td align="right" valign="top" width="228"><a href="ch10_06.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr></table></div>



<h2 class="sect1">10.5. sendmail.cf Configuration Language </h2>

<p>Every time sendmail
<a name="INDEX-2157" />
<a name="INDEX-2158" />starts
up, it reads <em class="emphasis">sendmail.cf</em>. For this reason, the
syntax of the <em class="emphasis">sendmail.cf</em> commands is designed
to be easy for sendmail to parse -- not necessarily easy for
humans to read. As a consequence, sendmail commands are very terse,
even by Unix standards.
</p>

<p>The configuration command is not separated from its variable or value
by any spaces. This "run together" format makes the
commands hard to read. <a href="ch10_05.html#tcp3-CHP-10-FIG-2">Figure 10-2</a> illustrates the
format of a command. In the figure, a define macro command assigns
the value <em class="emphasis">wrotethebook.com</em> to the macro D.
</p>

<a name="tcp3-CHP-10-FIG-2" /><div class="figure"><img height="75" alt="Figure 10-2" src="figs/tcp3_1002.gif" width="306" /></div><h4 class="objtitle">Figure 10-2. A sendmail.cf configuration command</h4>

<p>Starting with version 8 of sendmail, variable names are no longer
restricted to a single character. Long variable names, enclosed in
braces, are now acceptable. For example, the
<tt class="literal">define</tt> macro shown in <a href="ch10_05.html#tcp3-CHP-10-FIG-2">Figure 10-2</a>
could be written:
</p>

<blockquote><pre class="code">D{Domain}wrotethebook.com</pre></blockquote>

<p>Long variable names are easier to read and provide for more choices
than the limited set provided by single character names. However, the
old-fashioned, short variable names are still common. This terse
syntax can be very hard to decipher, but it helps to remember that
the first character on the line is always the command. From this
single character you can determine what the command is and therefore
its structure. <a href="ch10_05.html#tcp3-CHP-10-TABLE-1">Table 10-1</a> lists the
<em class="emphasis">sendmail.cf</em> commands
<a name="INDEX-2159" />and their syntax.
</p>

<a name="tcp3-CHP-10-TABLE-1" /><h4 class="objtitle">Table 10-1. sendmail configuration commands </h4><table border="1">




<tr>
<th>
<p>Command</p>
</th>
<th>
<p>Syntax</p>
</th>
<th>
<p>Function</p>
</th>
</tr>


<tr>
<td>
<p>Version Level</p>
</td>
<td>
<p>V<em class="emphasis">level</em>[/<em class="emphasis">vendor</em>]</p>
</td>
<td>
<p>Specify version level.</p>
</td>
</tr>
<tr>
<td>
<p>Define Macro</p>
</td>
<td>
<p>D<em class="emphasis">xvalue</em></p>
</td>
<td>
<p>Set macro <em class="emphasis">x</em> to <em class="emphasis">value</em>.</p>
</td>
</tr>
<tr>
<td>
<p>Define Class</p>
</td>
<td>
<p>C<em class="emphasis">cword1</em>[ <em class="emphasis">word2</em>] ...</p>
</td>
<td>
<p>Set class <em class="emphasis">c</em> to <em class="emphasis">word1</em>
<em class="emphasis">word2</em> ....
</p>
</td>
</tr>
<tr>
<td>
<p>Define Class</p>
</td>
<td>
<p>F<em class="emphasis">cfile</em></p>
</td>
<td>
<p>Load class <em class="emphasis">c</em> from <em class="emphasis">file</em>.</p>
</td>
</tr>
<tr>
<td>
<p>Set Option</p>
</td>
<td>
<p>O<em class="emphasis">option</em>=<em class="emphasis">value</em></p>
</td>
<td>
<p>Set <em class="emphasis">option</em> to <em class="emphasis">value</em>.</p>
</td>
</tr>
<tr>
<td>
<p>Trusted Users</p>
</td>
<td>
<p>T<em class="emphasis">user1</em>[ <em class="emphasis">user2</em> ...]</p>
</td>
<td>
<p>Trusted users are <em class="emphasis">user1</em>
<em class="emphasis">user2</em> ....
</p>
</td>
</tr>
<tr>
<td>
<p>Set Precedence</p>
</td>
<td>
<p>P<em class="emphasis">name</em>=<em class="emphasis">number</em></p>
</td>
<td>
<p>Set <em class="emphasis">name</em> to precedence
<em class="emphasis">number</em>.
</p>
</td>
</tr>
<tr>
<td>
<p>Define Mailer</p>
</td>
<td>
<p>M<em class="emphasis">name</em>,
{<em class="emphasis">field</em>=<em class="emphasis">value</em>}
</p>
</td>
<td>
<p>Define mailer <em class="emphasis">name</em>.</p>
</td>
</tr>
<tr>
<td>
<p>Define Header</p>
</td>
<td>
<p>H[?<em class="emphasis">mflag</em>?]<em class="emphasis">name</em>:<em class="emphasis">format</em>
</p>
</td>
<td>
<p>Set header format.</p>
</td>
</tr>
<tr>
<td>
<p>Set Ruleset</p>
</td>
<td>
<p>S<em class="emphasis">n</em></p>
</td>
<td>
<p>Start ruleset number <em class="emphasis">n</em>.</p>
</td>
</tr>
<tr>
<td>
<p>Define Rule</p>
</td>
<td>
<p>R<em class="emphasis">lhs</em> <em class="emphasis">rhs</em>
<em class="emphasis">comment</em>
</p>
</td>
<td>
<p>Rewrite <em class="emphasis">lhs</em> patterns to <em class="emphasis">rhs</em>
format.
</p>
</td>
</tr>
<tr>
<td>
<p>Key File</p>
</td>
<td>
<p>K<em class="emphasis">name</em> <em class="emphasis">type</em>
[<em class="emphasis">argument</em>]
</p>
</td>
<td>
<p>Define database <em class="emphasis">name</em>.</p>
</td>
</tr>

</table><p>

<p>The following sections describe each configuration command in more
detail.
</p>

<a name="tcp3-CHP-10-SECT-5.1" /><div class="sect2">
<h3 class="sect2">10.5.1. The Version Level Command </h3>

<p>The version level
<a name="INDEX-2160" />
<a name="INDEX-2161" /> <a name="INDEX-2162" />command is an optional
command not found in all <em class="emphasis">sendmail.cf</em> files. You
don't add a <tt class="literal">V</tt><a name="INDEX-2163" /> command to the
<em class="emphasis">sendmail.cf</em> file or change one if it is already
there. The <tt class="literal">V</tt> command is inserted into the
configuration file when it is first built from <tt class="literal">m4</tt>
macros or by the vendor.
</p>

<p>The <em class="replaceable">level</em> number on the
<tt class="literal">V</tt> command line indicates the version level of the
configuration syntax. V1 is the oldest configuration syntax and V9 is
the version supported by sendmail 8.11.3. Every level in between adds
some feature extensions. The <em class="replaceable">vendor</em> part
of the <tt class="literal">V</tt> command identifies if any vendor-specific
syntax is supported. The default <em class="replaceable">vendor</em>
value for the sendmail distribution is Berkeley.
</p>

<p>The <tt class="literal">V</tt> command tells the sendmail executable the
level of syntax and commands required to support this configuration.
If the sendmail program cannot support the requested commands and
syntax, it displays the following error message:
</p>

<blockquote><pre class="code"># <b class="emphasis-bold">/usr/lib/sendmail -Ctest.cf</b> 
Warning: .cf version level (9) exceeds sendmail version 8.9.3+Sun functionality (8): 
Operation not permitted</pre></blockquote>

<p>This error message indicates that this sendmail program supports
level 8 configuration files with Sun syntax extensions.<a href="#FOOTNOTE-117">[117]</a> The example was produced on a Solaris 8
system running the sendmail program that came with the operating
system. In the example we attempted to read a configuration file that
was created by the <tt class="literal">m4</tt> macros that came with
sendmail 8.11.3. The syntax and functions needed by the configuration
file are not available in the sendmail program. To use this
configuration file, we would have to compile a newer version of the
sendmail program. See <a href="appe_01.html">Appendix E, "A sendmail Reference"</a> for an example of
compiling sendmail.
</p><blockquote class="footnote">
<a name="FOOTNOTE-117" /><p>[117]See <a href="ch10_06.html#tcp3-CHP-10-TABLE-4">Table 10-4</a> for Sun-specific
syntax.</p> </blockquote>

<p>You will never change the values on a <tt class="literal">V</tt> command.
You might, however, need to customize some <tt class="literal">D</tt>
commands.
</p>

</div>
<a name="tcp3-CHP-10-SECT-5.2" /><div class="sect2">
<h3 class="sect2">10.5.2. The Define Macro Command </h3>

<p>The define macro
<a name="INDEX-2164" />
<a name="INDEX-2165" /> <a name="INDEX-2166" /> <a name="INDEX-2167" />command
(<tt class="literal">D</tt>) defines a macro and stores a value in it. Once
the macro is defined, it is used to provide the stored value to other
<em class="emphasis">sendmail.cf</em> commands and directly to sendmail
itself. This allows sendmail configurations to be shared by many
systems simply by modifying a few system-specific macros.
</p>

<p>A macro name can be any single ASCII character or a word enclosed in
curly braces. Use long names for user-created macros.
sendmail's own internal macros use most of the available
letters and special characters as names. Additionally, a large number
of long macro names are already defined. This does not mean that you
won't be called upon to name a macro, but it does mean you will
have to be careful that your name doesn't conflict with a name
that has already been used. Internal macros are sometimes defined in
the <em class="emphasis">sendmail.cf</em> file. <a href="appe_01.html">Appendix E, "A sendmail Reference"</a> provides a complete list of sendmail's
internal macros. Refer to that list when creating a user-defined
macro to avoid conflicting with an internal macro. To retrieve the
value stored in a macro, reference it as
<tt class="literal">$</tt><em class="replaceable">x</em>, where
<em class="emphasis">x</em> is the macro name. Macros are expanded when
the <em class="emphasis">sendmail.cf</em> file is read. A special syntax,
<tt class="literal">$&amp;</tt><em class="replaceable">x</em>, is used to
expand macros when they are referenced. The
<tt class="literal">$&amp;</tt><em class="replaceable">x</em> syntax is only
used with certain internal macros that change at runtime.
</p>

<p>The code below defines the macros <tt class="literal">{our-host}</tt>, M,
and Q. After this code executes, <tt class="literal">${our-host}</tt>
returns <em class="emphasis">crab</em>, <tt class="literal">$M</tt> returns
<em class="emphasis">wrotethebook.com</em>, and <tt class="literal">$Q</tt>
returns <em class="emphasis">crab.wrotethebook.com</em>. This sample code
defines Q as containing the value of <tt class="literal">{our-host}</tt>
(which is <tt class="literal">${our-host}</tt>), plus a literal dot, plus
the value of M (<tt class="literal">$M</tt>).
</p>

<blockquote><pre class="code">D{our-host}crab 
DMwrotethebook.com
DQ${our-host}.$M</pre></blockquote>

<p>If you customize your <em class="emphasis">sendmail.cf</em> file, it will
probably be necessary to modify some macro definitions. The macros
that usually require modification define site-specific information,
such as hostnames and domain names.
</p>

<a name="tcp3-CHP-10-SECT-5.2.1" /><div class="sect3">
<h3 class="sect3">10.5.2.1. Conditionals </h3>

<p>A macro definition can
<a name="INDEX-2168" />
<a name="INDEX-2169" />
<a name="INDEX-2170" />contain a conditional. Here's a
conditional:
</p>

<blockquote><pre class="code"> DX$g$?x ($x)$.</pre></blockquote>

<p>The <tt class="literal">D</tt> is the define macro command;
<tt class="literal">X</tt> is the macro being defined; and
<tt class="literal">$g</tt> says to use the value stored in macro
<tt class="literal">g</tt>. But what does <tt class="literal">$?x ($x)$.</tt>
mean? The construct <tt class="literal">$?x</tt> is a conditional. It tests
whether macro <tt class="literal">x</tt> has a value set. If the macro has
been set, the text following the conditional is interpreted. The
<tt class="literal">$</tt>. construct ends the conditional.
</p>

<p>Given this, the assignment of macro <tt class="literal">X</tt> is
interpreted as follows: <tt class="literal">X</tt> is assigned the value of
<tt class="literal">g</tt>; and if <tt class="literal">x</tt> is set,
<tt class="literal">X</tt> is also assigned a literal blank, a literal left
parenthesis, the value of <tt class="literal">x</tt>, and a literal right
parenthesis.
</p>

<p>So if <tt class="literal">g</tt> contains
<em class="emphasis">chunt@wrotethebook.com</em> and <tt class="literal">x</tt>
contains <em class="emphasis">Craig Hunt</em>, <tt class="literal">X</tt> will
contain:
</p>

<blockquote><pre class="code"> chunt@wrotethebook.com (Craig Hunt)</pre></blockquote>

<p>The conditional can be used with an "else" construct,
which is <tt class="literal">$|</tt>. The full syntax of the conditional
is:
</p>

<blockquote><pre class="code"> $?<em class="replaceable">x text1</em> $| <em class="replaceable">text2</em> $.</pre></blockquote>

<p>This is interpreted as:</p>

<ul><li>
<p>if (<tt class="literal">$?</tt>) <em class="replaceable">x</em> is set;</p>
</li><li>
<p>use <em class="replaceable">text1</em>;</p>
</li><li>
<p>else (<tt class="literal">$|</tt>);</p>
</li><li>
<p>use <em class="replaceable">text2</em>;</p>
</li><li>
<p>end if (<tt class="literal">$.</tt>).</p>
</li></ul>
</div>
</div>
<a name="tcp3-CHP-10-SECT-5.3" /><div class="sect2">
<h3 class="sect2">10.5.3. Defining Classes </h3>

<p>Two commands, <tt class="literal">C</tt> and <tt class="literal">F</tt>, define
sendmail classes. A class
<a name="INDEX-2171" />
<a name="INDEX-2172" /> <a name="INDEX-2173" /> <a name="INDEX-2174" /> <a name="INDEX-2175" />is similar
<a name="INDEX-2176" />to
an array of values. Classes are used for anything with multiple
values that are handled in the same way, such as multiple names for
the local host or a list of <tt class="literal">uucp</tt> hostnames.
Classes allow sendmail to compare against a list of values instead of
against a single value. Special pattern matching symbols are used
with classes. The <tt class="literal">$=</tt> symbol matches any value in a
class, and the <tt class="literal">$~</tt> symbol matches any value not in
a class. (More on pattern matching later.)
</p>

<p>Like macros, classes can have single-character names or long names
enclosed in curly braces. User-created classes use long names that do
not conflict with sendmail's internal names. (See <a href="appe_01.html">Appendix E, "A sendmail Reference"</a> for a complete list of the names that sendmail
uses for its internal class values.) Class values can be defined on a
single line, on multiple lines, or loaded from a file. For example,
class w is used to define all of the hostnames by which the local
host is known. To assign class w the values
<em class="emphasis">goober</em> and <em class="emphasis">pea</em>, you can
enter the values on a single line:
</p>

<blockquote><pre class="code">Cwgoober pea</pre></blockquote>

<p>Or you can enter the values on multiple lines:</p>

<blockquote><pre class="code">Cwgoober
Cwpea</pre></blockquote>

<p>You can also use the <tt class="literal">F</tt> command to load the class
values from a file. The <tt class="literal">F</tt> command reads a file and
stores the words found there in a class variable. For example, to
define class w and assign it all of the strings found in
<em class="emphasis">/etc/mail/local-host-names</em>, use:<a href="#FOOTNOTE-118">[118]</a>
</p><blockquote class="footnote">
<a name="FOOTNOTE-118" /><p>[118]sendmail 8.11 uses
<em class="emphasis">/etc/mail/local-host-names</em> to load class w.
Earlier versions of sendmail used
<em class="emphasis">/etc/sendmail.cw</em>. Only the name has changed; the
file still contains a list of hostnames.</p> </blockquote>

<blockquote><pre class="code"> Fw/etc/mail/local-host-names</pre></blockquote>

<p>You may need to modify a few class definitions when creating your
<em class="emphasis">sendmail.cf</em> file. Frequently information
relating to <tt class="literal">uucp</tt>, to alias hostnames, and to
special domains for mail routing is defined in class statements. If
your system has a <tt class="literal">uucp</tt> connection as well as a
TCP/IP connection, pay particular attention to the class definitions.
But in any case, check the class definitions carefully and make sure
they apply to your configuration.
</p>

<p>Here we <tt class="literal">grep</tt> the Linux sample configuration file
for lines beginning with <tt class="literal">C</tt> or
<tt class="literal">F</tt>:
</p>

<blockquote><pre class="code">% <b class="emphasis-bold">grep '^[CF]' generic-linux.cf</b> 
Cwlocalhost 
Fw/etc/mail/local-host-names
CP.	
CO @ % !
C..
C[[
FR-o /etc/mail/relay-domains
C{E}root
CPREDIRECT</pre></blockquote>

<p>This <tt class="literal">grep</tt> shows that
<em class="emphasis">generic-linux.cf</em> defines classes w, P, O, ., [,
R, and E. w contains the host's alias hostnames. Notice that
values are stored in w with both a <tt class="literal">C</tt> command and
an <tt class="literal">F</tt> command. Unlike a <tt class="literal">D</tt>
command, which overwrites the value stored in a macro, the commands
that store values in class arrays are additive. The
<tt class="literal">C</tt> command and the <tt class="literal">F</tt> command at
the start of this listing add values to class w. Another example of
the additive nature of <tt class="literal">C</tt> commands is class P. P
holds pseudo-domains used for mail routing. The first
<tt class="literal">C</tt> command affecting class P stores a dot in the
array. The last command in the list adds REDIRECT to class P.
</p>

<p>Class O stores operators that cannot be part of a valid username. The
classes <tt class="literal">.</tt> (dot) and <tt class="literal">[</tt> are
primarily of interest because they show that variable names do not
have to be alphabetic characters and that sometimes arrays have only
one value. E lists the usernames that should always be associated
with the local host's fully qualified domain name, even if
simplified email addresses are being used for all other users. (More
on simplified addresses later.) Notice that even a single character
class name, in this case E, can be enclosed in curly braces.
</p>

<p>Remember that your system will be different. These same class names
may be assigned other values on your system, and are only presented
here as an example. Carefully read the comments in your
<em class="emphasis">sendmail.cf</em> file for guidance as to how classes
and macros are used in your configuration.
</p>

<p>Many class names are reserved for internal sendmail use. All internal
classes defined in sendmail version 8.11 are shown in <a href="appe_01.html">Appendix E, "A sendmail Reference"</a>. Only class w, which defines all of the
hostnames the system will accept as its own, is commonly modified by
system administrators who directly configure the
<em class="emphasis">sendmail.cf</em> file.
</p>

</div>
<a name="tcp3-CHP-10-SECT-5.4" /><div class="sect2">
<h3 class="sect2">10.5.4. Setting Options </h3>

<p>The option
<a name="INDEX-2177" />
<a name="INDEX-2178" /> <a name="INDEX-2179" /> <a name="INDEX-2180" />(<tt class="literal">O</tt>)
command is used to define the sendmail environment. Use the
<tt class="literal">O</tt> command to set values appropriate for your
installation. The value assigned to an option is a string, an
integer, a Boolean, or a time interval, as appropriate for the
individual option. All options define values used directly by
sendmail.
</p>

<p>There are no user-created options. The meaning of each sendmail
option is defined within sendmail itself. <a href="appe_01.html">Appendix E, "A sendmail Reference"</a> lists the meaning and use of each option, and
there are plenty of them.
</p>

<p>A few sample options from the <em class="emphasis">generic-linux.cf</em>
file are shown below. The
<tt class="literal">AliasFile</tt><a name="INDEX-2181" /> option defines the name of the
sendmail <em class="emphasis">aliases</em> file as
<em class="emphasis">/etc/mail/aliases</em>. If you want to put the
<em class="emphasis">aliases</em> file elsewhere, change this option. The
<a name="INDEX-2182" />TempFileMode option defines the
default file mode as <tt class="literal">0600</tt> for temporary files
created by sendmail in <em class="emphasis">/var/spool/mqueue</em>. The
<a name="INDEX-2183" />Timeout.queuereturn option sets the
timeout interval for undeliverable mail, here set to five days
(<tt class="literal">5d</tt>). These options show the kind of general
configuration parameters set by the option command.
</p>

<blockquote><pre class="code"># location of alias file 
O AliasFile=/etc/mail/aliases 
# temporary file mode 
O TempFileMode=0600 
# default timeout interval
O Timeout.queuereturn=5d</pre></blockquote>

<p>The syntax of the option command shown in this example and in <a href="appe_01.html">Appendix E, "A sendmail Reference"</a> was introduced in sendmail version 8.7.5.
Prior to that, the option command used a syntax more like the other
sendmail commands. The old syntax is:
<tt class="literal">O</tt><em class="replaceable">ovalue</em>, where
<tt class="literal">O</tt> is the command, <em class="replaceable">o</em> is
the single character option name, and
<em class="replaceable">value</em> is the value assigned to the option.
The options shown in the previous discussion, if written in the old
syntax, would be:
</p>

<blockquote><pre class="code"># location of alias file 
OA/etc/aliases 
# temporary file mode 
OF0600 
# default timeout interval OT5d</pre></blockquote>

<p>If your configuration uses the old option format, it is dangerously
out of date and should be upgraded. See <a href="appe_01.html">Appendix E, "A sendmail Reference"</a>
for information on downloading, compiling, and installing the latest
version of sendmail.
</p>

<p>Most of the options defined in the <em class="emphasis">sendmail.cf</em>
file that comes with your system don't require modification.
People change options settings because they want to change the
sendmail environment, not because they have to. The options in your
configuration file are almost certainly correct for your system.
</p>

</div>
<a name="tcp3-CHP-10-SECT-5.5" /><div class="sect2">
<h3 class="sect2">10.5.5. Defining Trusted Users </h3>

<p>The <tt class="literal">T</tt> command defines a
<a name="INDEX-2184" />
<a name="INDEX-2185" /> <a name="INDEX-2186" /> <a name="INDEX-2187" />list of users who are trusted
to override the sender address using the mailer <tt class="literal">-f</tt>
flag.<a href="#FOOTNOTE-119">[119]</a> Normally the trusted users
are defined as <em class="emphasis">root</em>, <em class="emphasis">uucp</em>,
and <em class="emphasis">daemon</em>. Trusted users can be specified as a
list of usernames on a single command line or on multiple command
lines. The users must be valid usernames from the
<em class="emphasis">/etc/passwd</em> file.
</p><blockquote class="footnote"> <a name="FOOTNOTE-119" /><p>[119]Mailer flags are listed in <a href="appe_01.html">Appendix E, "A sendmail Reference"</a>.</p> </blockquote>

<p>The most commonly defined trusted users are: </p>

<blockquote><pre class="code">Troot 
Tdaemon
Tuucp</pre></blockquote>

<p>Do not modify this list. Additional trusted users increase the
possibility of security problems.
</p>

</div>
<a name="tcp3-CHP-10-SECT-5.6" /><div class="sect2">
<h3 class="sect2">10.5.6. Defining Mail Precedence </h3>

<p>Precedence is one
<a name="INDEX-2188" />
<a name="INDEX-2189" /> <a name="INDEX-2190" /> <a name="INDEX-2191" />of the factors used by sendmail to
assign priority to messages entering its queue. The
<tt class="literal">P</tt> command defines the message precedence values
available to sendmail users. The higher the precedence number, the
greater the precedence of the message. The default precedence of a
message is 0. Negative precedence numbers indicate especially
low-priority mail. Error messages are not generated for mail with a
negative precedence number, making low priorities attractive for mass
mailings. Some commonly used precedence values are:
</p>

<blockquote><pre class="code">Pfirst-class=0 
Pspecial-delivery=100 
Plist=-30 
Pbulk=-60
Pjunk=-100</pre></blockquote>

<p>To specify a desired precedence, add a Precedence
<a name="INDEX-2192" />header
to your outbound message. Use the text name from the
<tt class="literal">P</tt> command in the Precedence header to set the
specific precedence of the message. Given the precedence definitions
shown above, a user who wanted to avoid receiving error messages for
a large mailing could select a message precedence of -60 by including
the following header line in the mail:
</p>

<blockquote><pre class="code"> Precedence: bulk</pre></blockquote>

<p>The five precedence values shown are probably more than you'll
ever need.
</p>

</div>
<a name="tcp3-CHP-10-SECT-5.7" /><div class="sect2">
<h3 class="sect2">10.5.7. Defining Mail Headers </h3>

<p>The <tt class="literal">H</tt> command
<a name="INDEX-2193" />
<a name="INDEX-2194" />
<a name="INDEX-2195" /> <a name="INDEX-2196" />defines the format of header lines
that sendmail inserts into messages. The format of the header command
is the <tt class="literal">H</tt> command, optional header flags enclosed
in question marks, a header name, a colon, and a header template. The
header template is a combination of literals and macros that are
included in the header line. Macros in the header template are
expanded before the header is inserted in a message. The same
conditional syntax used in macro definitions can be used in header
templates, and it functions in exactly the same way: it allows you to
test whether a macro is set and to use another value if it is not
set.
</p>

<p>The header template field can contain the
<tt class="literal">$&gt;</tt><em class="replaceable">name</em> syntax that
is used in rewrite rules. When used in a header template, the
<tt class="literal">$&gt;</tt><em class="replaceable">name</em> syntax allows
you to call the ruleset identified by <em class="replaceable">name</em>
to process an incoming header. This can be useful for filtering
headers in order to reduce spam email. We discuss rulesets, rewrite
rules, the <tt class="literal">$&gt;</tt><em class="replaceable">name</em>
syntax, and how these things are used later in this chapter.
</p>

<p>The header flags often arouse more questions than they merit. The
function of the flags is very simple. The header flags control
whether or not the header is inserted into mail bound for a specific
mailer. If no flags are specified, the header is used for all
mailers. If a flag is specified, the header is used only for a mailer
that has the same flag set in the mailer's definition. (Mailer
flags are listed in <a href="appe_01.html">Appendix E, "A sendmail Reference"</a>.) Header flags
control only header <em class="emphasis">insertion</em>. If a header is
received in the input, it is passed to the output regardless of the
flag settings.
</p>

<p>Some sample header definitions from the
<em class="emphasis">generic-linux.cf</em> sample file are:
</p>

<blockquote><pre class="code">H?P?Return-Path: &lt;$g&gt;
HReceived: $?sfrom $s $.$?_($?s$|from $.$_)
H?D?Resent-Date: $a
H?D?Date: $a
H?F?Resent-From: $?x$x &lt;$g&gt;$|$g$.
H?F?From: $?x$x &lt;$g&gt;$|$g$.
H?x?Full-Name: $x
H?M?Resent-Message-Id: &lt;$t.$i@$j&gt;
H?M?Message-Id: &lt;$t.$i@$j&gt;</pre></blockquote>

<p>The headers provided in your system's
<em class="emphasis">sendmail.cf</em> are sufficient for most
installations. It's unlikely you'll ever need to change
them.
</p>

</div>
<a name="tcp3-CHP-10-SECT-5.8" /><div class="sect2">
<h3 class="sect2">10.5.8. Defining Mailers </h3>

<p>The <tt class="literal">M</tt> commands
<a name="INDEX-2197" />
<a name="INDEX-2198" /> <a name="INDEX-2199" />
<a name="INDEX-2200" />define
the mail delivery programs used by sendmail. The syntax of the
command is:
</p>

<blockquote><pre class="code"> M<em class="replaceable">name</em>, {<em class="replaceable">field=value</em>}</pre></blockquote>

<p><em class="replaceable">name</em> is an arbitrary name used internally
by sendmail to refer to this mailer. The name doesn't matter as
long as it is used consistently within the
<em class="emphasis">sendmail.cf</em> file to refer to this mailer. For
example, the mailer used to deliver SMTP mail within the local domain
might be called <em class="emphasis">smtp</em> on one system and
<em class="emphasis">ether</em> on another system. The function of both
mailers is the same; only the names are different.
</p>

<p>There are a few exceptions to this freedom of choice. The mailer that
delivers local mail to users on the same machine must be called
<em class="emphasis">local</em>, and a mailer named
<em class="emphasis">local</em><a name="INDEX-2201" /> must be defined in the
<em class="emphasis">sendmail.cf</em> file. Three other special mailer
names are:
</p>

<dl>

<dt><i>prog</i></dt>
<dd><p>Delivers mail to programs.</p></dd>



<dt><i>*file*</i></dt>
<dd><p>Sends mail to files.</p></dd>



<dt><i>*include*</i></dt>
<dd><p>Directs mail to <tt class="literal">:include:</tt> lists.</p></dd>
</dl>
<p>Of these, only the <em class="emphasis">prog</em><a name="INDEX-2202" /> mailer is defined in the
<em class="emphasis">sendmail.cf</em> file. The other two are defined
internally by sendmail.
</p>

<p>Despite the fact that the mailer name can be anything you want, it is
usually the same on most systems because the mailers in the
<em class="emphasis">sendmail.cf</em> file are built by standard
<tt class="literal">m4</tt> macros. In the <em class="emphasis">linux.mc</em>
configuration created earlier, the MAILER(local) macro created the
<em class="emphasis">prog</em> and <em class="emphasis">local</em> mailers, and
the MAILER(smtp) macro created the <em class="emphasis">smtp</em>,
<em class="emphasis">esmtp</em>, <em class="emphasis">smtp8</em>,
<em class="emphasis">dsmtp,</em> and <em class="emphasis">relay</em> mailers.
Every system you work with will probably have this same set of mailer
names.
</p>

<p>The mailer name is followed by a comma-separated list of
<em class="emphasis">field=value</em> pairs that define the
characteristics of the mailer. <a href="ch10_05.html#tcp3-CHP-10-TABLE-2">Table 10-2</a> shows the
single-character <em class="emphasis">field</em> identifiers and the
contents of the <em class="emphasis">value</em> field associated with each
of them. Most mailers don't require all of these
<a name="INDEX-2203" /> <a name="INDEX-2204" />fields.
</p>

<a name="tcp3-CHP-10-TABLE-2" /><h4 class="objtitle">Table 10-2. Mailer definition fields </h4><table border="1">





<tr>
<th>
<p>Field</p>
</th>
<th>
<p>Meaning</p>
</th>
<th>
<p>Contents</p>
</th>
<th>
<p>Example</p>
</th>
</tr>


<tr>
<td>
<p>P</p>
</td>
<td>
<p>Path</p>
</td>
<td>
<p>Path of the mailer</p>
</td>
<td>
<p>P=/bin/mail</p>
</td>
</tr>
<tr>
<td>
<p>F</p>
</td>
<td>
<p>Flags</p>
</td>
<td>
<p>sendmail flags for this mailer</p>
</td>
<td>
<p>F=lsDFMe</p>
</td>
</tr>
<tr>
<td>
<p>S</p>
</td>
<td>
<p>Sender</p>
</td>
<td>
<p>Rulesets for sender addresses</p>
</td>
<td>
<p>S=10</p>
</td>
</tr>
<tr>
<td>
<p>R</p>
</td>
<td>
<p>Recipient</p>
</td>
<td>
<p>Rulesets for recipient addresses</p>
</td>
<td>
<p>R=20</p>
</td>
</tr>
<tr>
<td>
<p>A</p>
</td>
<td>
<p>Argv</p>
</td>
<td>
<p>The mailer's argument vector</p>
</td>
<td>
<p>A=sh -c $u</p>
</td>
</tr>
<tr>
<td>
<p>E</p>
</td>
<td>
<p>Eol</p>
</td>
<td>
<p>End-of-line string for the mailer</p>
</td>
<td>
<p>E=\r\n</p>
</td>
</tr>
<tr>
<td>
<p>M</p>
</td>
<td>
<p>Maxsize</p>
</td>
<td>
<p>Maximum message length</p>
</td>
<td>
<p>M=100000</p>
</td>
</tr>
<tr>
<td>
<p>L</p>
</td>
<td>
<p>Linelimit</p>
</td>
<td>
<p>Maximum line length</p>
</td>
<td>
<p>L=990</p>
</td>
</tr>
<tr>
<td>
<p>D</p>
</td>
<td>
<p>Directory</p>
</td>
<td>
<p><em class="emphasis">prog</em> mailer's execution directory</p>
</td>
<td>
<p>D=$z:/</p>
</td>
</tr>
<tr>
<td>
<p>U</p>
</td>
<td>
<p>Userid</p>
</td>
<td>
<p>User and group ID used to run mailer</p>
</td>
<td>
<p>U=uucp:wheel</p>
</td>
</tr>
<tr>
<td>
<p>N</p>
</td>
<td>
<p>Nice</p>
</td>
<td>
<p>nice value used to run mailer</p>
</td>
<td>
<p>N=10</p>
</td>
</tr>
<tr>
<td>
<p>C</p>
</td>
<td>
<p>Charset</p>
</td>
<td>
<p>Content-type for 8-bit MIME characters</p>
</td>
<td>
<p>C=iso8859-1</p>
</td>
</tr>
<tr>
<td>
<p>T</p>
</td>
<td>
<p>Type</p>
</td>
<td>
<p>Type information for MIME errors</p>
</td>
<td>
<p>T=dns/rfc822/smtp</p>
</td>
</tr>

</table><p>

<p>The Path (P) <a name="INDEX-2205" />fields contain either the path to the
mail delivery program or the literal string <tt class="literal">[IPC]</tt>.
ailer definitions that specify <tt class="literal">P=[IPC]</tt> use
sendmail to deliver mail via SMTP.<a href="#FOOTNOTE-120">[120]</a> The path to a
mail delivery program varies from system to system depending on where
the systems store the programs. Make sure you know where the programs
are stored before you modify the Path field. If you use a
<em class="emphasis">sendmail.cf</em> file from another computer, make
sure that the mailer paths are valid for your system. If you use
<tt class="literal">m4</tt> to build the configuration, the path will be
correct.
</p><blockquote class="footnote"> <a name="FOOTNOTE-120" /><p>[120]<tt class="literal">[TCP]</tt>
and <tt class="literal">[IPC]</tt> are used interchangeably, both
in the P field and in the A field.</p> </blockquote>

<p>The Flags (F) <a name="INDEX-2206" />field
contains the sendmail flags used for this mailer. These are the
mailer flags referenced earlier in this chapter under "Defining
ail Headers," but mailer flags do more than just control
header insertion. There are a large number of flags. <a href="appe_01.html">Appendix E, "A sendmail Reference"</a> describes all of them and their functions.
</p>

<p>The Sender (S) <a name="INDEX-2207" />and the Recipient (R)
<a name="INDEX-2208" />fields identify the rulesets used to
rewrite the sender and recipient addresses for this mailer. Each
ruleset is identified by its number. We'll discuss rulesets
more later in this chapter, and we will refer to the S and R values
when troubleshooting the sendmail configuration.
</p>

<p>The Argv (A) <a name="INDEX-2209" />field defines the argument vector
passed to the mailer. It contains, among other things, macro
expansions that provide the recipient username (which is
<tt class="literal">$u</tt>),<a href="#FOOTNOTE-121">[121]</a> the recipient hostname (<tt class="literal">$h</tt>), and the
sender's From address (<tt class="literal">$f</tt>). These macros are
expanded before the argument vector is passed to the mailer.
</p><blockquote class="footnote"> <a name="FOOTNOTE-121" /><p>[121]In the
<em class="emphasis">prog</em> mailer definition, <tt class="literal">$u</tt>
actually passes a program name in the argument vector.</p>
</blockquote>

<p>The End-of-line (E) <a name="INDEX-2210" />field defines the characters used to
mark the end of a line. A carriage return and a line feed (CRLF) is
the default for SMTP mailers.
</p>

<p>Maxsize (M) defines, <a name="INDEX-2211" />in bytes, the longest message that
this mailer will handle. This field is used most frequently in
definitions of UUCP mailers.
</p>

<p>Linelimit (L) <a name="INDEX-2212" />defines, in bytes, the maximum length
of a line that can be contained in a message handled by this mailer.
This mailer field was introduced in sendmail V8. Previous versions of
sendmail limited lines to 80 characters because this was the limit
for SMTP mail before MIME mail was introduced.
</p>

<p>The Directory (D) <a name="INDEX-2213" />field specifies the working directory
for the <em class="emphasis">prog</em> mailer. More than one directory can
be specified for the directory field by separating the directory
paths with colons. The example in <a href="ch10_05.html#tcp3-CHP-10-TABLE-2">Table 10-2</a> tells
<em class="emphasis">prog</em> to use the recipient's home
directory, which is the value returned by the internal macro
<tt class="literal">$z</tt>. If that directory is not available, it should
use the root (/) directory.
</p>

<p>The Userid (U) field is used to specify the default user and the
group ID used to execute the <a name="INDEX-2214" />mailer. The example
<tt class="literal">U=uucp:wheel</tt> says that the mailer should be run
under the user ID <em class="emphasis">uucp</em> and the group ID
<em class="emphasis">wheel</em>. If no value is specified for the Userid
field, the value defined by the DefaultUser option is used.
</p>

<p>Use Nice (N) to <a name="INDEX-2215" />change the <tt class="literal">nice</tt>
value for the execution of the mailer. This allows you to change the
scheduling priority of the mailer. This is rarely used. If
you're interested, see the <tt class="literal">nice</tt> manpage for
appropriate values.
</p>

<p>The last two fields are used only for MIME mail. Charset (C)
<a name="INDEX-2216" />defines the character set used in the
Content-type header when an 8-bit message is converted to MIME. If
Charset is not defined, the value defined in the DefaultCharSet
option is used. If that option is not defined,
<tt class="literal">unknown-8bit</tt> is used as the default value.
</p>

<p>The Type (T) <a name="INDEX-2217" />field defines the type information
used in MIME error messages. MIME-type information defines the mailer
transfer agent type, the mail address type, and the error code type.
The default is <em class="emphasis">dns/rfc822/smtp</em>.
</p>

<a name="tcp3-CHP-10-SECT-5.8.1" /><div class="sect3">
<h3 class="sect3">10.5.8.1. Some common mailer definitions </h3>

<p>The following mailer <a name="INDEX-2218" />
<a name="INDEX-2219" />definitions are from
<em class="emphasis">generic-linux.cf</em>:
</p>

<blockquote><pre class="code">Mlocal,   P=/usr/bin/procmail, F=lsDFMAw5:/|@qSPfhn9,
          S=EnvFromL/HdrFromL, R=EnvToL/HdrToL, T=DNS/RFC822/X-Unix,
          A=procmail -Y -a $h -d $u
prog,    P=/bin/sh, F=lsDFMoqeu9, S=EnvFromL/HdrFromL,
          R=EnvToL/HdrToL, D=$z:/, T=X-Unix/X-Unix/X-Unix,
          A=sh -c $u
smtp,    P=[IPC], F=mDFMuX, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP,
          E=\r\n, L=990, T=DNS/RFC822/SMTP, A=TCP $h
esmtp,   P=[IPC], F=mDFMuXa, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP,
          E=\r\n, L=990, T=DNS/RFC822/SMTP, A=TCP $h
smtp8,   P=[IPC], F=mDFMuX8, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP,
          E=\r\n, L=990, T=DNS/RFC822/SMTP, A=TCP $h
dsmtp,   P=[IPC], F=mDFMuXa%, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP,
          E=\r\n, L=990, T=DNS/RFC822/SMTP, A=TCP $h
relay,   P=[IPC], F=mDFMuXa8, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP,
          E=\r\n, L=2040, T=DNS/RFC822/SMTP,A=TCP $h</pre></blockquote>

<p>This example contains the following mailer definitions:</p>

<ul><li>
<p>A definition for local mail delivery, always called
<em class="emphasis">local</em>. This definition is required by sendmail.
</p>
</li><li>
<p>A definition for delivering mail to programs, always called
<em class="emphasis">prog</em>. This definition is found in most
configurations.
</p>
</li><li>
<p>A definition for TCP/IP mail delivery, here called
<em class="emphasis">smtp</em>.
</p>
</li><li>
<p>A definition for an Extended SMTP mailer, here called
<em class="emphasis">esmtp</em>.
</p>
</li><li>
<p>A definition for an SMTP mailer that handles unencoded 8-bit data,
here called <em class="emphasis">smtp8</em>.
</p>
</li><li>
<p>A definition for on-demand SMTP, here called
<em class="emphasis">dsmtp</em>.
</p>
</li><li>
<p>A definition for a mailer that relays TCP/IP mail through an external
mail relay host, here called <em class="emphasis">relay</em>.
</p>
</li></ul>
<p>A close examination of the fields in one of these mailer entries, for
example the entry for the <em class="emphasis">smtp</em> mailer, shows the
following:
</p>

<dl>
<dt><b><tt class="literal">Msmtp</tt></b></dt>
<dd>
<p>A mailer, arbitrarily named <em class="emphasis">smtp</em>, is being
defined.
</p>
</dd>


<dt><b><tt class="literal">P=[IPC]</tt></b></dt>
<dd>
<p>The path to the program used for this mailer is
<tt class="literal">[IPC]</tt>, which means delivery of this mail is
handled internally by sendmail.
</p>
</dd>


<dt><b><tt class="literal">F=mDFMuX</tt></b></dt>
<dd>
<p>The sendmail flags for this mailer say that this mailer can send to
multiple recipients at once; that Date, From, and Message-Id headers
are needed; that uppercase should be preserved in hostnames and
usernames; and that lines beginning with a dot have an extra dot
prepended. Refer to <a href="appe_01.html">Appendix E, "A sendmail Reference"</a> for more details.
</p>
</dd>


<dt><b><tt class="literal">S =EnvFromSMTP/HdrFromSMTP</tt></b></dt>
<dd>
<p>The sender address in the mail "envelope" is processed
through ruleset <tt class="literal">EnvFromSMTP</tt><em class="emphasis">,</em>
and the sender address in the message is processed through ruleset
<tt class="literal">HdrFromSMTP</tt>. More on this later.
</p>
</dd>


<dt><b><tt class="literal">R= EnvToSMTP</tt></b></dt>
<dd>
<p>All recipient addresses are processed through ruleset
<tt class="literal">EnvToSMTP</tt>.
</p>
</dd>


<dt><b><tt class="literal">E=\r\n</tt></b></dt>
<dd>
<p>Lines are terminated with a carriage return and a line feed. </p>
</dd>


<dt><b><tt class="literal">L=990</tt></b></dt>
<dd>
<p>This mailer will handle lines up to 990 bytes long.</p>
</dd>


<dt><b><tt class="literal">T=DNS/RFC822/SMTP</tt></b></dt>
<dd>
<p>The MIME-type information for this mailer says that DNS is used for
hostnames, RFC 822 email addresses are used, and SMTP error codes are
used.
</p>
</dd>


<dt><b><tt class="literal">A=TCP $h</tt></b></dt>
<dd>
<p>The meaning of each option in an argument vector is exactly as
defined on the manpage for the command; see the
<em class="emphasis">local</em> mailer as an example. In the case of the
<em class="emphasis">smtp</em> mailer, however, the argument refers to an
internal sendmail process designed to deliver SMTP mail over a TCP
connection. The macro <tt class="literal">$h</tt> is expanded to provide
the recipient host (<tt class="literal">$h</tt>) address.
</p>
</dd>

</dl>

<p>Despite this long discussion, don't worry about mailer
definitions. The configuration file that is built by
<tt class="literal">m4</tt> for your operating system contains the correct
mailer definitions to run sendmail in a TCP/IP network environment.
You shouldn't need to modify any mailer definitions.
</p>

</div>
</div>


<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch10_04.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228"><a href="index.html"><img alt="Home" border="0" src="../gifs/txthome.gif" /></a></td><td align="right" valign="top" width="228"><a href="ch10_06.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr><tr><td align="left" valign="top" width="228">10.4. The sendmail.cf File </td><td align="center" valign="top" width="228"><a href="index/index.html"><img alt="Book Index" border="0" src="../gifs/index.gif" /></a></td><td align="right" valign="top" width="228">10.6. Rewriting the Mail Address </td></tr></table></div>
<hr width="684" align="left" />

<img alt="Library Navigation Links" border="0" src="../gifs/navbar.gif" usemap="#library-map" />
<p><p><font size="-1"><a href="copyrght.html">Copyright &copy; 2002</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map"><area shape="rect" coords="1,0,84,90" href="../index.html" /><area shape="rect" coords="86,-7,176,90" href="../ssh/index.html" /><area shape="rect" coords="178,0,265,101" href="index.html" /><area shape="rect" coords="266,0,333,90" href="../nfs/index.html" /><area shape="rect" coords="334,-1,429,93" href="../snmp/index.html" /><area shape="rect" coords="431,0,529,116" href="../tshoot/index.html" /><area shape="rect" coords="534,0,594,104" href="../dns/index.html" /><area shape="rect" coords="595,1,704,108" href="../fire/index-2.html" /></map>

</body>
<!-- Mirrored from nnc3.com/mags/Networking2/tcp/ch10_05.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:56:30 GMT -->
</html>