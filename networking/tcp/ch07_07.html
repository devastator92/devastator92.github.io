<html>
<!-- Mirrored from nnc3.com/mags/Networking2/tcp/ch07_07.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:56:28 GMT -->
<head><title>Configuring gated  (TCP/IP Network Administration, 3rd Edition)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Craig Hunt" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="0596002971L" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="TCP/IP Network Administration, 3rd Edition" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img alt="Book Home" border="0" src="gifs/smbanner.gif" usemap="#banner-map" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.html" alt="TCP/IP Network Administration" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.html" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch07_06.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228" /><td align="right" valign="top" width="228"><a href="ch07_08.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr></table></div>



<h2 class="sect1">7.7. Configuring gated </h2>

<p><tt class="literal">gated</tt> is <a name="INDEX-1526" />
<a name="INDEX-1527" />available
<a name="INDEX-1528" />from
<a href="http://www.gated.org/">http://www.gated.org</a>. <a href="appb_01.html">Appendix B, "A gated Reference"</a> provides information about downloading and
compiling the software. In this section, we use
<tt class="literal">gated</tt> release 3.6, the version of
<tt class="literal">gated</tt> that is currently available without
restrictions. There are other versions of <tt class="literal">gated</tt>
available to members of the Gated Consortium. If you plan to build
products based on <tt class="literal">gated</tt> or do research on routing
protocols using <tt class="literal">gated</tt>, you should join the
consortium. For the purposes of this book, release 3.6 is fine.
</p>

<p><tt class="literal">gated</tt> reads its configuration from the
<em class="emphasis">/etc/gated.conf</em><a name="INDEX-1529" /> file. The configuration commands in the
file resemble C code. All statements end with a semicolon, and
associated statements are grouped together by curly braces. This
structure makes it simple to see what parts of the configuration are
associated with each other, which is important when multiple
protocols are configured in the same file. In addition to structure
in the language, the <em class="emphasis">/etc/gated.conf</em> file also
has a structure.
</p>

<p>The different configuration
<a name="INDEX-1530" />statements, and the order in which
these statements must appear, divide <em class="emphasis">gated.conf</em>
into sections: <em class="emphasis">option statements</em>,
<em class="emphasis">interface statements</em>, <em class="emphasis">definition
statements</em>, <em class="emphasis">unicast</em> and
<em class="emphasis">multicast</em> <em class="emphasis">protocol
statements</em>, <em class="emphasis">static statements</em>,
<em class="emphasis">control statements</em>, and <em class="emphasis">aggregate
statements</em>. Entering a statement out of order causes an
error when parsing the file.
</p>

<p>Two other types of statements do not fall into any of these
categories. They are <em class="emphasis">directive statements</em> and
<em class="emphasis">trace statements</em>. These can occur anywhere in
the <em class="emphasis">gated.conf</em> file and do not directly relate
to the configuration of any protocol. These statements provide
instructions to the parser and instructions to control tracing from
within the configuration file.
</p>

<p>The <tt class="literal">gated</tt> configuration commands are summarized in
<a href="ch07_07.html#tcp3-CHP-7-TABLE-2">Table 7-2</a>. The table lists each command by name,
identifies the statement type, and provides a very short synopsis of
each command's function. The entire command language is covered
in detail in <a href="appb_01.html">Appendix B, "A gated Reference"</a>.
</p>

<a name="tcp3-CHP-7-TABLE-2" /><h4 class="objtitle">Table 7-2. gated configuration statements </h4><table border="1">




<tr>
<th>
<p>Statement</p>
</th>
<th>
<p>Type</p>
</th>
<th>
<p>Function</p>
</th>
</tr>


<tr>
<td>
<p>%directory</p>
</td>
<td>
<p>directive</p>
</td>
<td>
<p>Sets the directory for include files</p>
</td>
</tr>
<tr>
<td>
<p>%include</p>
</td>
<td>
<p>directive</p>
</td>
<td>
<p>Includes a file into <em class="emphasis">gated.conf</em></p>
</td>
</tr>
<tr>
<td>
<p>traceoptions</p>
</td>
<td>
<p>trace</p>
</td>
<td>
<p>Specifies which events are traced</p>
</td>
</tr>
<tr>
<td>
<p>options</p>
</td>
<td>
<p>option</p>
</td>
<td>
<p>Defines gated options</p>
</td>
</tr>
<tr>
<td>
<p>interfaces</p>
</td>
<td>
<p>interface</p>
</td>
<td>
<p>Defines interface options</p>
</td>
</tr>
<tr>
<td>
<p>autonomoussystem</p>
</td>
<td>
<p>definition</p>
</td>
<td>
<p>Defines the AS number</p>
</td>
</tr>
<tr>
<td>
<p>routerid</p>
</td>
<td>
<p>definition</p>
</td>
<td>
<p>Defines the originating router for BGP or OSPF</p>
</td>
</tr>
<tr>
<td>
<p>martians</p>
</td>
<td>
<p>definition</p>
</td>
<td>
<p>Defines invalid destination addresses</p>
</td>
</tr>
<tr>
<td>
<p>multicast</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Defines multicast protocol options</p>
</td>
</tr>
<tr>
<td>
<p>snmp</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Enables reporting to SNMP</p>
</td>
</tr>
<tr>
<td>
<p>rip</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Enables RIP</p>
</td>
</tr>
<tr>
<td>
<p>isis</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Enables IS-IS protocol </p>
</td>
</tr>
<tr>
<td>
<p>kernel</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Configures kernel interface options</p>
</td>
</tr>
<tr>
<td>
<p>ospf</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Enables OSPF protocol</p>
</td>
</tr>
<tr>
<td>
<p>redirect</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Removes routes installed by ICMP</p>
</td>
</tr>
<tr>
<td>
<p>egp</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Enables EGP</p>
</td>
</tr>
<tr>
<td>
<p>bgp</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Enables BGP</p>
</td>
</tr>
<tr>
<td>
<p>icmp</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Configures the processing of general ICMP packets</p>
</td>
</tr>
<tr>
<td>
<p>pim</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Enables the PIM multicast protocol</p>
</td>
</tr>
<tr>
<td>
<p>dvmrp</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Enables the DVMRP multicast protocol</p>
</td>
</tr>
<tr>
<td>
<p>msdp</p>
</td>
<td>
<p>protocol</p>
</td>
<td>
<p>Enables the MSDP multicast protocol</p>
</td>
</tr>
<tr>
<td>
<p>static</p>
</td>
<td>
<p>static</p>
</td>
<td>
<p>Defines static routes</p>
</td>
</tr>
<tr>
<td>
<p>import</p>
</td>
<td>
<p>control</p>
</td>
<td>
<p>Defines what routes are accepted</p>
</td>
</tr>
<tr>
<td>
<p>export</p>
</td>
<td>
<p>control</p>
</td>
<td>
<p>Defines what routes are advertised</p>
</td>
</tr>
<tr>
<td>
<p>aggregate</p>
</td>
<td>
<p>aggregate</p>
</td>
<td>
<p>Controls route aggregation</p>
</td>
</tr>
<tr>
<td>
<p>generate</p>
</td>
<td>
<p>aggregate</p>
</td>
<td>
<p>Controls creation of a default route</p>
</td>
</tr>

</table><p>

<p>You can see that the <tt class="literal">gated</tt> configuration language
has many commands. The language provides configuration control for
several different protocols and additional commands to configure the
added features of <tt class="literal">gated</tt> itself. All of this can be
confusing.
</p>

<p>To avoid confusion, don't try to understand the details of
everything offered by <tt class="literal">gated</tt>. Your routing
environment will not use all of these protocols and features. Even if
you are providing the gateway at the border between two anonymous
systems, you will probably run only two routing protocols: one
interior protocol and one exterior protocol. Only those commands that
relate to your actual configuration need to be included in your
configuration file. As you read this section, skip the things you
don't need. For example, if you don't use the BGP
protocol, don't study the <tt class="literal">bgp</tt> statement.
When you do need more details about a specific statement, look it up
in <a href="appb_01.html">Appendix B, "A gated Reference"</a>. With this in mind, let's look
at some sample <a name="INDEX-1531" /> <a name="INDEX-1532" />configurations. 
</p>

<a name="tcp3-CHP-7-SECT-7.1" /><div class="sect2">
<h3 class="sect2">7.7.1. Sample gated.conf Configurations </h3>

<p>The details in <a href="appb_01.html">Appendix B, "A gated Reference"</a> may
<a name="INDEX-1533" />
<a name="INDEX-1534" />make
<tt class="literal">gated</tt> configuration appear more complex than it
is. <tt class="literal">gated</tt>'s rich command language can be
confusing, as can its support for multiple protocols and the fact
that it often provides a few ways to do the same thing. But some
realistic examples will show that individual configurations do not
need to be complex.
</p>

<p>The basis for the sample configurations is the network in <a href="ch07_07.html#tcp3-CHP-7-FIG-4">Figure 7-4</a>. We have installed a new router that provides
our backbone with direct access to the Internet, and we have decided
to install new routing protocols. We'll configure a host to
listen to RIP-2 updates, an interior gateway to run RIP-2 and OSPF,
and an exterior gateway to run OSPF and BGP.
</p>

<a name="tcp3-CHP-7-FIG-4" /><div class="figure"><img height="373" alt="Figure 7-4" src="figs/tcp3_0704.gif" width="270" /></div><h4 class="objtitle">Figure 7-4. Sample routing topology</h4>

<p>Gateway <em class="emphasis">limulus</em> interconnects subnet 172.16.9.0
and subnet 172.16.1.0. To hosts on subnet 9, it advertises itself as
the default gateway because it is the gateway to the outside world.
It uses RIP-2 to advertise routes on subnet 9. On subnet 1, gateway
<em class="emphasis">limulus</em> advertises itself as the gateway to
subnet 9 using OSPF.
</p>

<p>Gateway <em class="emphasis">chill</em> provides subnet 1 with access to
the Internet through autonomous system 164. Because gateway
<em class="emphasis">chill</em> provides access to the Internet, it
announces itself as the default gateway to the other systems on
subnet 1 using OSPF. To the external autonomous system, it uses BGP
to announce itself as the path to the internal networks it learns
about through OSPF.
</p>

<p>Let's look at the routing configuration of host
<em class="emphasis">minasi</em>, gateway <em class="emphasis">limulus</em>,
and gateway <em class="emphasis">chill</em>.
</p>

<a name="tcp3-CHP-7-SECT-7.1.1" /><div class="sect3">
<h3 class="sect3">7.7.1.1. A host configuration </h3>

<p>The host routing <a name="INDEX-1535" />
<a name="INDEX-1536" />
<a name="INDEX-1537" />configuration is very simple.
The <tt class="literal">rip</tt> <tt class="literal">yes</tt> statement enables
RIP, and that's all that is really required to run RIP. That
basic configuration should work for any system that runs RIP. The
additional clauses enclosed in curly braces modify the basic RIP
configuration. We use a few clauses to create a more interesting
example. Here is the RIP-2 configuration for host
<em class="emphasis">minasi</em>:
</p>

<blockquote><pre class="code"># 
#  enable rip, don't broadcast updates, 
#  listen for RIP-2 updates on the multicast address, 
#  check that the updates are authentic. 
# 
rip yes { 
        nobroadcast ; 
        interface 172.16.9.23 
             version 2  
             multicast  
             authentication simple "REAL stuff" ; 
 } ;</pre></blockquote>

<p>This sample file shows the basic structure of
<em class="emphasis">gated.conf</em> configuration statements. Lines
beginning with a sharp sign (#) are comments.<a href="#FOOTNOTE-77">[77]</a> All statements end with semicolons. Clauses associated
with a configuration statement can span multiple lines and are
enclosed in curly braces (<tt class="literal">{}</tt>). In the example, the
<tt class="literal">nobroadcast</tt> and <tt class="literal">interface</tt>
clauses apply directly to the <tt class="literal">rip</tt> statement. The
<tt class="literal">version</tt>, <tt class="literal">multicast</tt>, and
<tt class="literal">authentication</tt> keywords are part of the interface
clause.
</p><blockquote class="footnote">
<a name="FOOTNOTE-77" /><p>[77]Comments can also be enclosed between \* and *\.</p>
</blockquote>

<p>The keyword <tt class="literal">nobroadcast</tt> prevents the host from
broadcasting its own RIP updates. The default is
<tt class="literal">nobroadcast</tt> when the system has one network
interface, and <tt class="literal">broadcast</tt> when it has more than
one. The <tt class="literal">nobroadcast</tt> keyword performs the same
function as the <tt class="literal">-q</tt> command-line option does for
<tt class="literal">routed</tt>. However, <tt class="literal">gated</tt> can do
much more than <tt class="literal">routed</tt>, as the next clause shows.
</p>

<p>The <tt class="literal">interface</tt> clause defines interface parameters
for RIP. The parameters associated with this clause say that RIP-2
updates will be received via the RIP-2 multicast address on interface
172.16.9.23 and that authentic updates will contain the password
<tt class="literal">REAL^stuff</tt>. For RIP-2, <tt class="literal">simple</tt>
authentication is a clear-text password up to 16 bytes long. This is
not intended to protect the system from malicious actions; it is
intended only to protect the routers from a configuration accident.
If a user mistakenly sets his system up as a RIP supplier, he is very
unlikely to accidentally enter the correct password into his
configuration. Stronger authentication is available in the form of a
essage Digest 5 (MD5) cryptographic checksum by specifying
<tt class="literal">md5</tt> in the authentication clause.
</p>

</div>

<a name="tcp3-CHP-7-SECT-7.1.2" /><div class="sect3">
<h3 class="sect3">7.7.1.2. Interior gateway configurations </h3>

<p>Gateway <a name="INDEX-1538" /> <a name="INDEX-1539" /> <a name="INDEX-1540" /> <a name="INDEX-1541" />configurations are
more complicated than the simple host configuration shown above.
Gateways always have multiple interfaces and occasionally run
multiple routing protocols. Our first sample configuration is for the
interior gateway between subnet 9 and the central backbone, subnet 1.
It uses RIP-2 on subnet 9 to announce routes to the Unix hosts. It
uses OSPF on subnet 1 to exchange routes with the other gateways.
Here's the configuration of gateway
<em class="emphasis">limulus</em>:
</p>

<blockquote><pre class="code">#  Don't time-out subnet 9 
interfaces { 
    interface 172.16.9.1 passive ; 
} ; 
# Define the OSPF router id 
routerid 172.16.1.9 ; 
# Enable RIP-2; announce OSPF routes to 
# subnet 9 with a cost of 5. 
rip yes { 
    broadcast ; 
    defaultmetric 5 ; 
    interface 172.16.9.1 
         version 2 
         multicast 
         authentication simple "REAL stuff" ; 
} ; 
# Enable OSPF; subnet 1 is the backbone area; 
# use password authentication. 
ospf yes { 
     backbone { 
          interface 172.16.1.9 { 
              priority 5 ; 
              auth simple "It'sREAL" ; 
              } ; 
          } ;
} ;</pre></blockquote>

<p>The <tt class="literal">interfaces</tt> statement defines routing
characteristics for the network interfaces. The keyword
<tt class="literal">passive</tt> in the interface clause is used here, just
as we have seen it used before, to create a permanent static route
that will not be removed from the routing table. In this case, the
permanent route is through a directly attached network interface.
Normally when <tt class="literal">gated</tt> thinks an interface is
malfunctioning, it increases the cost of the interface by giving it a
high-cost preference value (120) to reduce the probability of a
gateway routing data through a non-operational interface.
<tt class="literal">gated</tt> determines that an interface is
malfunctioning when it does not receive routing updates on that
interface. We don't want <tt class="literal">gated</tt> to downgrade
the 172.16.9.1 interface, even if it does think the interface is
malfunctioning, because our router is the only path to subnet 9.
That's why this configuration includes the clause
<tt class="literal">interface</tt> <tt class="literal">172.16.9.1 passive</tt>.
</p>

<p>The <tt class="literal">routerid</tt> statement defines the router
identifier for OSPF. Unless it is explicitly defined in the
configuration file, <tt class="literal">gated</tt> uses the address of the
first interface it encounters as the default router identifier
address. Here we specify the address of the interface that actually
speaks OSPF as the OSPF router identifier.
</p>

<p>In the previous example we discussed all the clauses on the
<tt class="literal">rip</tt> statement except one -- the
<tt class="literal">defaultmetric</tt> clause. The
<tt class="literal">defaultmetric</tt> clause defines the RIP metric used
to advertise routes learned from other routing protocols. This
gateway runs both OSPF and RIP-2. We wish to advertise the routes
learned via OSPF to our RIP clients, and to do that, a metric is
required. We choose a RIP cost of 5. If the
<tt class="literal">defaultmetric</tt> clause is not used, routes learned
from OSPF are not advertised to the RIP clients.<a href="#FOOTNOTE-78">[78]</a>
This statement is required for our configuration.
</p><blockquote class="footnote"> <a name="FOOTNOTE-78" /><p>[78]This
is not strictly true. The routes are advertised with a cost of 16,
meaning that the destinations are unreachable.</p> </blockquote>

<p>The <tt class="literal">ospf</tt> <tt class="literal">yes</tt> statement enables
OSPF. The first clause associated with this statement is
<tt class="literal">backbone</tt>. It states that the router is part of the
OSPF backbone area. Every <tt class="literal">ospf yes</tt> statement must
have at least one associated area clause. It can define a specific
area, e.g., <tt class="literal">area 2</tt>, but at least one router must
be in the backbone area. While the OSPF backbone is area 0, it cannot
be specified as <tt class="literal">area</tt> <tt class="literal">0</tt>; it must
be specified with the keyword <tt class="literal">backbone</tt>. In our
sample configuration, subnet 1 is the backbone, and all routers
attached to it are in the backbone area. It is possible for a single
router to attach to multiple areas with a different set of
configuration parameters for each area. Notice how the nested curly
braces group the clauses together. The remaining clauses in the
configuration file are directly associated with the backbone area
clause.
</p>

<p>The interface that connects this router to the backbone area is
defined by the <tt class="literal">interface</tt> clause. It has two
associated subclauses, the <tt class="literal">priority</tt> clause and the
<tt class="literal">auth</tt> clause.
</p>

<p>The <tt class="literal">priority 5 ;</tt> clause defines the priority used
by this router when the backbone is electing a designated router. The
higher the priority number, the less likely a router will be elected
as the designated router. Use <tt class="literal">priority</tt> to steer
the election toward the most capable routers.
</p>

<p>The <tt class="literal">auth</tt> <tt class="literal">simple</tt>
<tt class="literal">"It'sREAL"</tt> <tt class="literal">;</tt> clause says that
simple, password-based authentication is used in the backbone area
and defines the password used for simple authentication. Three
choices, <tt class="literal">none</tt>, <tt class="literal">simple</tt>, and
<tt class="literal">md5</tt>, are available for authentication in GateD
3.6. <tt class="literal">none</tt> means no authentication is used.
<tt class="literal">simple</tt> means that the correct eight-character
password must be used or the update will be rejected. Password
authentication is used only to protect against accidents; it is not
intended to protect against malicious actions. Stronger
authentication based on MD5 is used <a name="INDEX-1542" /> <a name="INDEX-1543" /> <a name="INDEX-1544" /> <a name="INDEX-1545" />when <tt class="literal">md5</tt> is
selected.
</p>

</div>

<a name="tcp3-CHP-7-SECT-7.1.3" /><div class="sect3">
<h3 class="sect3">7.7.1.3. Exterior gateway configuration </h3>

<p>The configuration <a name="INDEX-1546" /> <a name="INDEX-1547" /> <a name="INDEX-1548" /> <a name="INDEX-1549" />for gateway
<em class="emphasis">chill</em> is the most complex because it runs both
OSPF and BGP. Here's the configuration file for gateway
<em class="emphasis">chill</em>:
</p>

<blockquote><pre class="code"># Defines our AS number for BGP 
autonomoussystem 249; 
 
# Defines the OSPF router id 
routerid 172.16.1.1; 
 
# Disable RIP 
rip no; 
 
# Enable BGP 
bgp yes { 
   group type external peeras 164 { 
        peer 10.6.0.103 ; 
        peer 10.20.0.72 ; 
        }; 
}; 
 
# Enable OSPF; subnet 1 is the backbone area; 
# use password authentication. 
ospf yes { 
     backbone { 
         interface 172.16.1.1 { 
              priority 10 ; 
              auth simple "It'sREAL" ; 
              } ; 
          } ; 
}; 
 
# Announce routes learned from OSPF and route 
# to directly connected network via BGP to AS 164 
export proto bgp as 164 { 
     proto direct ; 
     proto ospf ; 
}; 
 
# Announce routes learned via BGP from  
# AS number 164 to our OSPF area. 
export proto ospfase type 2  { 
     proto bgp autonomoussystem 164  { 
          all ;    
          };
};</pre></blockquote>

<p>This configuration enables both BGP and OSPF and sets certain
protocol-specific parameters. BGP needs to know the AS number, which
is 249 for <em class="emphasis">books-net</em>. OSPF needs to know the
router identifier address. We set it to the address of the router
interface that runs OSPF. The AS number and the router identifier are
defined early in the configuration because
<tt class="literal">autonomoussystem</tt> and <tt class="literal">routerid</tt>
are definition statements and therefore must occur before the first
protocol statement. Refer back to <a href="ch07_07.html#tcp3-CHP-7-TABLE-2">Table 7-2</a> for
the various statement types.
</p>

<p>The first protocol statement is the one that turns RIP off. We
don't want to run RIP, but the default for
<tt class="literal">gated</tt> is to turn RIP on. Therefore we explicitly
disable RIP with the <tt class="literal">rip no ;</tt> statement.
</p>

<p>BGP is enabled by the <tt class="literal">bgp</tt> <tt class="literal">yes</tt>
statement, which also defines a few additional BGP parameters. The
<tt class="literal">group</tt> clause sets parameters for all of the BGP
peers in the group. The clause defines the type of BGP connection
being created. The example is a classic external routing protocol
connection, and the external autonomous system we are connecting to
is AS number 164. <tt class="literal">gated</tt> can create five different
types of BGP sessions, but only one, <tt class="literal">type
external</tt>, is used to directly communicate with an external
autonomous system. The other four group types are used for
<em class="emphasis">internal BGP</em> (IBGP).<a href="#FOOTNOTE-79">[79]</a> IBGP is simply an acronym for BGP when it is used to move
routing information around inside an autonomous system. In our
example we use it to move routing information between autonomous
systems.
</p><blockquote class="footnote"> <a name="FOOTNOTE-79" /><p>[79] See <a href="appb_01.html">Appendix B, "A gated Reference"</a> for information on all group types.</p>
</blockquote>

<p>The BGP neighbors from which updates are accepted are indicated by
the peer clauses. Each peer is a member of the group. Everything
related to the group, such as the AS number, applies to every system
in the group. To accept updates from any system with ASN 164, use
<tt class="literal">allow</tt> in place of the list of peers.
</p>

<p>The OSPF protocol is enabled by the <tt class="literal">ospf yes</tt>
statement. The configuration of OSPF on this router is the same as it
is for other routers in the backbone area. The only parameter that
has been changed from the previous example is the priority number.
Because this route has a particularly heavy load, we have decided to
make it slightly less preferred for the designated router election.
</p>

<p>The export statements control the routes that
<tt class="literal">gated</tt> advertises to other routers. The first
export statement directs <tt class="literal">gated</tt> to use BGP
(<tt class="literal">proto</tt> <tt class="literal">bgp</tt>) to advertise to
autonomous system 164 (<tt class="literal">as</tt> <tt class="literal">164</tt>)
any directly connected networks (<tt class="literal">proto</tt>
<tt class="literal">direct</tt>) and any routes learned from OSPF
(<tt class="literal">proto</tt> <tt class="literal">ospf</tt>). Notice that the
AS number specified in this statement is not the AS number of
<em class="emphasis">books-net</em>; it is the AS number of the external
system. The first line of the export statement defines to whom we are
advertising. The <tt class="literal">proto</tt> clauses within the curly
braces define what we are advertising.
</p>

<p>The second export statement announces the routes learned from the
external autonomous system. The routes are received via BGP and are
advertised via OSPF. Because these are routes from an external
autonomous system, they are advertised as <em class="emphasis">autonomous system
external</em><a name="INDEX-1550" /> (ASE) routes. That's why the
export statement specifies <tt class="literal">ospfase</tt> as the protocol
through which the routes are announced. The <tt class="literal">type</tt>
<tt class="literal">2</tt> parameter defines the type of external routes
that are being advertised. There are two types supported by
<tt class="literal">gated</tt>. Type 2 routes are those learned from an
exterior gateway protocol that does not provide a routing metric
comparable to the OSPF metric. These routes are advertised with the
cost of reaching the border router. In this case, the routes are
advertised with the OSPF cost of reaching gateway
<em class="emphasis">chill</em>. Type 1 routes are those learned from an
external protocol that does provide a metric directly comparable to
the OSPF metric. In that case, the metric from the external protocol
is added to the cost of reaching the border router when routes are
advertised.
</p>

<p>The source of the routes advertised in the second export statement is
the BGP connection (<tt class="literal">proto bgp</tt>) to autonomous
system 164 (<tt class="literal">autonomoussystem 164</tt>). The
<tt class="literal">proto</tt> clause is qualified with an optional
<em class="emphasis">route filter</em>. A <a name="INDEX-1551" />route filter is used to select the
routes from a specific source. The filter can list networks with
associated netmasks to select an individual destination. In the
example, the keyword <tt class="literal">all</tt> is used to select all
routes received via BGP, which is, in fact, the default. As the
default, the keyword <tt class="literal">all</tt> does not need to be
specified. However, it does no harm, and it provides clear
documentation of our intentions.
</p>

<p>All of the routes received from an external autonomous system could
produce a very large routing table. Individual routes are useful when
you have multiple border routers that can reach the outside world.
However, if you have only one border router, a default route may be
all that is needed. To export a default route, insert an
<tt class="literal">options</tt> <tt class="literal">gendefault</tt>
<tt class="literal">;</tt> statement at the beginning of the configuration
file.<a href="#FOOTNOTE-80">[80]</a> This tells
<tt class="literal">gated</tt> to generate a default route when the system
peers with a BGP neighbor. Next, replace the second export statement
in the sample file with the following export statement:
</p><blockquote class="footnote"> <a name="FOOTNOTE-80" /><p>[80]The <tt class="literal">generate</tt> statement is an
alternative way to create a default route. See <a href="appb_01.html">Appendix B, "A gated Reference"</a> for details.</p> </blockquote>

<blockquote><pre class="code"># Announce a default route when peering  
# with a BGP neighbor.  
export proto ospfase type 2  { 
     proto default ;
};</pre></blockquote>

<p>This export statement tells <tt class="literal">gated</tt> to advertise the
border router as the default gateway, but only when it has an active
connection to the external system.
</p>

<p>These few examples show that <em class="emphasis">gated.conf</em> files
are usually small and easy to read. Use <tt class="literal">gated</tt> if
you need to run a routing protocol on your computer. It allows you to
use the same software and the same configuration language on all of
your hosts, interior gateways, and exterior <a name="INDEX-1552" /> <a name="INDEX-1553" /> <a name="INDEX-1554" /> <a name="INDEX-1555" />gateways.
</p>

</div>
</div>
<a name="tcp3-CHP-7-SECT-7.2" /><div class="sect2">
<h3 class="sect2">7.7.2. Testing the Configuration </h3>

<p>Test the <a name="INDEX-1556" />
<a name="INDEX-1557" />configuration
file before you try to use it; the <tt class="literal">gated</tt>
configuration syntax is complex and it is easy to make a mistake.
Create your new configuration in a test file, test the new
configuration, and then move the test configuration to
<em class="emphasis">/etc/gated.conf</em>. Here's how.
</p>

<p>Assume that a configuration file called
<em class="emphasis">test.conf</em> has already been created. It is tested
using <tt class="literal">-f</tt> and <tt class="literal">-c</tt> on the command
line:
</p>

<blockquote><pre class="code">% <b class="emphasis-bold">gated -c -f test.conf trace.test</b></pre></blockquote>

<p>The <tt class="literal">-f</tt> option tells <tt class="literal">gated</tt> to
read the configuration from the named file instead of from
<em class="emphasis">/etc/gated.conf</em>. In the sample it reads the
configuration from <em class="emphasis">test.conf</em>. The
<tt class="literal">-c</tt> option tells <tt class="literal">gated</tt> to read
the configuration file and check for syntax errors. When
<tt class="literal">gated</tt> finishes reading the file, it terminates; it
does not modify the routing table. The <tt class="literal">-c</tt> option
turns on tracing, so specify a trace file or the trace data will be
displayed on your terminal. In the sample we specified
<em class="emphasis">trace.test</em> as the trace file. The
<tt class="literal">-c</tt> option also produces a snapshot of the state of
<tt class="literal">gated</tt> after reading the configuration file, and
writes the snapshot to
<em class="emphasis">/usr/tmp/gated_dump</em>.<a href="#FOOTNOTE-81">[81]</a> You don't
need to be superuser or to terminate the active
<tt class="literal">gated</tt> process to run <tt class="literal">gated</tt> when
the <tt class="literal">-c</tt> option is used.
</p><blockquote class="footnote">
<a name="FOOTNOTE-81" /><p>[81]<em class="emphasis">/usr/tmp</em> is the default for this file and
for the <em class="emphasis">gated_parse</em> file described later;
however, some systems place these files in
<em class="emphasis">/var/tmp</em>.</p> </blockquote>

<p>The dump and the trace file (<em class="emphasis">trace.test</em>) can
then be examined for errors and other information. When you're
confident that the configuration is correct, become superuser and
move your new configuration (<em class="emphasis">test.conf</em>) to
<em class="emphasis">/etc/gated.conf</em>.
</p>

<p>An alternative command for testing the configuration file is
<tt class="literal">gdc</tt><a name="INDEX-1558" />, though it must be run by the
root user or as a setuid root program. It includes features for
checking and installing a new configuration. <tt class="literal">gdc</tt>
uses three different configuration files. The current configuration
is <em class="emphasis">/etc/gated.conf</em>. The previous configuration
is stored in <em class="emphasis">/etc/gated.conf-</em>. The
"next" configuration is stored in
<em class="emphasis">/etc/gated.conf+</em>, which is normally the
configuration that needs to be tested. Here's how
<tt class="literal">gdc</tt> tests a configuration:
</p>

<blockquote><pre class="code"># <b class="emphasis-bold">cp test.conf /etc/gated.conf+</b> 
# <b class="emphasis-bold">gdc checknew</b> 
configuration file /etc/gated.conf+ checks out okay 
# <b class="emphasis-bold">gdc newconf</b> 
# <b class="emphasis-bold">gdc restart</b> 
gated not currently running
gdc: /etc/gated was started</pre></blockquote>

<p>In this sample, the test configuration is copied to
<em class="emphasis">/etc/gated.conf+</em> and tested with the
<tt class="literal">gdc</tt> <tt class="literal">checknew</tt> command. If syntax
problems are found in the file, a warning message is displayed and
detailed error messages are written to
<em class="emphasis">/usr/tmp/gated_parse</em>. There are no syntax errors
in the example, so we make the test file the current configuration
with the <tt class="literal">gdc</tt> <tt class="literal">newconf</tt> command.
This command moves the current configuration to
<em class="emphasis">gated.conf-</em> and moves the new configuration
(<em class="emphasis">gated.conf+</em>) to the current configuration. The
<tt class="literal">gdc</tt> <tt class="literal">restart</tt> command terminates
<tt class="literal">gated</tt> if it is currently running -- it was not
in the example -- and starts a new copy of
<tt class="literal">gated</tt> using the new <a name="INDEX-1559" /> <a name="INDEX-1560" />configuration. 
</p>

<a name="tcp3-CHP-7-SECT-7.2.1" /><div class="sect3">
<h3 class="sect3">7.7.2.1. Running gated at startup </h3>

<p>As with any <a name="INDEX-1561" /> <a name="INDEX-1562" />routing
software, <tt class="literal">gated</tt> should be included in your startup
file. Some systems come with the code to start
<tt class="literal">gated</tt> included in the startup file. If your system
doesn't, you'll need to add it. If you already have code
in your startup file that runs <tt class="literal">routed</tt>, replace it
with code to run <tt class="literal">gated</tt>. <tt class="literal">gated</tt>
and <tt class="literal">routed</tt> should not be running at the same time.
</p>

<p>Our imaginary gateway, <em class="emphasis">crab</em>, is a Solaris system
with code in the <em class="emphasis">/etc/init.d/inetinit</em> file that
starts <tt class="literal">routed</tt>. We comment out those lines, and add
these lines:
</p>

<blockquote><pre class="code">if [ -f /usr/sbin/gated -a -f /etc/gated.conf ]; then 
     /usr/sbin/gated;      echo -n 'gated' &gt; /dev/console
fi</pre></blockquote>

<p>This code assumes that <tt class="literal">gated</tt> is installed in
<em class="emphasis">/usr/sbin</em> and that the configuration file is
named <em class="emphasis">/etc/gated.conf</em>. The code checks that
<tt class="literal">gated</tt> is present and that the configuration file
<em class="emphasis">/etc/gated.conf</em> exists. If both files are found,
<tt class="literal">gated</tt> begins.
</p>

<p>The code checks for a configuration file because
<tt class="literal">gated</tt> usually runs with one. If
<tt class="literal">gated</tt> is started without a configuration file, it
checks the routing table for a default route. If it doesn't
find one, it starts RIP; otherwise, it just uses the default route.
Create an <em class="emphasis">/etc/gated.conf</em> file even if you only
want to run RIP. The configuration file documents your routing
configuration and protects you if the default configuration of
<tt class="literal">gated</tt> changes in the future.
</p>

</div>
</div>


<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch07_06.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228"><a href="index.html"><img alt="Home" border="0" src="../gifs/txthome.gif" /></a></td><td align="right" valign="top" width="228"><a href="ch07_08.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr><tr><td align="left" valign="top" width="228">7.6. Gateway Routing Daemon </td><td align="center" valign="top" width="228"><a href="index/index.html"><img alt="Book Index" border="0" src="../gifs/index.gif" /></a></td><td align="right" valign="top" width="228">7.8. Summary </td></tr></table></div>
<hr width="684" align="left" />

<img alt="Library Navigation Links" border="0" src="../gifs/navbar.gif" usemap="#library-map" />
<p><p><font size="-1"><a href="copyrght.html">Copyright &copy; 2002</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map"><area shape="rect" coords="1,0,84,90" href="../index.html" /><area shape="rect" coords="86,-7,176,90" href="../ssh/index.html" /><area shape="rect" coords="178,0,265,101" href="index.html" /><area shape="rect" coords="266,0,333,90" href="../nfs/index.html" /><area shape="rect" coords="334,-1,429,93" href="../snmp/index.html" /><area shape="rect" coords="431,0,529,116" href="../tshoot/index.html" /><area shape="rect" coords="534,0,594,104" href="../dns/index.html" /><area shape="rect" coords="595,1,704,108" href="../fire/index-2.html" /></map>

</body>
<!-- Mirrored from nnc3.com/mags/Networking2/tcp/ch07_07.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:56:28 GMT -->
</html>