<html>
<!-- Mirrored from nnc3.com/mags/Networking2/nfs/ch18_06.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:56:44 GMT -->
<head><title>Attribute caching (Managing NFS and NIS, 2nd Edition)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Hal Stern, Mike Eisler and Ricardo Labiaga" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="1565925106L" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="Managing NFS and NIS, 2nd Edition" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img alt="Book Home" border="0" src="gifs/smbanner.gif" usemap="#banner-map" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.html" alt="Managing NFS &amp; NIS" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.html" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch18_05.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228"><a href="index.html"></a></td><td align="right" valign="top" width="228"><a href="ch18_07.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr></table><div>



<h2 class="sect1">18.6. Attribute caching</h2>

NFS clients cache file attributes such as the<a name="INDEX-2703" />
<a name="INDEX-2704" />
<a name="INDEX-2705" /> modification time and
owner to avoid having to go to the NFS server for information that
does not change frequently. The motivations for an attribute caching
scheme are explained in <a href="ch07_04.html#nfs2-CHP-7-SECT-4.1">Section 7.4.1, "File attribute caching"</a>. Once a
<em class="emphasis">getattr</em> for a filehandle has been completed, the
information is cached for use by other requests. Cached data is
updated in subsequent write operations; the cache is flushed when the
lifetime of the data expires. Repeated attribute changes caused by
write operations can be handled entirely on the client side, with the
net result written back to the server in a single
<em class="emphasis">setattr</em>. Note that explicit
<em class="emphasis">setattr</em> operations, generated by a
<em class="emphasis">chmod</em> command on the client, are not cached at
all on the client. Only file size and modification time changes are
cached.
</p>

The lifetime of the cached data is determined by four mount
parameters shown in <a href="ch18_06.html#nfs2-CHP-18-TABLE-3">Table 18-3</a>.
</p>

<a name="nfs2-CHP-18-TABLE-3" /><h4 class="objtitle">Table 18-3. Attribute cache parameters </h4><table border="1">




<tr>
<th>
Parameter</p>
</th>
<th>
Default (seconds)</p>
</th>
<th>
Cache Limit</p>
</th>
</tr>


<tr>
<td>
acregmin</p>
</td>
<td>
3</p>
</td>
<td>
Minimum lifetime for file attributes</p>
</td>
</tr>
<tr>
<td>
acregmax</p>
</td>
<td>
60</p>
</td>
<td>
Maximum lifetime for file attributes</p>
</td>
</tr>
<tr>
<td>
acdirmin</p>
</td>
<td>
30</p>
</td>
<td>
Minimum lifetime for directory attributes</p>
</td>
</tr>
<tr>
<td>
acdirmax</p>
</td>
<td>
60</p>
</td>
<td>
Maximum lifetime for directory attributes</p>
</td>
</tr>

</table><p>

The default values again vary by vendor, as does the accessibility of
the attribute cache parameters. The minimum lifetimes set the time
period for which a size/modification time update will be cached
locally on the client. Attribute changes are written out at the end
of the maximum period to avoid having the client and server views of
the files drift too far apart. In addition, changing the file
attributes on the server makes those changes visible to other clients
referencing the same file (when their attribute caches time out).
</p>

Attribute caching can be turned off with the
<em class="emphasis">noac</em> mount option:
</p>

<blockquote><pre class="code"># <tt class="userinput"><b>mount -o noac mahimahi:/export/tools /mnt</b></tt></pre></blockquote>

Without caching enabled, every operation requiring access to the file
attributes must make a call to the server. This won't disable
read caching (in either NFS async threads or the VM system), but it
adds to the cost of maintaining cache consistency. The NFS async
threads and the VM system still perform regular cache consistency
checks by requesting file attributes, but each consistency check now
requires a <em class="emphasis">getattr</em> RPC on the NFS server. When
many clients have attribute caching disabled, the server's
<em class="emphasis">getattr</em> count skyrockets:
</p>

<blockquote><pre class="code">% <tt class="userinput"><b>nfsstat -ns</b></tt> 
Server nfs:
calls       badcalls    
221628      769         
Version 2: (774 calls)
null        getattr     setattr     root        lookup      readlink    
8 1%        0 0%        0 0%        0 0%        762 98%     0 0%        
read        wrcache     write       create      remove      rename      
0 0%        0 0%        0 0%        0 0%        0 0%        0 0%        
link        symlink     mkdir       rmdir       readdir     statfs      
0 0%        0 0%        0 0%        0 0%        0 0%        4 0%        
Version 3: (219984 calls)
null        getattr     setattr     lookup      access      readlink    
1173 0%     119692 54%  4283 1%     31493 14%   26622 12%   103 0%      
read        write       create      mkdir       symlink     mknod       
11606 5%    7618 3%     1892 0%     64 0%       37 0%       0 0%        
remove      rmdir       rename      link        readdir     readdirplus 
3183 1%     2 0%        458 0%      1295 0%     156 0%      1138 0%     
fsstat      fsinfo      pathconf    commit      
7076 3%     311 0%      78 0%       1704 0%   </pre></blockquote>

Upwards of 60% of the NFS calls handled by the server may be requests
to return file or directory attributes.
</p>

If changes made by one client need to be reflected on other clients
with finer granularity, the attribute cache lifetime can be reduced
to one second using the <em class="emphasis">actimeo</em> option, which
sets both the regular file and directory minimum and maximum
lifetimes to the same value:
</p>

<blockquote><pre class="code"># <tt class="userinput"><b>mount -o actimeo=1 mahimahi:/export/tools /mnt</b></tt></pre></blockquote>

This has the same effect <a name="INDEX-2706" /> <a name="INDEX-2707" /> <a name="INDEX-2708" />as: 
</p>

<blockquote><pre class="code"># <tt class="userinput"><b>mount -o acregmin=1,acregmax=1,acdirmin=1,acdirmax=1 \</b></tt>
<tt class="userinput"><b>     mahimahi:/export/tools /mnt</b></tt></pre></blockquote>



<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch18_05.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228"><a href="index.html"><img alt="Home" border="0" src="../gifs/txthome.gif" /></a></td><td align="right" valign="top" width="228"><a href="ch18_07.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr><tr><td align="left" valign="top" width="228">18.5. NFS async thread tuning</td><td align="center" valign="top" width="228"><a href="index/index.html"><img alt="Book Index" border="0" src="../gifs/index.gif" /></a></td><td align="right" valign="top" width="228">18.7. Mount point constructions</td></tr></table><div>
<hr width="684" align="left" />

<img alt="Library Navigation Links" border="0" src="../gifs/navbar.gif" usemap="#library-map" />
<p><font size="-1"><a href="copyrght.html">Copyright &copy; 2002</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map"><area shape="rect" coords="1,0,84,90" href="../index.html" /><area shape="rect" coords="86,-7,176,90" href="../ssh/index.html" /><area shape="rect" coords="178,0,265,101" href="../tcp/index.html" /><area shape="rect" coords="266,0,333,90" href="index.html" /><area shape="rect" coords="334,-1,429,93" href="../snmp/index.html" /><area shape="rect" coords="431,0,529,116" href="../tshoot/index.html" /><area shape="rect" coords="534,0,594,104" href="../dns/index.html" /><area shape="rect" coords="595,1,704,108" href="../fire/index-2.html" /></map>

</body>
<!-- Mirrored from nnc3.com/mags/Networking2/nfs/ch18_06.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:56:44 GMT -->
</html>