<html>
<!-- Mirrored from nnc3.com/mags/Networking2/snmp/ch06_01.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:54:16 GMT -->
<head><title>Configuring Your NMS (Essential SNMP)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Douglas Mauro and Kevin Schmidt" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="059600020L" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="Essential SNMP" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img alt="Book Home" border="0" src="gifs/smbanner.gif" usemap="#banner-map" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.html" alt="Essential SNMP" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.html" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch05_05.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228"><a href="index.html"></a></td><td align="right" valign="top" width="228"><a href="ch06_02.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr></table></div>



<h1 class="chapter">Chapter 6. Configuring Your NMS</h1>
<div class="htmltoc"><h4 class="tochead">Contents:</h4>
  <a href="#ahead-1">HP's OpenView Network Node Manager</a><br />
<a href="ch06_02.html">Castle Rock's SNMPc Enterprise Edition</a><br /></p><p></div>

Now that you have picked out some software to use in your
environment, it's time to talk about installing and running it.
In this chapter we will look at a few NMS packages in detail. While
we listed several packages in <a href="ch05_01.html">Chapter 5, "Network-Management Software"</a>, we will
dig into only a few packages here, and we'll use these packages
in examples throughout the rest of the book. These examples should
allow you to get most other SNMP-based network-management packages up
and running with very little effort.
</p><p>

<div class="sect1"><a name="enettdg-CHP-6-SECT-1" /></a> 
  <h2 class="sect1"><a name="ahead-1"></a>6.1. HP's OpenView Network Node Manager</h2>

<a name="INDEX-666" /></a><a name="INDEX-667" /></a><a name="INDEX-668" /></a><a name="INDEX-669" /></a> <a name="INDEX-670" /></a><a name="INDEX-671" /></a><a name="INDEX-672" /></a><a name="INDEX-673" /></a><a name="INDEX-674" /></a>Network Node Manager (NNM) is a
licensed software product. The package includes a feature called
"Instant-On" that allows you to use the product for a
limited time (60 days) while you are waiting for your real license to
arrive. During this period, you are restricted to a 250-managed-node
license, but the product's capabilities aren't limited in
any other way. When you install the product, the Instant-On license
is enabled by default.
<a name="INDEX-675" /></a> <a name="INDEX-676" /></a><a name="INDEX-677" /></a><a name="INDEX-678" /></a><a name="INDEX-679" /></a><a name="INDEX-680" /></a>
</p><p>



<a name="ch06-4-fm2xml" /></a><blockquote><b>TIP: </b> 
Check out the OpenView scripts
located in OpenView's <em class="filename">bin</em> directory
(normally <em class="filename">/opt/OV/bin</em>). One particularly
important group of scripts sets environment variables that allow you
to traverse OpenView's directory structure much more easily.
These scripts are named <em class="filename">ov.envvars.csh</em>,
<em class="filename">ov.envvars.sh</em>, etc. (that is,
<em class="filename">ov.envvars</em> followed by the name of the shell
you're using). When you run the appropriate script for your
shell, it defines environment variables such as $OV_BIN, $OV_MAN, and
$OV_TMP, which point to the OpenView <em class="filename">bin</em>,
<em class="filename">man</em>, and <em class="filename">tmp</em> directories.
Thus, you can easily go to the directory containing OpenView's
manual pages with the command <i class="command">cd $OV_MAN</i>. These
environment variables are used throughout this book and in all of
OpenView's documentation.
</p><p>
</blockquote>

<a name="enettdg-CHP-6-SECT-1.1" /></a><div class="sect2">
<h3 class="sect2">6.1.1. Running NNM</h3>

<a name="INDEX-681" /></a><a name="INDEX-682" /></a>To start the OpenView GUI on a Unix
machine, define your DISPLAY environment variable and run the command
<i class="command">$OV_BIN/ovw</i>. This starts OpenView's NNM. If
your NNM has performed any discovery, the nodes it has found should
appear under your Internet (top-level) icon. If you have problems
starting NNM, run the command <i class="command">$OV_BIN/ovstatus -c</i>
and then $<i class="command">OV_BIN/ovstart</i> or
<i class="command">$OV_BIN/ovstop</i>, respectively, to start or stop it.
By default, NNM installs the necessary scripts to start its daemons
when the machine boots. OpenView will perform all of its functions in
the background, even when you aren't running any maps. This
means that you do not have to keep a copy of NNM running on your
console at all times and you don't have to start it explicitly
when your machine reboots.
</p><p>

<a name="INDEX-683" /></a>
<a name="INDEX-684" /></a><a name="INDEX-685" /></a>When the GUI
starts, it presents you with a clickable high-level map. This map,
called the Root map, provides a top-level view of your network. The
map gives you the ability to see your network without having to see
every detail at once. If you want more information about any item in
the display, whether it's a subnet or an individual node, click
on it. You can drill down to see any level of detail you
want -- for example, you can look at an interface card on a
particular node. The more detail you want, the more you click. <a href="ch06_01.html#enettdg-CHP-6-FIG-1">Figure 6-1</a> shows a typical NNM map.
</p><p>

<a name="enettdg-CHP-6-FIG-1" /></a><div class="figure"><img height="330" alt="Figure 6-1" src="figs/snmp_0601.gif" width="480" /></div><h4 class="objtitle">Figure 6-1. A typical NNM map</h4>

<a name="INDEX-686" /></a><a name="INDEX-687" /></a><a name="INDEX-688" /></a>
<a name="INDEX-689" /></a><a name="INDEX-690" /></a>The menu bar (see <a href="ch06_01.html#enettdg-CHP-6-FIG-2">Figure 6-2</a>) allows you to traverse the map with a bit
more ease. You have options such as closing NNM (the leftmost
button), going straight to the Home map (second from the
left),<a href="#FOOTNOTE-18">[18]</a> the Root map (third-left), the parent or previous map
(fourth-left), or the quick navigator.<a href="#FOOTNOTE-19">[19]</a>
There is also a button that lets you pan through the map or zoom in
on a portion of it.
</p><p><blockquote class="footnote"> <a name="FOOTNOTE-18" /></a>[18]You can set any map as your Home map. When
you've found the map you'd like to use, go to "Map
<img alt="Figure 6.1.1" src="figs/U2192.gif" /> Submap <img alt="Figure 6.1.1" src="figs/U2192.gif" /> Set This Submap as Home."</p><p>
</blockquote><blockquote class="footnote"> <a name="FOOTNOTE-19" /></a>[19]This is a
special map in which you can place objects that you need to watch
frequently. It allows you to access them quickly without having to
find them by searching through the network map.</p><p> </blockquote>

<a name="enettdg-CHP-6-FIG-2" /></a><div class="figure"><img height="34" alt="Figure 6-2" src="figs/snmp_0602.gif" width="231" /></div><h4 class="objtitle">Figure 6-2. OpenView NNM menu bar</h4>


<a name="ch06-7-fm2xml" /></a><blockquote><b>TIP: </b> 
Before you get sick looking at your newly discovered network, keep in
mind that you can add some quick and easy customizations that will
transform your hodgepodge of names, numbers, and icons into a
coordinated picture of your network.
</p><p>
</blockquote>

</div>
<a name="enettdg-CHP-6-SECT-1.2" /></a><div class="sect2">
<h3 class="sect2">6.1.2. The netmon Process</h3>

<a name="INDEX-691" /></a> <a name="INDEX-692" /></a><a name="INDEX-693" /></a><a name="INDEX-694" /></a> <a name="INDEX-695" /></a><a name="INDEX-696" /></a>NNM's daemon process
(<em class="emphasis">netmon</em>) starts automatically when the system
boots and is responsible for discovering nodes on your network, in
addition to a few other tasks. In NNM's menu, go to
"Options <img alt="Figure 6.1.2" src="figs/U2192.gif" /> Network Polling Configurations: IP." A
window should appear that looks similar to <a href="ch06_01.html#enettdg-CHP-6-FIG-3">Figure 6-3</a>. 
</p><p>

<a name="enettdg-CHP-6-FIG-3" /></a><div class="figure"><img height="363" alt="Figure 6-3" src="figs/snmp_0603.gif" width="373" /></div><h4 class="objtitle">Figure 6-3. OpenView's General network polling configuration options</h4>

<a name="INDEX-697" /></a><a name="INDEX-698" /></a><a href="ch06_01.html#enettdg-CHP-6-FIG-3">Figure 6-3</a> shows the
General area of the configuration wizard. The other areas are IP
Discovery, Status Polling, and Secondary Failures. The General area
allows us to specify a filter (in this example,
<tt class="literal">NOUSERS</tt>) that controls the discovery
process -- we might not want to see every device on the network.
We discuss the creation of filters later in this chapter, in <a href="ch06_01.html#enettdg-CHP-6-SECT-1.5">Section 6.1.5, "Using OpenView Filters"</a>. We elected to discover
beyond the license limit, which means that NNM will discover more
objects on our network than our license allows us to manage.
"Excess" objects (objects past the license's limit)
are placed in an unmanaged state, so that you can see them on your
maps but can't control them through NNM. This option is useful
when your license limits you to a specific number of managed nodes.
</p><p>

<a name="INDEX-699" /></a><a name="INDEX-700" /></a>The
IP Discovery area (<a href="ch06_01.html#enettdg-CHP-6-FIG-4">Figure 6-4</a>) lets us enable or
disable the discovery of IP nodes. Using the "auto
adjust" discovery feature allows NNM to figure out how often to
probe the network for new devices. The more new devices it finds, the
more often it polls; if it doesn't find any new devices it
slows down, eventually waiting one day (1d) before checking for any
new devices. If you don't like the idea that the discovery
interval varies (or perhaps more realistically, if you think that
probing the network to find new devices will consume more resources
than you like, either on your network-management station or the
network itself), you can specify a fixed discovery interval. Finally,
the "Discover Level-2 Objects" button tells NNM to
discover and report devices that are at the second layer of the OSI
network model. This category includes things such as unmanaged hubs
and switches, many AppleTalk devices, and so on.
</p><p>

<a name="enettdg-CHP-6-FIG-4" /></a><div class="figure"><img height="263" alt="Figure 6-4" src="figs/snmp_0604.gif" width="373" /></div><h4 class="objtitle">Figure 6-4. OpenView's IP Discovery network polling configuration options</h4>

<a name="INDEX-701" /></a> <a name="INDEX-702" /></a><a href="ch06_01.html#enettdg-CHP-6-FIG-5">Figure 6-5</a> shows the
Status Polling configuration area. Here you can turn status polling
on or off, and delete nodes that have been down or unreachable for a
specified length of time. This example is configured to delete nodes
after they've been down for one week (1w).
</p><p>

<a name="enettdg-CHP-6-FIG-5" /></a><div class="figure"><img height="327" alt="Figure 6-5" src="figs/snmp_0605.gif" width="373" /></div><h4 class="objtitle">Figure 6-5. OpenView's Status Polling network polling configuration options</h4>

<a name="INDEX-703" /></a><a name="INDEX-704" /></a><a name="INDEX-705" /></a>The DHCP polling options are,
obviously, especially useful in environments that use DHCP. They
allow you to establish a relationship between polling behavior and IP
addresses. You can specify a filter that selects addresses that are
assigned by DHCP. Then you can specify a time after which
<em class="emphasis">netmon</em> will delete non-responding DHCP addresses
from its map of your network. If a device is down for the given
amount of time, <em class="emphasis">netmon</em> disassociates the node
and IP address. The rationale for this behavior is simple: in a DHCP
environment, the disappearance of an IP address often means that the
node has received a new IP address from a DHCP server. In that case,
continuing to poll the old address is a waste of effort and is
possibly even misleading, since the address may be reassigned to a
different host.
</p><p>

<a name="INDEX-706" /></a><a name="INDEX-707" /></a><a name="INDEX-708" /></a>Finally, the Secondary Failures
configuration area shown in <a href="ch06_01.html#enettdg-CHP-6-FIG-6">Figure 6-6</a> allows you
to tell the poller how to react when it sees a secondary failure.
This occurs when a node beyond a failed device is unreachable; for
example, when a router goes down, making the file server that is
connected via one of the router's interfaces unreachable. In
this configuration area, you can state whether to show alarms for the
secondary failures or suppress them. If you choose to suppress them,
you can set up a filter that identifies important nodes in your
network that won't get suppressed even if they are deemed
secondary failures.
</p><p>

<a name="enettdg-CHP-6-FIG-6" /></a><div class="figure"><img height="321" alt="Figure 6-6" src="figs/snmp_0606.gif" width="352" /></div><h4 class="objtitle">Figure 6-6. OpenView's Secondary Failures network polling configuration options</h4>

<a name="INDEX-709" /></a>Once your map is up, you may notice
that nothing is getting discovered. Initially,
<em class="emphasis">netmon</em> won't discover anything beyond the
network segment to which your NMS is attached. If your NMS has an IP
address of 24.92.32.12, you will not discover your devices on
123.67.34.0. NNM finds adjacent routers and their segments, as long
as they are SNMP-compatible, and places them in an unmanaged (tan
colored) state on the map.<a href="#FOOTNOTE-20">[20]</a> This means that anything in and under that
icon will not be polled or discovered. Selecting the icon and going
to "Edit <img alt="Figure 6.1.2" src="figs/U2192.gif" /> Manage Objects" tells NNM to begin
managing this network and allows <em class="emphasis">netmon</em> to start
discovering nodes within it. You can quit managing nodes at any time
by clicking on UnManage instead of Manage.
</p><p><blockquote class="footnote"> <a name="FOOTNOTE-20" /></a>[20]In NNM, go to "Help
<img alt="Figure 6.1.2" src="figs/U2192.gif" /> Display Legend" for a list of icons and their
colors.</p><p> </blockquote>

<a name="INDEX-710" /></a><a name="INDEX-711" /></a><a name="INDEX-712" /></a>If your routers do not show any
adjacent networks, you should try testing them with "Fault
<img alt="Figure 6.1.2" src="figs/U2192.gif" /> Test IP/TCP/SNMP." Add the name of your router, click
"Restart," and see what kind of results you get back. If
you get "OK except for SNMP," review <a href="ch07_01.html">Chapter 7, "Configuring SNMP Agents"</a> and read <a href="ch06_01.html#enettdg-CHP-6-SECT-1.3">Section 6.1.3, "Configuring Polling Intervals"</a>, on setting up the default community
names within OpenView.
</p><p>

<em class="emphasis">netmon</em><a name="INDEX-713" /></a><a name="INDEX-714" /></a><a name="INDEX-715" /></a><a name="INDEX-716" /></a><a name="INDEX-717" /></a><a name="INDEX-718" /></a><a name="INDEX-719" /></a><a name="INDEX-720" /></a><a name="INDEX-721" /></a> also allows you to specify a seed file
that helps it to discover objects faster. The seed file contains
individual IP addresses, IP address ranges, or domain names that
narrow the scope of hosts that are discovered. You can create the
seed file with any text editor -- just put one address or hostname
on each line. Placing the addresses of your gateways in the seed file
sometimes makes the most sense, since gateways maintain ARP tables
for your network. <em class="emphasis">netmon</em> will subsequently
discover all the other nodes on your network, thus freeing you from
having to add all your hosts to the seed file. For more useful
information, see the documentation for the <i class="command">-s</i>
switch to <em class="emphasis">netmon</em> and the Local Registration
Files (LRF).
</p><p>

<a name="INDEX-722" /></a><a name="INDEX-723" /></a><a name="INDEX-724" /></a>NNM has another utility, called
<em class="emphasis">loadhosts</em>, that lets you add nodes to the map
one at a time. Here is an example of how you can add hosts, in a sort
of freeform mode, to the OpenView map. Note the use of the
<i class="command">-m</i> option, which sets the subnet to 255.255.255.0:
</p><p>

<blockquote><pre class="code">$ <b class="emphasis-bold">loadhosts -m 255.255.255.0</b> 
<b class="emphasis-bold">10.1.1.12 gwrouter1</b></pre></blockquote>

Once you have finished adding as many nodes as you'd like,
press Ctrl-d to exit the command.<a name="INDEX-725" /></a><a name="INDEX-726" /></a> <a name="INDEX-727" /></a><a name="INDEX-728" /></a><a name="INDEX-729" /></a> 
</p><p>

</div>
<a name="enettdg-CHP-6-SECT-1.3" /></a><div class="sect2">
<h3 class="sect2">6.1.3. Configuring Polling Intervals</h3>

<a name="INDEX-730" /></a>
<a name="INDEX-731" /></a><a name="INDEX-732" /></a><a name="INDEX-733" /></a> <a name="INDEX-734" /></a> <a name="INDEX-735" /></a> <a name="INDEX-736" /></a><a name="INDEX-737" /></a><a name="INDEX-738" /></a><a name="INDEX-739" /></a><a name="INDEX-740" /></a><a name="INDEX-741" /></a><a name="INDEX-742" /></a><a name="INDEX-743" /></a>The SNMP
Configuration page is located off of the main screen in
"Options <img alt="Figure 6.1.3" src="figs/U2192.gif" /> SNMP Configuration." A window similar to
the one in <a href="ch06_01.html#enettdg-CHP-6-FIG-7">Figure 6-7</a> should appear. This window
has four sections: Specific Nodes, IP Address Wildcards, Default, and
the entry area (chopped off for viewing purposes). Each section
contains the same general areas: Node or IP Address, Get Community,
Set Community, Proxy (if any), Timeout, Retry, Port, and Polling. The
Default area, which unfortunately is at the bottom of the screen,
sets up the default behavior for SNMP on your network -- that is,
the behavior (community strings, etc.) for all hosts that
aren't listed as "specific nodes" or that match one
of the wildcards. The Specific Nodes section allows you to specify
exceptions, on a per node basis. IP Address Wildcards allows you to
configure properties for a range of addresses. This is especially
useful if you have networks that have different
<em class="emphasis">get</em> and <em class="emphasis">set</em> community
names.<a href="#FOOTNOTE-21">[21]</a> All areas allow you to
specify a Timeout in seconds and a Retry value. The Port field gives
you the option of inserting a different port number (the default port
is 161). Polling is the frequency at which you would like to poll
your nodes.
</p><p><blockquote class="footnote"> <a name="FOOTNOTE-21" /></a>[21]<a name="INDEX-744" /></a>These community names are used in
different parts throughout NNM. For example, when polling an object
with <i class="command">xnmbrowser</i>, you won't need to enter (or
remember) the community string if it (or its network) is defined in
the SNMP configurations. </p><p> </blockquote>

<a name="enettdg-CHP-6-FIG-7" /></a><div class="figure"><img height="207" alt="Figure 6-7" src="figs/snmp_0607.gif" width="481" /></div><h4 class="objtitle">Figure 6-7. OpenView's SNMP Configuration page</h4>

It's important to understand how timeouts and retries work. If
we look at Specific Nodes, we see a Timeout of .9 seconds and a Retry
of 2 for 208.166.230.1. If OpenView doesn't get a response
within .9 seconds, it tries again (the first retry) and waits 1.8
seconds. If it still doesn't get anything back, it doubles the
timeout period again to 3.6 seconds (the second retry); if it still
doesn't get anything back it declares the node unreachable and
paints it red on the NNM's map. With these Timeout and Retry
values, it takes about 6 seconds to identify an unreachable
node.<a name="INDEX-745" /></a><a name="INDEX-746" /></a>
</p><p>

Imagine what would happen if we had a Timeout of 4 seconds and a
Retry of 5. By the fifth try we would be waiting 128 seconds, and the
total process would take 252 seconds. That's over four minutes!
For a mission-critical device, four minutes can be a long time for a
failure to go unnoticed.
</p><p>

<a name="INDEX-747" /></a><a name="INDEX-748" /></a>This example shows that you must be
very careful about your Timeout and Retry settings -- particularly
in the Default area, because these settings apply to most of your
network. Setting your Timeout and Retry too high and your Polling
periods too low will make <em class="emphasis">netmon</em> fall behind; it
will be time to start over before the poller has worked through all
your devices.<a href="#FOOTNOTE-22">[22]</a> This is a
frequent problem when you have many nodes, slow networks, small
polling times, and high numbers for Timeout and Retry.<a href="#FOOTNOTE-23">[23]</a> Once a system falls behind, it will take a long time to
discover problems with the devices it is currently monitoring, as
well as to discover new devices. In some cases, NNM may not discover
problems with downed devices at all! If your Timeout and Retry values
are set inappropriately, you won't be able to find problems and
will be unable to respond to outages.
</p><p><blockquote class="footnote"> <a name="FOOTNOTE-22" /></a>[22]<a name="INDEX-749" /></a>Keep
in mind that most of NNM's map is polled using regular
<em class="emphasis">ping</em>s and not SNMP.</p><p> </blockquote><blockquote class="footnote">
<a name="FOOTNOTE-23" /></a>[23]<a name="INDEX-750" /></a>Check
the manpage for <em class="emphasis">netmon</em> for the
<i class="command">-a</i> switch, especially around
<i class="command">-a12</i>. You can try to execute
<em class="emphasis">netmon</em> with an <i class="command">-a \ ?</i>, which
will list all the valid <i class="command">-a</i> options. If you see any
negative numbers in <i class="command">netmon.trace</i> after running
<i class="command">netmon -a12</i>, your system is running behind.</p><p>
</blockquote>

Falling behind can be very frustrating. We recommend starting your
Polling period very high and working your way down until you feel
comfortable. Ten to twenty minutes is a good starting point for the
Polling period. During your initial testing phase, you can always set
a wildcard range for your test servers, etc.<a name="INDEX-751" /></a> <a name="INDEX-752" /></a><a name="INDEX-753" /></a><a name="INDEX-754" /></a> <a name="INDEX-755" /></a> <a name="INDEX-756" /></a> <a name="INDEX-757" /></a>
</p><p>

</div>
<a name="enettdg-CHP-6-SECT-1.4" /></a><div class="sect2">
<h3 class="sect2">6.1.4. A Few Words About NNM Map Colors</h3>

<a name="INDEX-758" /></a><a name="INDEX-759" /></a><a name="INDEX-760" /></a><a name="INDEX-761" /></a><a name="INDEX-762" /></a>By now discovery should be taking place,
and you should be starting to see some new objects appear on your
map. You should see a correlation between the colors of these objects
and the colors in NNM's Event Categories (see <a href="ch10_01.html">Chapter 10, "Traps"</a> for more about Event Categories). If a
device is reachable via <i class="command">ping</i>, its color will be
green. If the device cannot be reached, it will turn red. If
something "underneath" the device fails, the device will
become off-green, indicating that the device itself is okay, but
something underneath it has reached a nonnormal status. For example,
a router may be working, but a web server on the LAN behind it may
have failed. The status source for an object like this is Compound or
Propagated. (The other types of status source are Symbol and Object.)
The Compound status source is a great way to see if there is a
problem at a lower level while still keeping an eye on the big
picture. It alerts you to the problem and allows you to start
drilling down until you reach the object that is under duress.
</p><p>

It's always fun to shut off or unplug a machine and watch its
icon turn red on the map. This can be a great way to demonstrate the
value of the new management system to your boss. You can also learn
how to cheat and make OpenView miss a device, even though it was
unplugged. With a relatively long polling interval, it's easy
to unplug a device and plug it back in before OpenView has a chance
to notice that the device isn't there. By the time OpenView
gets around to it, the node is back up and looks fine. Long polling
intervals make it easy to miss such temporary failures. Lower polling
intervals make it less likely that OpenView will miss something, but
more likely that <em class="emphasis">netmon</em> will fall behind, and in
turn miss other failures. Take small steps so as not to crash or
overload <em class="emphasis">netmon</em> or your network.
</p><p>

</div>
<a name="enettdg-CHP-6-SECT-1.5" /></a><div class="sect2">
<h3 class="sect2">6.1.5. Using OpenView Filters</h3>

<a name="INDEX-763" /></a> <a name="INDEX-764" /></a><a name="INDEX-765" /></a><a name="INDEX-766" /></a> <a name="INDEX-767" /></a><a name="INDEX-768" /></a><a name="INDEX-769" /></a>Your
map may include some devices you don't need, want, or care
about. For example, you may not want to poll or manage users'
PCs, particularly if you have many users and a limited license. It
may be worthwhile for you to ignore these user devices to open more
slots for managing servers, routers, switches, and other more
important devices. <em class="emphasis">netmon</em> has a filtering
mechanism that allows you to control precisely which devices you
manage. It lets you filter out unwanted devices, cleans up your maps,
and can reduce the amount of management traffic on your network.
</p><p>

<a name="INDEX-770" /></a><a name="INDEX-771" /></a><a name="INDEX-772" /></a>In this book, we warn you repeatedly that
polling your network the wrong way can generate huge amounts of
management traffic. This happens when people or programs use default
polling intervals that are too fast for the network or the devices on
the network to handle. For example, a management system might poll
every node in your 10.1.0.0 network -- conceivably thousands of
them -- every two minutes. The poll may consist of SNMP
<i class="command">get</i> or <i class="command">set</i> requests, simple
<i class="command">ping</i>s, or both. OpenView's NNM uses a
combination of these to determine if a node is up and running.
Filtering saves you (and your management) the trouble of having to
pick through a lot of useless nodes and reduces the load on your
network. Using a filter allows you to keep the critical nodes on your
network in view. It allows you to poll the devices you care about and
ignore the devices you don't care about. The last thing you
want is to receive notification each time a user turns off his PC
when he leaves for the night.
</p><p>

<a name="INDEX-773" /></a><a name="INDEX-774" /></a>Filters
also help network management by letting you exclude DHCP users from
network discovery and polling. DHCP and BOOTP are used in many
environments to manage large IP address pools. While these protocols
are useful, they can make network management a nightmare, since
it's often hard to figure out what's going on when
addresses are being assigned, deallocated, and recycled.
</p><p>

In my environment we use DHCP only for our users. All servers and
printers have hardcoded IP addresses. With our setup, we can specify
all the DHCP clients and then state that we want everything
<em class="emphasis">but</em> these clients in our discovery, maps, etc.
The following example should get most users up and running with some
pretty good filtering. Take some time to review OpenView's
"A Guide to Scalability and Distribution for Network Node
Manager" manual for more in-depth information on filtering.
</p><p>

The default filter file, which is located in
<em class="filename">$OV_CONF/C</em>, is broken up into three sections:
</p><p>

<ul><li>
Sets</p><p>
</li><li>
Filters</p><p>
</li><li>
FilterExpressions</p><p>
</li></ul>
<a name="INDEX-775" /></a><a name="INDEX-776" /></a>
<a name="INDEX-777" /></a>In addition, lines that begin with //
are comments. // comments can appear anywhere; some of the other
statements have their own comment fields built in.
</p><p>

<a name="INDEX-778" /></a><a name="INDEX-779" /></a><a name="INDEX-780" /></a>Sets allow you to place individual
nodes into a group. This can be useful if you want to separate users
based on their geographic locations, for example. You can then use
these groups or any combination of IP addresses to specify your
Filters, which are also grouped by name. You then can take all of
these groupings and combine them into FilterExpressions. If this
seems a bit confusing, it is! Filters can be very confusing,
especially when you add complex syntax and not so logical logic
(&amp;&amp;, ||, etc.). The basic syntax for defining Sets, Filters,
and FilterExpressions looks like this:
</p><p>

<blockquote><pre class="code"><em class="replaceable">name "comments or description" { contents }</em></pre></blockquote>

Every definition contains a name, followed by comments that appear in
double quotes, and then the command surrounded by brackets. Our
default filter,<a href="#FOOTNOTE-24">[24]</a> named
<tt class="literal">filters</tt>, is located in
<em class="filename">$OV_CONF/C</em> and looks like this:
</p><p><blockquote class="footnote"> <a name="FOOTNOTE-24" /></a>[24]Your filter, if right out of the box,
will look much different. The one shown here is trimmed to ease the
pains of writing a filter.</p><p> </blockquote>

<blockquote><pre class="code">// lines that begin with // are considered COMMENTS and are ignored!
// Begin of MyCompanyName Filters

Sets {

    dialupusers "DialUp Users" { "dialup100", " dialup101", \
                 " dialup102" }
}

Filters { 

    ALLIPRouters "All IP Routers" { isRouter }

    SinatraUsers "All Users in the Sinatra Plant" { \
        ("IP Address" ~ 199.127.4.50-254) || \
        ("IP Address" ~ 199.127.5.50-254) || \
        ("IP Address" ~ 199.127.6.50-254) }

    MarkelUsers "All Users in the Markel Plant" { \
        ("IP Address" ~ 172.247.63.17-42) }

    DialAccess "All DialAccess Users" { "IP Hostname" in dialupusers }
}

FilterExpressions
{
    ALLUSERS "All Users" { SinatraUsers || MarkelUsers || DialAccess }

    NOUSERS "No Users " { !ALLUSERS }
}</pre></blockquote>

Now let's break this file down into pieces to see what it does. </p><p>

<a name="enettdg-CHP-6-SECT-1.5.1" /></a><div class="sect3">
<h3 class="sect3">6.1.5.1. Sets</h3>

<a name="INDEX-781" /></a>First, we
defined a Set<a href="#FOOTNOTE-25">[25]</a> called <tt class="literal">dialupusers</tt>
containing the hostnames (from DNS) that our dial-up users will
receive when they dial into our facility. These are perfect examples
of things we don't want to manage or monitor in our OpenView
environment.
</p><p><blockquote class="footnote"> <a name="FOOTNOTE-25" /></a>[25]These Sets have nothing to do with the
<em class="emphasis">snmpset</em> operation with which we have become
familiar.</p><p> </blockquote>

</div>

<a name="enettdg-CHP-6-SECT-1.5.2" /></a><div class="sect3">
<h3 class="sect3">6.1.5.2. Filters</h3>

<a name="INDEX-782" /></a>The Filters section is the only
nonoptional section. We defined four filters:
<tt class="literal">ALLIPRouters</tt>, <tt class="literal">SinatraUsers</tt>,
<tt class="literal">MarkelUsers</tt>, and <tt class="literal">DialAccess</tt>.
The first filter says to discover nodes that have field value
<tt class="literal">isRouter</tt>. OpenView can set the object attribute
for a managed device to values such as <tt class="literal">isRouter</tt>,
<tt class="literal">isHub</tt>, <tt class="literal">isNode</tt>, etc.<a href="#FOOTNOTE-26">[26]</a> These attributes can be used in Filter expressions to
make it easier to filter on groups of managed objects, as opposed to
IP address ranges, for example.
</p><p><blockquote class="footnote">
<a name="FOOTNOTE-26" /></a>[26]Check out the $OV_FIELDS area for a list of fields.</p><p>
</blockquote>

<a name="INDEX-783" /></a><a name="INDEX-784" /></a><a name="INDEX-785" /></a><a name="INDEX-786" /></a><a name="INDEX-787" /></a><a name="INDEX-788" /></a><a name="INDEX-789" /></a>The next two filters specify IP
address ranges. The <tt class="literal">SinatraUsers</tt> filter is the
more complex of the two. In it, we specify three IP address ranges,
each separated by logical OR symbols (<tt class="literal">||</tt>). The
first range (<tt class="literal">("IP Address"</tt> <tt class="literal">~</tt>
<tt class="literal">199.127.6.50-254)</tt>) says that if the IP address is
in the range 199.127.6.50-199.127.6.254, then filter it and ignore
it. If it's not in this range, the filter looks at the next
range to see if it's in that one. If it's not, the filter
looks at the final IP range. If the IP address isn't in any of
the three ranges, the filter allows it to be discovered and
subsequently managed by NNM. Other logical operators should be
familiar to most programmers: &amp;&amp; represents a logical AND,
and ! represents a logical NOT.
</p><p>

The final filter, <tt class="literal">DialAccess</tt>, allows us to exclude
all systems that have a hostname listed in the
<tt class="literal">dialupusers</tt> set, which was defined at the
beginning of the file.
</p><p>

</div>

<a name="enettdg-CHP-6-SECT-1.5.3" /></a><div class="sect3">
<h3 class="sect3">6.1.5.3. FilterExpressions</h3>

<a name="INDEX-790" /></a><a name="INDEX-791" /></a>
<a name="INDEX-792" /></a><a name="INDEX-793" /></a>The next section, FilterExpressions,
allows us to combine the filters we have previously defined with
additional logic. You can use a FilterExpression anywhere you would
use a Filter. Think of it like this: you create complex expressions
using Filters, which in turn can use Sets in the
<tt class="literal">contents</tt> parts of their expressions. You can then
use FilterExpressions to create simpler yet more robust expressions.
In our case, we take all the filters from above and place them into a
FilterExpression called <tt class="literal">ALLUSERS</tt>. Since we want
our NNM map to contain nonuser devices, we then define a group called
<tt class="literal">NOUSERS</tt> and tell it to ignore all user-type
devices with the command <tt class="literal">!ALLUSERS</tt>. As you can
see, FilterExpressions can also aid in making things more readable.
When you have finished setting up your filter file, use the
<em class="foreignphrase">$OV_BIN/ovfiltercheck</em> program to check
your new filters' syntax. If there are any problems, it will
let you know so you can fix them.
</p><p>

Now that we have our filters defined, we can apply them by using the
<i class="command">ovtopofix </i>command or the polling configuration
menu shown in <a href="ch06_01.html#enettdg-CHP-6-FIG-3">Figure 6-3</a>.
</p><p>

<a name="INDEX-794" /></a><a name="INDEX-795" /></a><a name="INDEX-796" /></a><a name="INDEX-797" /></a>If you want to remove nodes from your
map, use <i class="command">$OV_BIN/ovtopofix -f FILTER_NAME</i>.
Let's say that someone created a new DHCP scope without telling
you and suddenly all the new users are now on the map. You can edit
the filters file, create a new group with the IP address range of the
new DHCP scope, add it to the <tt class="literal">ALLUSERS</tt>
FilterExpression, run <i class="command">ovfiltercheck</i>, and, if there
are no errors, run <i class="command">$OV_BIN/ovtopofix -f NOUSERS</i> to
update the map on the fly. Then stop and restart
<em class="emphasis">netmon</em> -- otherwise it will keep discovering
these unwanted nodes using the old filter. I find myself running
<i class="command">ovtopofix</i> every month or so to take out some
random nodes. <a name="INDEX-798" /></a> <a name="INDEX-799" /></a><a name="INDEX-800" /></a><a name="INDEX-801" /></a> <a name="INDEX-802" /></a><a name="INDEX-803" /></a> 
</p><p>

</div>
</div>
<a name="enettdg-CHP-6-SECT-1.6" /></a><div class="sect2">
<h3 class="sect2">6.1.6. Loading MIBs into OpenView</h3>

Before
<a name="INDEX-804" /></a> <a name="INDEX-805" /></a>
<a name="INDEX-806" /></a>you
continue exploring OpenView's NNM, take time to load some
vendor-specific MIBs.<a href="#FOOTNOTE-27">[27]</a> This will
help you later on when you start interacting (polling, graphing,
etc.) more with SNMP-compatible devices. Go to "Options <img alt="Figure 6.1.6" src="figs/U2192.gif" />
Load/Unload MIBs: SNMP." This presents you with a window in
which you can add vendor-specific MIBs to your database.
Alternatively, you can run the command
<i class="command">$OV_BIN/xnmloadmib</i> and bypass having to go through
NNM directly.<a name="INDEX-807" /></a>
</p><p><blockquote class="footnote"> <a name="FOOTNOTE-27" /></a>[27]Some platforms and environments
refer to loading a MIB as compiling it.</p><p> </blockquote>

That's the end of our brief tour of OpenView configuration.
It's impossible to provide a complete introduction to
configuring OpenView in this chapter, so we tried to provide a survey
of the most important aspects of getting it running. There can be no
substitute for the documentation and manual pages that come with the
product itself.<a name="INDEX-808" /></a><a name="INDEX-809" /></a> 
</p><p>

</div>
</div>




<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch05_05.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228"><a href="index.html"><img alt="Home" border="0" src="../gifs/txthome.gif" /></a></td><td align="right" valign="top" width="228"><a href="ch06_02.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr><tr><td align="left" valign="top" width="228">5.5. Supporting Software</td><td align="center" valign="top" width="228"><a href="index/index.html"><img alt="Book Index" border="0" src="../gifs/index.gif" /></a></td><td align="right" valign="top" width="228">6.2. Castle Rock's SNMPc Enterprise Edition</td></tr></table></div>
<hr width="684" align="left" />

<img alt="Library Navigation Links" border="0" src="../gifs/navbar.gif" usemap="#library-map" />
<p><font size="-1"><a href="copyrght.html">Copyright &copy; 2002</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map"><area shape="rect" coords="1,0,84,90" href="../index.html" /><area shape="rect" coords="86,-7,176,90" href="../ssh/index.html" /><area shape="rect" coords="178,0,265,101" href="../tcp/index.html" /><area shape="rect" coords="266,0,333,90" href="../nfs/index.html" /><area shape="rect" coords="334,-1,429,93" href="index.html" /><area shape="rect" coords="431,0,529,116" href="../tshoot/index.html" /><area shape="rect" coords="534,0,594,104" href="../dns/index.html" /><area shape="rect" coords="595,1,704,108" href="../fire/index-2.html" /></map>

</body>
<!-- Mirrored from nnc3.com/mags/Networking2/snmp/ch06_01.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:54:19 GMT -->
</html>
