<html>
<!-- Mirrored from nnc3.com/mags/Networking2/snmp/ch09_02.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:56:52 GMT -->
<head><title>External Polling (Essential SNMP)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Douglas Mauro and Kevin Schmidt" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="059600020L" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="Essential SNMP" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img alt="Book Home" border="0" src="gifs/smbanner.gif" usemap="#banner-map" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.html" alt="Essential SNMP" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.html" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch09_01.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228"><a href="index.html"></a></td><td align="right" valign="top" width="228"><a href="ch10_01.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr></table></div>


<h2 class="sect1">9.2. External Polling</h2>

<a name="INDEX-1293" /><a name="INDEX-1294" /><a name="INDEX-1295" /><a name="INDEX-1296" /> <a name="INDEX-1297" /><a name="INDEX-1298" /><a name="INDEX-1299" />It is often impossible to poll a
device internally, for technical, security, or political reasons. For
example, the System Administration group may not be in the habit of
giving out the root password, making it difficult for you to install
and maintain internal polling scripts. However, they may have no
problem with installing and maintaining an SNMP agent such as
Concord's SystemEDGE or Net-SNMP. It's also possible that
you will find yourself in an environment in which you lack the
knowledge to build the tools necessary to poll internally. Despite
the situation, if an SNMP agent is present on a machine that has
objects worth polling, you can use an external device to poll the
machine and read the objects' values.<a href="#FOOTNOTE-38">[38]</a>
This external device can be one or more NMSs or other machines or
devices. For instance, when you have a decent-sized network it is
sometimes convenient, and possibly necessary, to distribute polling
among several NMSs.
</p><blockquote class="footnote"> <a name="FOOTNOTE-38" />[38]Many
devices say they are SNMP-compatible but support only a few MIBs.
This makes polling nearly impossible. If you don't have the
object(s) to poll there is nothing you can do, unless there are hooks
for an extensible agent. Even with extensible agents, unless you know
how to program, the Simple in SNMP goes away fast.</p> </blockquote>

Each of the external polling engines we will look at uses the same
polling methods, although some NMSs implement external polling
differently. We'll start with the OpenView
<i class="command">xnmgraph</i> program, which can be used to collect and
display data graphically. You can even use OpenView to save the data
for later retrieval and analysis. We'll include some examples
that show how you can collect data and store it automatically and how
you can retrieve that data for display. Castle Rock's SNMPc
also has an excellent data-collection facility that we will use to
collect and graph data.
</p>

<a name="enettdg-CHP-9-SECT-2.1" /><div class="sect2">
<h3 class="sect2">9.2.1. Collecting and Displaying Data with OpenView</h3>

<a name="INDEX-1300" />
<a name="INDEX-1301" /><a name="INDEX-1302" /><a name="INDEX-1303" /><a name="INDEX-1304" />One of the easiest ways to get some
interesting graphs with OpenView is to use the
<i class="command">xnmgraph</i> program. You can run
<i class="command">xnmgraph</i> from the command line and from some of
NNM's menus. One practical way to graph is to use
OpenView's <i class="command">xnmbrowser</i> to collect some data and then click
"Graph." It's as easy as that. If the node you are
polling has more than one instance (say, multiple interfaces),
OpenView will graph all known instances. When an NMS queries a device
such as a router, it determines how many instances are in the
<em class="emphasis">ifTable</em> and retrieves management data for each
entry in the table.
</p>

</div>
<a name="enettdg-CHP-9-SECT-2.2" /><div class="sect2">
<h3 class="sect2">9.2.2. OpenView Graphing</h3>

<a name="INDEX-1305" /><a name="INDEX-1306" /><a name="INDEX-1307" /><a name="INDEX-1308" /><a href="ch09_02.html#enettdg-CHP-9-FIG-3">Figure 9-3</a> shows
the sort of graph you can create with NNM. To create this graph, we
started the browser (<a href="ch08_01.html#enettdg-CHP-8-FIG-2">Figure 8-2</a>) and clicked down
through the MIB tree until we found the
.<em class="emphasis">iso.org.dod.internet.mgmt.mib-2.interfaces.ifTable.ifEntry</em>
list. Once there, we clicked on <em class="emphasis">ifInOctets</em>;
then, while holding down the Ctrl key, we clicked on
<em class="emphasis">ifOutOctets</em>. After both were selected and we
verified that the "Name or IP Address" field displayed
the node we wanted to poll, we clicked on the "Graph"
button.
</p>

<a name="enettdg-CHP-9-FIG-3" /><div class="figure"><img height="356" alt="Figure 9-3" src="figs/snmp_0904.gif" width="481" /></div><h4 class="objtitle">Figure 9-3.  OpenView xnmgraph of octets in/out</h4>

<a name="INDEX-1309" /><a name="INDEX-1310" /><a name="INDEX-1311" /><a name="INDEX-1312" /><a name="INDEX-1313" />Once the graph has started, you can change
the polling interval and the colors used to display different
objects. You can also turn off the display of some or all of the
object instances. The menu item "View <img alt="Figure 9.2.2" src="figs/U2192.gif" /> Line
Configuration" lets you specify which objects you would like to
display; it can also set multipliers for different items. For
example, to display everything in K, multiply the data by .001. There
is also an option ("View <img alt="Figure 9.2.2" src="figs/U2192.gif" /> Statistics") that shows a
statistical summary of your graph. <a href="ch09_02.html#enettdg-CHP-9-FIG-4">Figure 9-4</a> shows
some statistics from the graph in <a href="ch09_02.html#enettdg-CHP-9-FIG-3">Figure 9-3</a>. While
the statistics menu is up, you can left-click on the graph; the
statistics window will display the values for the specific date and
time to which you are pointing with the mouse.
<a name="INDEX-1314" /><a name="INDEX-1315" /><a name="INDEX-1316" />
</p>

<a name="enettdg-CHP-9-FIG-4" /><div class="figure"><img height="178" alt="Figure 9-4" src="figs/snmp_0905.gif" width="327" /></div><h4 class="objtitle">Figure 9-4.  xnmgraph statistics</h4>

<a name="ch09-11-fm2xml" /><blockquote><b>WARNING: </b> 
Starting <i class="command">xnmgraph</i> 
from the command line allows you to start
the grapher at a specific polling period and gives you several other
options. By default, OpenView polls at 10-second intervals. In most
cases this is fine, but if you are polling a multiport router to
check if some ports are congested, a 10-second polling interval may
be too quick and could cause operational problems. For example, if
the CPU is busy answering SNMP queries every 10 seconds, the router
might get bogged down and become very slow, especially if the router
is responsible for OSPF or other CPU-intensive tasks. You may also
see messages from OpenView complaining that another poll has come
along while it is still waiting for the previous poll to return.
Increasing the polling interval usually gets rid of these messages.
</p>
</blockquote>

<a name="INDEX-1317" /><a name="INDEX-1318" /><a name="INDEX-1319" />Some of
NNM's default menus let you use the grapher to poll devices
depending on their type. For example, you can select the object type
"router" on the NNM and generate a graph that includes
all your routers. Whether you start from the command line or from the
menu, there are times when you will get a message back that reads
"Requesting more lines than number of colors (25). Reducing
number of lines." This message means that there aren't
enough colors available to display the objects you are trying to
graph. The only good ways to avoid this problem are to break up your
graphs so that they poll fewer objects or to eliminate object
instances you don't want. For example, you probably don't
want to graph router interfaces that are down (for whatever reason)
and other "dead" objects. We will soon see how you can
use a regular expression as one of the arguments to the
<i class="command">xnmgraph</i> command to graph only those interfaces
that are up and running.
</p>

<a name="INDEX-1320" /><a name="INDEX-1321" />
<a name="INDEX-1322" />Although the graphical interface is
very convenient, the command-line interface gives you much more
flexibility. The following script displays the graph in <a href="ch09_02.html#enettdg-CHP-9-FIG-3">Figure 9-3</a> (i.e., the graph we generated through the
browser):
</p>

<blockquote><pre class="code">#!/bin/sh
# filename: /opt/OV/local/scripts/graphOctets
# syntax: graphOctets &lt;hostname&gt;
/opt/OV/bin/xnmgraph -c public -mib \
".iso.org.dod.internet.mgmt.mib-2.interfaces.ifTable.ifEntry.ifInOctets::::::::,\
.iso.org.dod.internet.mgmt.mib-2.interfaces.ifTable.ifEntry.ifOutOctets::::::::" \
$1</pre></blockquote>

You can run this script with the command:</p>

<blockquote><pre class="code">$ <tt class="userinput"><b>/opt/OV/local/scripts/graphOctets orarouter1</b></tt></pre></blockquote>

<a name="INDEX-1323" /><a name="INDEX-1324" />The
worst part of writing the script is figuring out what command-line
options you want -- particularly the long strings of nine
colon-separated options. All these options give you the ability to
refine what you want to graph, how often you want to poll the
objects, and how you want to display the data. (We'll discuss
the syntax of these options as we go along, but for the complete
story, see the <i class="command">xnmgraph</i>(1) manpage.) In this
script, we're graphing the values of two MIB objects,
<em class="emphasis">ifInOctets</em> and <em class="emphasis">ifOutOctets</em>.
Each OID we want to graph is the first (and in this case, the only)
option in the string of colon-separated options. On our network, this
command produces eight traces: input and output octets for each of
our four interfaces. You can add other OIDs to the graph by adding
sets of options, but at some point the graph will become too
confusing to be useful. It will take some experimenting to use the
<i class="command">xnmgraph</i> command efficiently, but once you learn
how to generate useful graphs you'll wonder how you ever got
along without it.
<a name="INDEX-1325" /><a name="INDEX-1326" />
</p>

<a name="ch09-12-fm2xml" /><blockquote><b>WARNING: </b> 
Keeping your scripts neat is not only
good practice, but also aesthetically pleasing. Using a
"\" at the end of a line indicates that the next line is
a continuation of the current line. Breaking your lines intelligently
makes your scripts more readable. Be warned that the Unix shells do
<em class="emphasis">not</em> like extra whitespace after the
"\". The only character after each "\" should
be one carriage return.
</p>
</blockquote>

<a name="INDEX-1327" />Now, let's modify the script to
include more reasonable labels -- in particular, we'd like
the graph to show which interface is which, rather than just showing
the index number. In our modified script, we've used numerical
object IDs, mostly for formatting convenience, and we've added
a sixth option to the ugly sequence of colon-separated options:
<em class="emphasis">.1.3.6.1.2.1.2.2.1.2</em> (this is the
<em class="emphasis">ifDescr</em>, or interface description, object in the
interface table). This option says to poll each instance and use the
return value of <i class="command">snmpget
.1.3.6.1.2.1.2.2.1.2.INSTANCE</i> as the label. This should
give us meaningful labels. Here's the new script:
</p>

<blockquote><pre class="code">#!/bin/sh
# filename: /opt/OV/local/scripts/graphOctets
# syntax: graphOctets &lt;hostname&gt;
/opt/OV/bin/xnmgraph -c public -title Bits_In_n_Out -mib \
".1.3.6.1.4.1.9.2.2.1.1.6:::::.1.3.6.1.2.1.2.2.1.2:::,\
.1.3.6.1.4.1.9.2.2.1.1.8:::::.1.3.6.1.2.1.2.2.1.2:::" $1</pre></blockquote>

To see what we'll get for labels, here's the result of
walking <em class="emphasis">.1.3.6.1.2.1.2.2.1.2</em>:
</p>

<blockquote><pre class="code">$ <tt class="userinput"><b>snmpwalk orarouter1 .1.3.6.1.2.1.2.2.1.2</b></tt>
interfaces.ifTable.ifEntry.ifDescr.1 : DISPLAY STRING- (ascii):  Ethernet0
interfaces.ifTable.ifEntry.ifDescr.2 : DISPLAY STRING- (ascii):  Serial0
interfaces.ifTable.ifEntry.ifDescr.3 : DISPLAY STRING- (ascii):  Serial1</pre></blockquote>

<a href="ch09_02.html#enettdg-CHP-9-FIG-5">Figure 9-5</a> shows our new graph. With the addition
of this sixth option, the names and labels are much easier to read.
</p>

<a name="enettdg-CHP-9-FIG-5" /><div class="figure"><img height="111" alt="Figure 9-5" src="figs/snmp_0906.gif" width="249" /></div><h4 class="objtitle">Figure 9-5.  OpenView xnmgraph with new labels</h4>

<a name="INDEX-1328" /><a name="INDEX-1329" /><a name="INDEX-1330" /><a name="INDEX-1331" />Meaningful labels and titles are
important, especially if management is interested in seeing the
graphs. A label that contains an OID and not a textual description is
of no use. Some objects that are useful in building labels are
<em class="emphasis">ifType</em>
(.<em class="emphasis">1.3.6.1.2.1.2.2.1.3</em>) and
<em class="emphasis">ifOperStatus</em>
(.<em class="emphasis">1.3.6.1.2.1.2.2.1.8</em>). Be careful when using
<em class="emphasis">ifOperStatus</em>; if the status of the interface
changes during a poll, the label does not change. The label is
evaluated only once.
</p>

<a name="INDEX-1332" /><a name="INDEX-1333" />One of the most wasteful things you
can do is poll a useless object. This often happens when an interface
is administratively down or not configured. Imagine that you have 20
serial interfaces, but only one is actually in use. If you are
looking for octets in and out of your serial interfaces, you'll
be polling 40 times and 38 of the polls will always read
<tt class="literal">0</tt>. OpenView's <i class="command">xnmgraph</i>
allows you to specify an OID and regular expression to select what
should be graphed. To put this feature to use, let's walk the
MIB to see what information is available:
</p>

<blockquote><pre class="code">$ <tt class="userinput"><b>snmpwalk orarouter1 .1.3.6.1.2.1.2.2.1.8</b></tt>
interfaces.ifTable.ifEntry.ifOperStatus.1 : INTEGER: up
interfaces.ifTable.ifEntry.ifOperStatus.2 : INTEGER: up
interfaces.ifTable.ifEntry.ifOperStatus.3 : INTEGER: down</pre></blockquote>

This tells us that only two interfaces are currently up. By looking
at <em class="emphasis">ifDescr</em>, we see that the live interfaces are
<em class="emphasis">Ethernet0</em> and <em class="emphasis">Serial0</em>;
<em class="emphasis">Serial1</em> is down. Notice that the type of
<em class="emphasis">ifOperStatus</em> is <tt class="literal">INTEGER</tt>, but
the return value looks like a string. How is this? RFC 1213 defines
string values for each possible return value:
</p>

<blockquote><pre class="code">ifOperStatus OBJECT-TYPE
    SYNTAX  INTEGER {
                up(1),       -- ready to pass packets
                down(2),
                testing(3)   -- in some test mode
            }
    ACCESS  read-only
    STATUS  mandatory
    DESCRIPTION
        "The current operational state of the interface. The testing(3)
         state indicates that no operational packets can be passed."
    ::= { ifEntry 8 }</pre></blockquote>

It's fairly obvious how to read this: the integer value
<tt class="literal">1</tt> is converted to the string
<tt class="literal">up</tt>. We can therefore use the value
<tt class="literal">1</tt> in a regular expression that tests
<em class="emphasis">ifOperStatus</em>. For every instance we will check
the value of <em class="emphasis">ifOperStatus</em>; we will poll that
instance and graph the result only if the status returns
<tt class="literal">1</tt>. In pseudocode, the operation would look
something like this:
</p>

<blockquote><pre class="code">if (ifOperStatus == 1) {
    pollForMIBData;
    graphOctets;
}</pre></blockquote>

Here's the next version of our graphing script. To put this
logic into a graph, we use the OID for
<em class="emphasis">ifOperStatus</em> as the fourth colon option, and the
regular expression (<tt class="literal">1</tt>) as the fifth option:
</p>

<blockquote><pre class="code">#!/bin/sh
# filename: /opt/OV/local/scripts/graphOctets
# syntax: graphOctets &lt;hostname&gt;
/opt/OV/bin/xnmgraph -c public \
-title Octets_In_and_Out_For_All_Up_Interfaces \
-mib ".1.3.6.1.2.1.2.2.1.10:::.1.3.6.1.2.1.2.2.1.8:1::::, \
.1.3.6.1.2.1.2.2.1.16:::.1.3.6.1.2.1.2.2.1.8:1::::" $1</pre></blockquote>

<a name="INDEX-1334" />This command graphs the
<em class="emphasis">ifInOctets</em> and <em class="emphasis">ifOutOctets</em>
of any interface that has a current operational state equal to
<tt class="literal">1</tt>, or <tt class="literal">up</tt>. It therefore polls
and graphs only the ports that are important, saving on network
bandwidth and simplifying the graph. Furthermore, we're less
likely to run out of colors while making the graph because we
won't assign them to useless objects. Note, however, that this
selection happens only during the first poll and stays effective
throughout the entire life of the graphing process. If the status of
any interface changes after the graph has been started, nothing in
the graph will change. The only way to discover any changes in
interface status is to restart <i class="command">xnmgraph</i>.
</p>

Finally, let's look at:</p>

<ul><li>
How to add a label to each of the OIDs we graph</p>
</li><li>
How to multiply each value by a constant</p>
</li><li>
How to specify the polling interval</p>
</li></ul>
The cropped graph in <a href="ch09_02.html#enettdg-CHP-9-FIG-6">Figure 9-6</a> shows how the
labels change when we run the following script:
</p>

<blockquote><pre class="code">#!/bin/sh
# filename: /opt/OV/local/scripts/graphOctets
# syntax: graphOctets &lt;hostname&gt;
/opt/OV/bin/xnmgraph -c public -title Internet_Traffic_In_K -poll 68 -mib \
".1.3.6.1.4.1.9.2.2.1.1.6:Incoming_Traffic::::.1.3.6.1.2.1.2.2.1.2::.001:,\
.1.3.6.1.4.1.9.2.2.1.1.8:Outgoing_Traffic::::.1.3.6.1.2.1.2.2.1.2::.001:" \
$1</pre></blockquote>

<a name="INDEX-1335" /><a name="INDEX-1336" /><a name="INDEX-1337" /><a name="INDEX-1338" /><a name="INDEX-1339" /><a name="INDEX-1340" /><a name="INDEX-1341" />The labels are given by the second
and sixth fields in the colon-separated options (the second field
provides a textual label to identify the objects we're graphing
and the sixth uses the <em class="emphasis">ifDescr</em> field to identify
the particular interface); the constant multiplier (.001) is given by
the eighth field; and the polling interval (in seconds) is given by
the <i class="command">-poll</i> option.
</p>

<a name="enettdg-CHP-9-FIG-6" /><div class="figure"><img height="138" alt="Figure 9-6" src="figs/snmp_0907.gif" width="314" /></div><h4 class="objtitle">Figure 9-6.  xnmgraph with labels and multipliers</h4>

By now it should be apparent how flexible OpenView's
<i class="command">xnmgraph</i> program really is. These graphs can be
important tools for troubleshooting your network. When a network
manager receives complaints from customers regarding slow
connections, he can look at the graph of
<em class="emphasis">ifInOctets</em> generated by
<i class="command">xnmgraph</i> to see if any router interfaces have
unusually high traffic spikes.
</p>

<a name="INDEX-1342" /><a name="INDEX-1343" />
<a name="INDEX-1344" /><a name="INDEX-1345" /><a name="INDEX-1346" />Graphs
like these are also useful when you're setting thresholds for
alarms and other kinds of traps. The last thing you want is a
threshold that is too triggery (one that goes off too many times) or
a threshold that won't go off until the entire building burns
to the ground. It's often useful to look at a few graphs to get
a feel for your network's behavior before you start setting any
thresholds. These graphs will give you a baseline from which to work.
For example, say you want to be notified when the battery on your UPS
is low (which means it is being used) and when it is back to normal
(fully charged). The obvious way to implement this is to generate an
alarm when the battery falls below some percentage of full charge,
and another alarm when it returns to full charge. So the question is:
what value can we set for the threshold? Should we use 10% to
indicate that the battery is being used and 100% to indicate that
it's back to normal? We can find the baseline by graphing the
device's MIBs.<a href="#FOOTNOTE-39">[39]</a> For
example, with a few days' worth of graphs, we can see that our
UPS's battery stays right around 94-97% when it is not in use.
There was a brief period when the battery dropped down to 89%, when
it was performing a self-test. Based on these numbers, we may want to
set the "in use" threshold at 85% and the "back to
normal" threshold at 94%. This pair of thresholds gives us
plenty of notification when the battery's in use, but
won't generate useless alarms when the device is in self-test
mode. The appropriate thresholds depend on the type of devices you
are polling, as well as the MIB data that is gathered. Doing some
initial testing and polling to get a baseline (normal numbers) will
help you set thresholds that are meaningful and useful.
</p><blockquote class="footnote"> <a name="FOOTNOTE-39" />[39]Different vendors have different
UPS MIBs. Refer to your particular vendor's MIB to find out
which object represents low battery power.</p> </blockquote>

<a name="INDEX-1347" />Before
leaving <i class="command">xnmgraph</i>, we'll take a final look at
the nastiest aspect of this program: the sequence of nine
colon-separated options. In the examples, we've demonstrated
the most useful combinations of options. In more detail, here's
the syntax of the graph specification:
</p>

<blockquote><pre class="code"><em class="replaceable">object:label:instances:match:expression:instance-label:truncator:multiplier:nodes</em></pre></blockquote>

The parameters are:</p>

<dl>
<dt><b>object</b></dt>
<dd>
<a name="INDEX-1348" />The OID of the
object whose values you want to graph. This can be in either numeric
or human-readable form, but it should <em class="emphasis">not</em> have
an instance number at the end. It can also be the name of an
expression (expressions are discussed in <a href="appa_01.html">Appendix A, "Using Input and Output Octets"</a>).
</p>
</dd>

</dl>

<dl>
<dt><b>label</b></dt>
<dd>
<a name="INDEX-1349" />A string
to use in making the label for all instances of this object. This can
be a literal string or the OID of some object with a string value.
The label used on the graph is made by combining this label (for all
instances of the object) with <em class="emphasis">instance-label</em>,
which identifies individual instances of an object in a table. For
example, in <a href="ch09_02.html#enettdg-CHP-9-FIG-6">Figure 9-6</a>, the labels are
<em class="emphasis">Incoming_Traffic</em> and
<em class="emphasis">Outgoing_Traffic</em>;
<em class="emphasis">instance-label</em> is
<em class="emphasis">1.3.6.1.2.1.2.2.1.2</em>, or the
<em class="emphasis">ifDescr</em> field for each object being graphed.
</p>
</dd>

</dl>

<dl>
<dt><b>instances</b></dt>
<dd>
<a name="INDEX-1350" />A regular
expression that specifies which instances of
<em class="emphasis">object</em> to graph. If this is omitted, all
instances are graphed. For example, the regular expression
<tt class="literal">1</tt> limits the graph to instance 1 of
<em class="emphasis">object</em>; the regular expression
<tt class="literal">[4-7]</tt> limits the graph to instances 4 through 7.
You can use the <em class="emphasis">match</em> and
<em class="emphasis">expression</em> fields to further specify which
objects to match.
</p>
</dd>

</dl>

<dl>
<dt><b>match</b></dt>
<dd>
The OID of an object (not including the instance ID) to match against
a regular expression (the match-expression), to determine which
instances of the object to display in the graph.
</p>
</dd>

</dl>

<dl>
<dt><b>expression</b></dt>
<dd>
<a name="INDEX-1351" />A
regular expression; for each instance, the object given by
<em class="emphasis">match</em> is compared to this regular expression. If
the two match, the instance is graphed.
</p>
</dd>

</dl>

<dl>
<dt><b>instance-label</b></dt>
<dd>
<a name="INDEX-1352" />A
label to use to identify particular instances of the object you are
graphing. This is used in combination with the
<em class="emphasis">label</em> and <em class="emphasis">truncator</em> fields
to create a label for each instance of each object being graphed.
</p>
</dd>

</dl>

<dl>
<dt><b>truncator</b></dt>
<dd>
<a name="INDEX-1353" />A string that will be removed from
the initial portion of the instance label, to make it shorter.
</p>
</dd>

</dl>

<dl>
<dt><b>multiplier</b></dt>
<dd>
<a name="INDEX-1354" />A
number that's used to scale the values being graphed.
</p>
</dd>

</dl>

<dl>
<dt><b>nodes</b></dt>
<dd>
<a name="INDEX-1355" /><a name="INDEX-1356" /><a name="INDEX-1357" />The nodes to poll to create the graph.
You can list any number of nodes, separated by spaces. The wildcard
"*" polls all the nodes in OpenView's database. If
you omit this field, <i class="command">xnmgraph</i> takes the list of
nodes from the final argument on the command line.
</p>
</dd>

</dl>

The only required field is <em class="emphasis">object</em>; however, as
we've seen, you must have all eight colons even if you leave
some (or most) of the fields empty.<a name="INDEX-1358" /><a name="INDEX-1359" /><a name="INDEX-1360" /><a name="INDEX-1361" /><a name="INDEX-1362" /> <a name="INDEX-1363" /> 
</p>

</div>
<a name="enettdg-CHP-9-SECT-2.3" /><div class="sect2">
<h3 class="sect2">9.2.3. OpenView Data Collection and Thresholds</h3>

<a name="INDEX-1364" /><a name="INDEX-1365" /><a name="INDEX-1366" /><a name="INDEX-1367" /><a name="INDEX-1368" />Once you close the OpenView graphs,
the data in them is lost forever. OpenView provides a way to fix this
problem with data collection. Data collection allows the user to poll
and record data continuously. It can also look at these results and
trigger events. One benefit of data collection is that it can watch
the network for you while you're not there; you can start
collecting data on Friday then leave for the weekend knowing that any
important events will be recorded in your absence.
</p>

You can start OpenView's Data Collection and Thresholds
function from the command line, using the command
<i class="command">$OV_BIN/xnmcollect</i>, or from NNM under the Options
menu. This brings you to the "Data Collection and
Thresholds" window, shown in <a href="ch09_02.html#enettdg-CHP-9-FIG-7">Figure 9-7</a>,
which displays a list of all the collections you have configured and
a summary of the collection parameters.
</p>

<a name="enettdg-CHP-9-FIG-7" /><div class="figure"><img height="350" alt="Figure 9-7" src="figs/snmp_0908.gif" width="432" /></div><h4 class="objtitle">Figure 9-7.  OpenView's Data Collection and Thresholds window</h4>

Configured collections that are in "Suspended" mode
appear in a dark or bold font. This indicates that OpenView is not
collecting any data for these objects. A "Collecting"
status indicates that OpenView is polling the selected nodes for the
given object and saving the data. To change the status of a
collection, select the object, click on "Actions," and
then click on either "Suspend Collection" or
"Resume Collection." (Note that you must save your
changes before they will take effect.)
</p>

<a name="enettdg-CHP-9-SECT-2.3.1" /><div class="sect3">
<h3 class="sect3">9.2.3.1. Designing collections</h3>

<a name="INDEX-1369" /><a name="INDEX-1370" /><a name="INDEX-1371" /><a name="INDEX-1372" />To design a new collection, click
on "Edit <img alt="Figure 9.2.3.1" src="figs/U2192.gif" /> Add MIB Object." This takes you to a new
screen. At the top, click on "MIB Object"<a href="#FOOTNOTE-40">[40]</a> and click down through the tree until you
find the object you would like to poll. To look at the status of our
printer's paper tray, for example, we need to navigate down to
<em class="emphasis">.iso.org.dod.internet.private.enterprises.hp.nm.system.net-peripheral.net-printer.generalDeviceStatus.gdStatusEntry.gdStatusPaperOut</em>
(.<em class="emphasis">1.3.6.1.4.1.11.2.3.9.1.1.2.8</em>).<a href="#FOOTNOTE-41">[41]</a> The object's description suggests that this is the
item we want: it reads "This indicates that the peripheral is
out of paper." (If you already know what you're looking
for, you can enter the name or OID directly.) Once there, you can
change the name of the collection to something that is easier to
read. Click "OK" to move forward. This brings you to the
menu shown in <a href="ch09_02.html#enettdg-CHP-9-FIG-8">Figure 9-8</a>.
</p><blockquote class="footnote">
<a name="FOOTNOTE-40" />[40]You can collect the value of an expression instead of a single
MIB object. The topic of expressions is out of the scope of this book
but is explained in the <em class="filename">mibExpr.conf</em> (4)
manpage.</p> </blockquote><blockquote class="footnote">
<a name="FOOTNOTE-41" />[41]This object is in HP's private MIB, so it won't be
available unless you have HP printers and have installed the
appropriate MIBs. Note that there is a standard printer MIB, RFC
1759, but HP's MIB has more useful information.</p>
</blockquote>

<a name="enettdg-CHP-9-FIG-8" /><div class="figure"><img height="384" alt="Figure 9-8" src="figs/snmp_0909.gif" width="378" /></div><h4 class="objtitle">Figure 9-8.  OpenView poll configuration menu</h4>

<a name="INDEX-1373" /><a name="INDEX-1374" /><a name="INDEX-1375" /><a name="INDEX-1376" /><a name="INDEX-1377" />The "Source" field is
where you specify the nodes from which you would like to collect
data. Enter the hostnames or IP addresses you want to poll. You can
use wildcards like <em class="emphasis">198.27.6.*</em> in your IP
addresses; you can also click "Add Map" to add any nodes
currently selected. We suggest that you start with one node for
testing purposes. Adding more nodes to a collection is easy once you
have everything set up correctly; you just return to the window in
<a href="ch09_02.html#enettdg-CHP-9-FIG-8">Figure 9-8</a> and add the nodes to the Source list.
</p>

<a name="INDEX-1378" /> <a name="INDEX-1379" /><a name="INDEX-1380" /><a name="INDEX-1381" /><a name="INDEX-1382" />"Collection Mode" lets you
specify what to do with the data NNM collects. There are four
collection modes: "Exclude Collection," "Store,
Check Thresholds," "Store, No Thresholds," and
"Don't Store, Check Thresholds." Except for
"Exclude Collection," which allows us to turn off
individual collections for each device, the collection modes are
fairly self-explanatory. ("Exclude Collection" may sound
odd, but it is very useful if you want to exclude some devices from
collection without stopping the entire process; for example, you may
have a router with a hardware problem that is bombarding you with
meaningless data.) Data collection without a threshold is easier than
collection with a threshold, so we'll start there. Set the
Collection Mode to "Store, No Thresholds." This disable
(grays out) the bottom part of the menu, which is used for threshold
parameters. (Select "Store, Check Thresholds" if you want
both data collection and threshold monitoring.) Then click
"OK" and save the new collection. You can now watch your
collection grow in the <em class="filename">$OV_DB/snmpCollect</em>
directory. Each collection consists of a binary datafile, plus a file
with the same name preceded by an exclamation mark (!); this file
stores the collection information. The data-collection files will
grow without bounds. To trim these files without disturbing the
collector, delete all files that do not contain an "!"
mark.
</p>

<a name="INDEX-1383" /><a name="INDEX-1384" /><a name="INDEX-1385" /><a name="INDEX-1386" />Clicking
on "Only Collect on Nodes with sysObjectID:" allows you
to enter a value for <em class="emphasis">sysObjectID</em>.
<em class="emphasis">sysObjectID</em>
(<em class="emphasis">iso.org.dod.internet.mgmt.mib-2.system.sysObjectID</em>)
lets you limit polling to devices made by a specific manufacturer.
Its value is the enterprise number the device's manufacturer
has registered with IANA. For example, Cisco's enterprise
number is 9, and HP's is 11 (the complete list is available at
<a href="http://www.isi.edu/in-notes/iana/assignments/enterprise-numbers">http://www.isi.edu/in-notes/iana/assignments/enterprise-numbers</a>);
therefore, to restrict polling to devices manufactured by HP, set the
<em class="emphasis">sysObjectID</em> to <tt class="literal">11</tt>. RFC 1213
formally defines <em class="emphasis">sysObjectID</em>
(<em class="emphasis">1.3.6.1.2.1.1.2</em>) as follows:
</p>

<blockquote><pre class="code">sysObjectID OBJECT-TYPE
    SYNTAX  OBJECT IDENTIFIER
    ACCESS  read-only
    STATUS  mandatory
    DESCRIPTION
        "The vendor's authoritative identification of the network
         management subsystem contained in the entity. This value
         is allocated within the SMI enterprises subtree (1.3.6.1.4.1) 
         and provides an easy and unambiguous means for determining
         what kind of box' is being managed. For example, if vendor
         'Flintstones, Inc.' was assigned the subtree 1.3.6.1.4.1.4242,
         it could assign the identifier 1.3.6.1.4.1.4242.1.1 to its
         'Fred Router'."
    ::= { system 2 }</pre></blockquote>

<a name="INDEX-1387" /><a name="INDEX-1388" /><a name="INDEX-1389" /><a name="INDEX-1390" />The polling interval is
the period at which polling occurs. You can use one-letter
abbreviations to specify units: "s" for seconds,
"m" for minutes, "h" for hours,
"d" for days. For example, 32s indicates 32 seconds; 1.5d
indicates one and a half days. When I'm designing a data
collection, I usually start with a very short polling
interval -- typically 7s (7 seconds between each poll). You
probably wouldn't want to use a polling interval this short in
practice (all the data you collect is going to have to be stored
somewhere), but when you're setting up a collection, it's
often convenient to use a short polling interval. You don't
want to wait a long time to find out whether you're collecting
the right data.
</p>

<a name="INDEX-1391" /><a name="INDEX-1392" /><a name="INDEX-1393" /><a name="INDEX-1394" />The next option is a drop-down menu that
specifies what instances should be polled. The options are
"All," "From List," and "From Regular
Expression." In this case we're polling a scalar item, so
we don't have to worry about instances; we can leave the
setting to "All" or select "From List" and
specify instance "0" (the instance number for all scalar
objects). If you're polling a tabular object, you can either
specify a comma-separated list of instances or choose the "From
Regular Expression" option and write a regular expression that
selects the instances you want. Save your changes ("File <img alt="Figure 9.2.3.1" src="figs/U2192.gif" />
Save"), and you're done.<a name="INDEX-1395" /><a name="INDEX-1396" /><a name="INDEX-1397" /> 
</p>

</div>

<a name="enettdg-CHP-9-SECT-2.3.2" /><div class="sect3">
<h3 class="sect3">9.2.3.2. Creating a threshold</h3>

<a name="INDEX-1398" /> <a name="INDEX-1399" /><a name="INDEX-1400" /><a name="INDEX-1401" /><a name="INDEX-1402" /><a name="INDEX-1403" />Once you've set all this up,
you've configured NNM to periodically collect the status of
your printer's paper tray. Now for something more interesting:
let's use thresholds to generate some sort of notification when
the traffic coming in through one of our network interfaces exceeds a
certain level. To do this, we'll look at a Cisco-specific
object, <em class="emphasis">locIfInBitsSec</em> (more formally
<em class="emphasis">iso.org.dod.internet.private.enterprises.cisco.local.linterfaces.lifTable.lifEntry.locIfInBitsSec</em>),
whose value is the five-minute average of the rate at which data
arrives at the interface, in bits per second. (There's a
corresponding object called <em class="emphasis">locIfOutBitsSec</em>,
which measures the data leaving the interface.) The first part of the
process should be familiar: start Data Collection and Thresholds by
going to the Options menu of NNM; then click on "Edit <img alt="Figure 9.2.3.2" src="figs/U2192.gif" />
Add MIB Object." Navigate through the object tree until you get
to <em class="emphasis">locIfInBitsSec</em>; click "OK" to get
back to the screen shown in <a href="ch09_02.html#enettdg-CHP-9-FIG-8">Figure 9-8</a>. Specify the
IP addresses of the interfaces you want to monitor and set the
collection mode to "Store, Check Thresholds"; this allows
you to retrieve and view the data at a later time. (I typically turn
on the "Store" function so I can verify that the
collector is actually working and view any data that has
accumulated.) Pick a reasonable polling interval -- again, when
you're testing it's reasonable to use a short
interval -- then choose which instances you'd like to poll,
and you're ready to set thresholds.
</p>

The "Threshold" field lets you specify the point at which
the value you're monitoring becomes interesting. What
"interesting" means is up to you. In this case,
let's assume that we're monitoring a T1 connection, with
a capacity of 1.544 Mbits/second. Let's say somewhat
arbitrarily that we'll start worrying when the incoming traffic
exceeds 75% of our capacity. So, after multiplying, we set the
threshold to "&gt; 1158000". Of course, network traffic
is fundamentally bursty, so we won't worry about a single
peak -- but if we have two or three consecutive readings that
exceed the threshold, we want to be notified. So let's set
"consecutive samples" to 3: that shields us from getting
unwanted notifications, while providing ample notification if
something goes wrong.
</p>

<a name="INDEX-1404" />Setting an appropriate
consecutive samples value will make your life much more pleasant,
though picking the right value is something of an art. Another
example is monitoring the <em class="emphasis">/tmp</em> partition of a
Unix system. In this case, you may want to set the threshold to
"&gt;= 85", the number of consecutive samples to 2, and
the poll interval to 5m. This will generate an event when the usage
on <em class="emphasis">/tmp</em> exceeds 85% for two consecutive polls.
This choice of settings means that you won't get a false alarm
if a user copies a large file to <em class="emphasis">/tmp</em> and then
deletes the file a few minutes later. If you set consecutive samples
to 1, NNM will generate a Threshold event as soon as it notices that
<em class="emphasis">/tmp</em> is filling up, even if the condition is
only temporary and nothing to be concerned about. It will then
generate a Rearm event after the user deletes the file. Since we are
really only worried about <em class="emphasis">/tmp</em> filling up and
staying full, setting the consecutive threshold to 2 can help reduce
the number of false alarms. This is generally a good starting value
for consecutive samples, unless your polling interval is very high.
</p>

The rearm parameters let us specify when everything is back to normal
or is, at the very least, starting to return to normal. This state
must occur before another threshold is met. You can specify either an
absolute value or a percentage. When monitoring the packets arriving
at an interface, you might want to set the rearm threshold to
something like 926,400 bits per second (an absolute value that
happens to be 60% of the total capacity) or 80% of the threshold
(also 60% of capacity). Likewise, if you're generating an alarm
when <em class="emphasis">/tmp</em> exceeds 85% of capacity, you might
want to rearm when the free space returns to 80% of your 85%
threshold (68% of capacity). You can also specify the number of
consecutive samples that need to fall below the rearm point before
NNM will consider the rearm condition met.
</p>

<a name="INDEX-1405" />
<a name="INDEX-1406" />
<a name="INDEX-1407" />The
final option, "Configure Threshold Event," asks what
OpenView events you would like to execute for each state. You can
leave the default event, or you can refer to <a href="ch10_01.html">Chapter 10, "Traps"</a> for more on how to configure events.
The "Threshold" state needs a specific event number that
must reside in the HP enterprise. The default Threshold event is
<em class="emphasis">OV_DataCollectThresh - 58720263</em>. Note that the
Threshold event is always an odd number. The Rearm event is the next
number after the Threshold event: in this case, 58720264. To
configure events other than the default, click on "Configure
Threshold Event" and, when the new menu comes up, add one event
(with an odd number) to the HP section and a second event for the
corresponding Rearm. After making the additions, save and return to
the Collection windows to enter the new number.
</p>

<a name="INDEX-1408" /><a name="INDEX-1409" /><a name="INDEX-1410" /><a name="INDEX-1411" /><a name="INDEX-1412" /><a name="INDEX-1413" /><a name="INDEX-1414" /><a name="INDEX-1415" /><a name="INDEX-1416" /><a name="INDEX-1417" />When you finish configuring the
data collection, click "OK." This brings you back to the
Data Collection and Thresholds menu. Click "File <img alt="Figure 9.2.3.2" src="figs/U2192.gif" />
Save" to make your current additions active. On the bottom half
of the "MIB Object Collection Summary" window, click on
your new object and then on "Actions <img alt="Figure 9.2.3.2" src="figs/U2192.gif" /> Test SNMP."
This brings up a window showing the results of an SNMP test on that
collection. After the test, wait long enough for your polling
interval to have expired once or twice. Then click on the object
collection again, but this time click on "Actions <img alt="Figure 9.2.3.2" src="figs/U2192.gif" /> Show
Data." This window shows the data that has been gathered so
far. Try blasting data through the interface to see if you can
trigger a Threshold event. If the Threshold events are not occurring,
verify that your threshold and polling intervals are set correctly.
After you've seen a Threshold event occur, watch how the Rearm
event gets executed. When you're finished testing, go back and
set up realistic polling periods, add any additional nodes you would
like to poll, and turn off storing if you don't want to collect
data for trend analysis. Refer to the
<em class="filename">$OV_LOG/snmpCol.trace</em> file if you are having any
problems getting your data collection rolling. Your HP OpenView
manual should describe how to use this trace file to troubleshoot
most problems.
</p>

<a name="INDEX-1418" /><a name="INDEX-1419" />Once you have collected some data,
you can use <i class="command">xnmgraph</i> to display it. The
<i class="command">xnmgraph</i> command to use is similar to the ones we
saw earlier; it's an awkward command that you'll want to
save in a script. In the following script, the <i class="command">-browse
</i>option points the grapher at the stored data:
</p>

<blockquote><pre class="code">#!/bin/sh
# filename: /opt/OV/local/scripts/graphSavedData
# syntax: graphSavedData &lt;hostname&gt;
/opt/OV/bin/xnmgraph -c public -title Bits_In_n_Out_For_All_Up_Interfaces \
-browse -mib \
 ".1.3.6.1.4.1.9.2.2.1.1.6:::.1.3.6.1.2.1.2.2.1.8:1:.1.3.6.1.2.1.2.2.1.2:::,\
.1.3.6.1.4.1.9.2.2.1.1.8:::.1.3.6.1.2.1.2.2.1.8:1:.1.3.6.1.2.1.2.2.1.2:::" \ 
$1</pre></blockquote>

<a name="INDEX-1420" /><a name="INDEX-1421" /><a name="INDEX-1422" /><a name="INDEX-1423" /><a name="INDEX-1424" />Once the graph has started, no real
(live) data will be graphed; the display is limited to the data that
has been collected. You can click on "File <img alt="Figure 9.2.3.2" src="figs/U2192.gif" /> Update
Data" to check for and insert any data that has been gathered
since the start of the graph. Another option is to leave off
<i class="command">-browse</i>, which allows the graph to continue
collecting and displaying the live data along with the collected
data.
</p>

<a name="INDEX-1425" />Finally, to graph all
the data that has been collected for a specific node, go to NNM and
select the node you would like to investigate. Then select
"Performance <img alt="Figure 9.2.3.2" src="figs/U2192.gif" /> Graph SNMP Data <img alt="Figure 9.2.3.2" src="figs/U2192.gif" /> Select Nodes"
from the menus. You will get a graph of all the data that has been
collected for the node you selected. Alternately, select the
"All" option in "Performance <img alt="Figure 9.2.3.2" src="figs/U2192.gif" /> Graph SNMP
Data." With the number of colors limited to 25, you will
usually find that you can't fit everything into one
graph.<a name="INDEX-1426" /><a name="INDEX-1427" /><a name="INDEX-1428" /><a name="INDEX-1429" /><a name="INDEX-1430" /><a name="INDEX-1431" /><a name="INDEX-1432" /><a name="INDEX-1433" /> 
</p>

</div>
</div>
<a name="enettdg-CHP-9-SECT-2.4" /><div class="sect2">
<h3 class="sect2">9.2.4. Castle Rock's SNMPc</h3>

<a name="INDEX-1434" /><a name="INDEX-1435" /><a name="INDEX-1436" /><a name="INDEX-1437" /><a name="INDEX-1438" /><a name="INDEX-1439" />The
workgroup edition of Castle Rock's SNMPc program has similar
capabilities to the OpenView package. It uses the term "trend
reporting" for its data collection and threshold facilities.
The enterprise edition of SNMPc even allows you to export data to a
web page. In all our examples we use the workgroup edition of SNMPc.
</p>

<a name="INDEX-1440" />To
see how SNMPc works, let's graph the
<em class="emphasis">snmpOutPkts</em> object. This object's OID is
<em class="emphasis">1.3.6.1.2.1.11.2</em>
(<em class="emphasis">iso.org.dod.internet.mgmt.mib-2.snmp.snmpOutPkts</em>).
It is defined in RFC 1213 as follows:
</p>

<blockquote><pre class="code">snmpOutPkts OBJECT-TYPE
    SYNTAX  Counter
    ACCESS  read-only
    STATUS  mandatory
    DESCRIPTION
        "The total number of SNMP messages which were passed from
         the SNMP protocol entity to the transport service."
    ::= { snmp 2 }</pre></blockquote>

We'll use the <em class="emphasis">orahub</em> device for this
example. Start by clicking on the MIB Database selection tab shown in
<a href="ch09_02.html#enettdg-CHP-9-FIG-9">Figure 9-9</a>; this is the tab at the bottom of the
screen that looks something like a spreadsheet -- it's the
second from the left. Click down the tree until you come to
<em class="emphasis">iso.org.dod.internet.mgmt.mib-2.snmp</em>. Click on
the object you would like to graph (for this example,
<em class="emphasis">snmpOutPkts</em>). You can select multiple objects
with the Ctrl key.
</p>

<a name="enettdg-CHP-9-FIG-9" /><div class="figure"><img height="253" alt="Figure 9-9" src="figs/snmp_0910.gif" width="470" /></div><h4 class="objtitle">Figure 9-9.  SNMPc MIB Database view</h4>


<a name="ch09-18-fm2xml" /><blockquote><b>TIP: </b> 
SNMPc has a nonstandard way of organizing MIB information. To get to
the <em class="emphasis">snmpOutPkts</em> object, you need to click down
through the following: "Snmp MIBs <img alt="Figure 9.2.4" src="figs/U2192.gif" /> mgmt <img alt="Figure 9.2.4" src="figs/U2192.gif" /> snmp
<img alt="Figure 9.2.4" src="figs/U2192.gif" /> snmpInfo." Though this is quicker than the RFC-based
organization used by most products, it does get a little confusing,
particularly if you work with several products.
</p>
</blockquote>

Once you have selected the appropriate MIB object, return to the top
level of your map by either selecting the house icon or clicking on
the Root Subnet tab (at the far left) to select the device you would
like to poll. Instead of finding and clicking on the device, you can
enter in the device's name by hand. If you have previously
polled the device, you can select it from the drop-down box. <a href="ch09_02.html#enettdg-CHP-9-FIG-10">Figure 9-10</a> shows what a completed menu bar should look
like.
</p>

<a name="enettdg-CHP-9-FIG-10" /><div class="figure"><img height="310" alt="Figure 9-10" src="figs/snmp_0911.gif" width="338" /></div><h4 class="objtitle">Figure 9-10.  SNMPc menu bar graph section</h4>

<a name="INDEX-1441" />To begin
graphing, click the button with the small jagged graph (the third
from the right). Another window will appear displaying the graph
(<a href="ch09_02.html#enettdg-CHP-9-FIG-11">Figure 9-11</a>). The controls at the top change the
type of graph (line, bar, pie, distribution, etc.) and the polling
interval and allow you to view historical data (the horizontal slider
bar). Review the documentation on how each of these work or, better
yet, play around to learn these menus even
faster.<a name="INDEX-1442" /><a name="INDEX-1443" /><a name="INDEX-1444" /><a name="INDEX-1445" />
</p>

<a name="enettdg-CHP-9-FIG-11" /><div class="figure"><img height="306" alt="Figure 9-11" src="figs/snmp_0912.gif" width="420" /></div><h4 class="objtitle">Figure 9-11.  SNMPc snmpOutPkts graph section</h4>

<a name="INDEX-1446" /><a name="INDEX-1447" /><a name="INDEX-1448" />Once you have a collection of frequently
used graphs, you can insert them into the custom menus. Let's
insert a menu item in the Tools menu that displays all the
information in the <em class="emphasis">snmpInfo</em> table as a pie
chart. Click on the Custom Menus tab (the last one), right-click on
the Tools folder, and then left-click on "Insert Menu".
This gets you to the "Add Custom Menu" window (<a href="ch09_02.html#enettdg-CHP-9-FIG-12">Figure 9-12</a>). Enter a menu name and select
"Pie" for the display type. Use the browse button
(&gt;&gt;) to click down the tree of MIB objects until you reach the
<em class="emphasis">snmpInfo</em> table; then click "OK."
Back at "Add Custom Menu," use the checkboxes in the
"Use Selected Object" section to specify the types of
nodes that will be able to respond to this custom menu item. For
example, to chart <em class="emphasis">snmpInfo</em> a device obviously
needs to support SNMP, so we've checked the "Has
SNMP" box. This information is used when you (or some other
user) try to generate this chart for a given device. If the device
doesn't support the necessary protocols, the menu entry for the
pie chart will be disabled.
</p>

<a name="enettdg-CHP-9-FIG-12" /><div class="figure"><img height="207" alt="Figure 9-12" src="figs/snmp_0913.gif" width="309" /></div><h4 class="objtitle">Figure 9-12.  SNMPc Add Custom Menu window</h4>

<a name="INDEX-1449" />Click
"OK" and proceed to your map to find a device to test.
Any SNMP-compatible device should suffice. Once you have selected a
device, click on "Tools" and then "Show Pie Chart
of snmpInfo." You should see a pie chart displaying the data
collected from the MIB objects you have configured. (If the device
doesn't support SNMP, this option will be disabled.)
Alternately, you could have double-clicked your new menu item in the
Custom Menu tab.
</p>

<a name="INDEX-1450" /><a name="INDEX-1451" />
<a name="INDEX-1452" /><a name="INDEX-1453" /><a name="INDEX-1454" /><a name="INDEX-1455" /><a name="INDEX-1456" />SNMPc has a threshold system called
Automatic Alarms that can track the value of an object over time to
determine its highs and lows (peaks and troughs) and get a baseline.
After it obtains the baseline, it alerts you if something strays out
of bounds. In the main menu, clicking on "Config <img alt="Figure 9.2.4" src="figs/U2192.gif" /> Trend
Reports" brings up the menu shown in <a href="ch09_02.html#enettdg-CHP-9-FIG-13">Figure 9-13</a>. 
</p>

<a name="enettdg-CHP-9-FIG-13" /><div class="figure"><img height="302" alt="Figure 9-13" src="figs/snmp_0914.gif" width="321" /></div><h4 class="objtitle">Figure 9-13.  SNMPc Trend Reports Global Settings menu</h4>

<a name="INDEX-1457" /><a name="INDEX-1458" /><a name="INDEX-1459" /><a name="INDEX-1460" /><a name="INDEX-1461" /><a name="INDEX-1462" /><a name="INDEX-1463" /><a name="INDEX-1464" />Check the "Enable Automatic
Alarms" box to enable this feature. The "Limit Alarms
For" box lets you specify how much time must pass before you
can receive another alarm of the same nature. This prevents you from
being flooded by the same message over and over again. The next
section, "Baseline Creation," lets you configure how the
baseline will be learned. The learning period is how long SNMPc
should take to figure out what the baseline really is. The
"Expand After" option, if checked, states how many alarms
you can get in one day before SNMPc increases the baseline
parameters. In <a href="ch09_02.html#enettdg-CHP-9-FIG-13">Figure 9-13</a>, if we were to get four
alarms in one day, SNMPc would increase the threshold to prevent
these messages from being generated so frequently. Checking the
"Reduce On No Alarms In One Week" box tells SNMPc to
reduce the baseline if we don't receive any alarms in one week.
This option prevents the baseline from being set so high that we
never receive any alarms. If you check the last option and click
"OK," SNMPc will restart the learning process. This gives
you a way to wipe the slate clean and start over.<a name="INDEX-1465" /><a name="INDEX-1466" /><a name="INDEX-1467" /><a name="INDEX-1468" />
</p>

</div>
<a name="enettdg-CHP-9-SECT-2.5" /><div class="sect2">
<h3 class="sect2">9.2.5. Open Source Tools for Data Collection and Graphing</h3>

<a name="INDEX-1469" /><a name="INDEX-1470" />One of the most powerful
tools for data collection and graphing is MRTG, familiar to many in
the open source community. It collects statistics and generates
graphical reports in the form of web pages. In many respects,
it's a different kind of animal than the tools discussed in
this chapter. We cover MRTG in <a href="ch13_01.html">Chapter 13, "MRTG"</a>.<a name="INDEX-1471" /><a name="INDEX-1472" /><a name="INDEX-1473" /><a name="INDEX-1474" /> 
</p>

</div>


<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch09_01.html"><img alt="Previous" border="0" src="../gifs/txtpreva.gif" /></a></td><td align="center" valign="top" width="228"><a href="index.html"><img alt="Home" border="0" src="../gifs/txthome.gif" /></a></td><td align="right" valign="top" width="228"><a href="ch10_01.html"><img alt="Next" border="0" src="../gifs/txtnexta.gif" /></a></td></tr><tr><td align="left" valign="top" width="228">9. Polling and Thresholds</td><td align="center" valign="top" width="228"><a href="index/index.html"><img alt="Book Index" border="0" src="../gifs/index.gif" /></a></td><td align="right" valign="top" width="228">10. Traps</td></tr></table></div>
<hr width="684" align="left" />

<img alt="Library Navigation Links" border="0" src="../gifs/navbar.gif" usemap="#library-map" />
<p><font size="-1"><a href="copyrght.html">Copyright &copy; 2002</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map"><area shape="rect" coords="1,0,84,90" href="../index.html" /><area shape="rect" coords="86,-7,176,90" href="../ssh/index.html" /><area shape="rect" coords="178,0,265,101" href="../tcp/index.html" /><area shape="rect" coords="266,0,333,90" href="../nfs/index.html" /><area shape="rect" coords="334,-1,429,93" href="index.html" /><area shape="rect" coords="431,0,529,116" href="../tshoot/index.html" /><area shape="rect" coords="534,0,594,104" href="../dns/index.html" /><area shape="rect" coords="595,1,704,108" href="../fire/index-2.html" /></map>

</body>
<!-- Mirrored from nnc3.com/mags/Networking2/snmp/ch09_02.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Jul 2017 17:56:56 GMT -->
</html>
